<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

    <html lang="en">
    <!-- GENERATED FILE, DO NOT EDIT, EDIT THE XML FILE IN xdocs INSTEAD! -->
    <head>
      <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
        <title>SignServer - Open Source server side Digital Signatures - SignServer Manual</title>
                <link rel="shortcut icon" href="../images/pk-favIcon.png">
        <link type="text/css" href="../page.css" rel="stylesheet">
        </head>

    <body>

      <div class="logobar">
          <table width="100%">
            <tr>
                <td width="15%"><a href="http://www.signserver.org/"><img src="../images/SignServer_pki_by_primekey.png" alt="Click the PKI-by-PrimeKey-SignServer-logo to visit www.signserver.org" title="The logo squares follow a given magnitude of primes, symbolizing the encryption method of PrimeKey PKI." width="245" height="76" style="border:none;"></a></td>
                <td style="text-align:right">
                    <div class="searchcaption">
                            Search signserver.org for:<br>
                            <form id="searchForm" target="_blank" onsubmit="q.value = query.value + ' site:signserver.org'" action="http://www.google.com/search" method="get">
                                <input name="q" type="hidden">
                                <div style="height: 18px; white-space: nowrap;">
                                    <input name="query" id="searchBox" maxlength="255">
                                    <input type="submit" value="Go">
                                </div>
                            </form>
                    </div>
                </td>
        	<td id="services"><a href="https://www.primekey.se/service-support/support/?pk_campaign=ssorg&amp;pk_kwd=head_click-here" target="pk">Click here to learn about PrimeKey Support Services!</a></td>
            </tr>
          </table>
      </div>

                    
  <div class="menucontainer">

    <div class="menu">
      <ul>
              <li><div class="menuheader">General Information</div>
          <ul>
                            <li>
                                    <a href="../index.html">Home</a>
                                </li>
                            <li>
                                    <a href="../features.html">Features</a>
                                </li>
                            <li>
                                    <a href="../architecture.html">Architecture</a>
                                </li>
                            <li>
                                    <a href="../license.html">License</a>
                                </li>
                            <li>
                                    <a href="../contact.html">Contact & Support</a>
                                </li>
                            <li>
                                    <a href="../credits.html">Credits</a>
                                </li>
                            <li>
                                    <a href="../installations.html">Reference installations</a>
                                </li>
                            <li>
                                    <a href="../required.html">Required software</a>
                                </li>
                            <li>
                                    <a href="http://sourceforge.net/projects/signserver/" class="externalLink">SourceForge project</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Documentation</div>
          <ul>
                            <li>
                                    <a href="../manual.html">Manual</a>
                                </li>
                            <li>
                                    <a href="../manual/installguide.html">Installation Guide</a>
                                </li>
                            <li>
                                    <a href="https://jira.primekey.se/browse/DSS?report=com.atlassian.jira.plugin.system.project:changelog-panel" class="externalLink">Changelog</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Download</div>
          <ul>
                            <li>
                                    <a href="../download.html">Latest releases</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Contributing</div>
          <ul>
                            <li>
                                    <a href="../contributors.html">Contributors</a>
                                </li>
                            <li>
                                    <a href="https://jira.primekey.se/" class="externalLink">Bug Database</a>
                                </li>
                            <li>
                                    <a href="../repositories.html">Repositories</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Continous integration</div>
          <ul>
                            <li>
                                    <a href="../hudson.html">Jenkins</a>
                                </li>
                      </ul>
        </li>
            
        <li><div class="menuheader">Used Services</div>
          <p><br>
          <a href="http://sourceforge.net/projects/signserver/"><img style="border:none; margin-left:20px;" src="http://sourceforge.net/sflogo.php?group_id=190195&amp;type=13" width="120" height="30" alt="Get SignServer at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
          </p>
        </li>
        <li><div class="menuheader">PKI by PrimeKey</div>
          <p>
          <br>
                <a href="https://www.primekey.se/technologies/products-overview/ejbca-enterprise/" target="ejbca">
                <img style="border:none; margin-left:20px;" src="../images/ejbca_pki_by_primekey.png" alt="Click the PKI-by-PrimeKey-EJBCA-logo to visit www.ejbca.org"/>
                </a>
          </p>
          <p>
                <a href="https://www.primekey.se/" target="primekey">
                <img style="border:none; margin-left:20px;" src="../images/logo-PrimeKey.png" alt="Click the PrimeKey logo to check out the products and services offered at www.primekey.se" title="The logo squares follow a given magnitude of primes, symbolizing the encryption method of PrimeKey PKI."/>
                </a>
          </p>
        </li>
      </ul>
    </div>
 	
  </div>
  <div class="main">
  <div class="content">
                <div id="minitoc-area">
            <ul class="chapterminitoc">
                                    <li><a href="#ch_introduction">Introduction</a> 
                                                    [<a href="introduction.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Introduction/scope">Introduction/scope</a>
                                                                                                        </li>
                                                            <li><a href="#Major changes from previous versions">Major changes from previous versions</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Changes between version 3.6 and 3.7">Changes between version 3.6 and 3.7</a></li>
                                                                                            <li><a href="#Changes between version 3.5 and 3.6">Changes between version 3.5 and 3.6</a></li>
                                                                                            <li><a href="#Changes between version 3.4 and 3.5">Changes between version 3.4 and 3.5</a></li>
                                                                                            <li><a href="#Changes between version 3.3 and 3.4">Changes between version 3.3 and 3.4</a></li>
                                                                                            <li><a href="#Changes between version 3.2 and 3.3">Changes between version 3.2 and 3.3</a></li>
                                                                                            <li><a href="#Changes between version 3.1 and 3.2">Changes between version 3.1 and 3.2</a></li>
                                                                                            <li><a href="#Changes between version 3.0 and 3.1">Changes between version 3.0 and 3.1</a></li>
                                                                                            <li><a href="#Changes between version 2 and 3">Changes between version 2 and 3</a></li>
                                                                                            <li><a href="#Changes between version 1 and 2">Changes between version 1 and 2</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Terms Used in This Document">Terms Used in This Document</a>
                                                                                                        </li>
                                                            <li><a href="#Overall Architecture">Overall Architecture</a>
                                                                                                        </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_installguide">Installation Guide</a> 
                                                    [<a href="installguide.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Server installation">Server installation</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#1. Check prerequisites">1. Check prerequisites</a></li>
                                                                                            <li><a href="#2. Unpack SignServer">2. Unpack SignServer</a></li>
                                                                                            <li><a href="#3. Set environment variables">3. Set environment variables</a></li>
                                                                                            <li><a href="#4. Setup database">4. Setup database</a></li>
                                                                                            <li><a href="#5. Configure web server keystores">5. Configure web server keystores</a></li>
                                                                                            <li><a href="#6. Configure application server">6. Configure application server</a></li>
                                                                                            <li><a href="#7. Configure build">7. Configure build</a></li>
                                                                                            <li><a href="#8. Build and deploy SignServer">8. Build and deploy SignServer</a></li>
                                                                                            <li><a href="#9. Accessing SignServer">9. Accessing SignServer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Signer setup">Signer setup</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Loading signers">Loading signers</a></li>
                                                                                            <li><a href="#Quick start demo setup">Quick start demo setup</a></li>
                                                                                            <li><a href="#Quick start demo Timestamp signer">Quick start demo Timestamp signer</a></li>
                                                                                            <li><a href="#Quick start demo PDF signer">Quick start demo PDF signer</a></li>
                                                                                            <li><a href="#Quick start demo XML validator">Quick start demo XML validator</a></li>
                                                                                            <li><a href="#Quick start demo MRTD SOD signer">Quick start demo MRTD SOD signer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Upgrade">Upgrade</a>
                                                                                                        </li>
                                                            <li><a href="#Historic Installation Guides">Historic Installation Guides</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Clustered SignServer 3.0 CentOS 4.4 Installation Guide">Clustered SignServer 3.0 CentOS 4.4 Installation Guide</a></li>
                                                                                            <li><a href="#Clustered SignServer 2.0 CentOS 4.4 Installation Guide">Clustered SignServer 2.0 CentOS 4.4 Installation Guide</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_usageguide">Usage Guide</a> 
                                                    [<a href="usageguide.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Introduction">Introduction</a>
                                                                                                        </li>
                                                            <li><a href="#Configuration/Administration">Configuration/Administration</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Administration CLI">Administration CLI</a></li>
                                                                                            <li><a href="#Database CLI">Database CLI</a></li>
                                                                                            <li><a href="#Administration GUI">Administration GUI</a></li>
                                                                                            <li><a href="#Working with Workers">Working with Workers</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Making the SignServer highly-available">Making the SignServer highly-available</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#HTTP access requires a load balancer">HTTP access requires a load balancer</a></li>
                                                                                            <li><a href="#Setting up a MySQL Cluster">Setting up a MySQL Cluster</a></li>
                                                                                            <li><a href="#Healthcheck">Healthcheck</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_integration">Integration</a> 
                                                    [<a href="integration.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#JavaDoc">JavaDoc</a>
                                                                                                        </li>
                                                            <li><a href="#Client Web Service">Client Web Service</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Operations">Operations</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#The old Web Services interface">The old Web Services interface</a>
                                                                                                        </li>
                                                            <li><a href="#Java Client API">Java Client API</a>
                                                                                                        </li>
                                                            <li><a href="#SigningAndValidation API">SigningAndValidation API</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Sample Code">Sample Code</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Web Server Interface">Web Server Interface</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#GenericProcessServlet">GenericProcessServlet</a></li>
                                                                                            <li><a href="#WorkerServlet">WorkerServlet</a></li>
                                                                                            <li><a href="#SODProcessServlet">SODProcessServlet</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Client Command Line Interface (CLI)">Client Command Line Interface (CLI)</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#signdocument">signdocument</a></li>
                                                                                            <li><a href="#validatedocument">validatedocument</a></li>
                                                                                            <li><a href="#timestamp">timestamp</a></li>
                                                                                            <li><a href="#validatecertificate">validatecertificate</a></li>
                                                                                            <li><a href="#signdatagroups">signdatagroups</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Administration Web Service">Administration Web Service</a>
                                                                                                        </li>
                                                            <li><a href="#Apache HTTP Server as proxy">Apache HTTP Server as proxy</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Example: Rewrite URLs for TSA (using mod_proxy and mod_rewrite)">Example: Rewrite URLs for TSA (using mod_proxy and mod_rewrite)</a></li>
                                                                                            <li><a href="#Example: Rewrite URLs and redirect to HTTPS (using AJP)">Example: Rewrite URLs and redirect to HTTPS (using AJP)</a></li>
                                                                                            <li><a href="#Example: Granting access to specific workers only">Example: Granting access to specific workers only</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_commonconf">Common configuration</a> 
                                                    [<a href="commonconf.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Setting Authorization Type">Setting Authorization Type</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#SignServer">SignServer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Archiving Responses">Archiving Responses</a>
                                                                                                        </li>
                                                            <li><a href="#Accounter">Accounter</a>
                                                                                                        </li>
                                                            <li><a href="#Checking validity of signer certificates">Checking validity of signer certificates</a>
                                                                                                        </li>
                                                            <li><a href="#Limiting the number of signatures">Limiting the number of signatures</a>
                                                                                                        </li>
                                                            <li><a href="#Other properties">Other properties</a>
                                                                                                        </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_plugins">Plugins</a> 
                                                    [<a href="plugins.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Configuring a plug-in">Configuring a plug-in</a>
                                                                                                        </li>
                                                            <li><a href="#SignServer Signers">SignServer Signers</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Common Properties">Common Properties</a></li>
                                                                                            <li><a href="#Time-stamp Signer">Time-stamp Signer</a></li>
                                                                                            <li><a href="#MS Authenticode Time Stamp Signer">MS Authenticode Time Stamp Signer</a></li>
                                                                                            <li><a href="#MRTD Signer">MRTD Signer</a></li>
                                                                                            <li><a href="#MRTD SOD Signer">MRTD SOD Signer</a></li>
                                                                                            <li><a href="#PDF Signer">PDF Signer</a></li>
                                                                                            <li><a href="#ODF Signer">ODF Signer</a></li>
                                                                                            <li><a href="#XML Signer">XML Signer</a></li>
                                                                                            <li><a href="#XAdES Signer">XAdES Signer</a></li>
                                                                                            <li><a href="#OOXML Signer">OOXML Signer</a></li>
                                                                                            <li><a href="#CMS Signer">CMS Signer</a></li>
                                                                                            <li><a href="#MS Authenticode Signer">MS Authenticode Signer</a></li>
                                                                                            <li><a href="#Master List Signer">Master List Signer</a></li>
                                                                                            <li><a href="#Plain Signer">Plain Signer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#SignServer Document Validators">SignServer Document Validators</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#XML Validator">XML Validator</a></li>
                                                                                            <li><a href="#XAdES Validator">XAdES Validator</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#SignServer Dispatchers">SignServer Dispatchers</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#FirstActiveDispatcher">FirstActiveDispatcher</a></li>
                                                                                            <li><a href="#RequestedPolicyDispatcher">RequestedPolicyDispatcher</a></li>
                                                                                            <li><a href="#UserMappedDispatcher">UserMappedDispatcher</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#SignServer Validation Service Framework">SignServer Validation Service Framework</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#DefaultValidationService">DefaultValidationService</a></li>
                                                                                            <li><a href="#Certificate Validators">Certificate Validators</a></li>
                                                                                            <li><a href="#The Validation CLI interface.">The Validation CLI interface.</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Timed Services">Timed Services</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#SignerStatusReportTimedService">SignerStatusReportTimedService</a></li>
                                                                                            <li><a href="#HSMKeepAliveTimedService">HSMKeepAliveTimedService</a></li>
                                                                                            <li><a href="#Installing a service">Installing a service</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Other workers">Other workers</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#CryptoWorker">CryptoWorker</a></li>
                                                                                            <li><a href="#RenewalWorker">RenewalWorker</a></li>
                                                                                            <li><a href="#StatusPropertiesWorker">StatusPropertiesWorker</a></li>
                                                                                            <li><a href="#TimeMonitorManager">TimeMonitorManager</a></li>
                                                                                            <li><a href="#TimeMonitorStatusReportWorker">TimeMonitorStatusReportWorker</a></li>
                                                                                            <li><a href="#SignerStatusReportWorker">SignerStatusReportWorker</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Available CryptoTokens">Available CryptoTokens</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#General properties">General properties</a></li>
                                                                                            <li><a href="#P12CryptoToken">P12CryptoToken</a></li>
                                                                                            <li><a href="#JKSCryptoToken">JKSCryptoToken</a></li>
                                                                                            <li><a href="#KeystoreInConfigCryptoToken">KeystoreInConfigCryptoToken</a></li>
                                                                                            <li><a href="#PrimeCardHSMCryptoToken">PrimeCardHSMCryptoToken</a></li>
                                                                                            <li><a href="#PKCS11CryptoToken">PKCS11CryptoToken</a></li>
                                                                                            <li><a href="#OldPKCS11CryptoToken">OldPKCS11CryptoToken</a></li>
                                                                                            <li><a href="#SoftCryptoToken">SoftCryptoToken</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Alias Selectors">Alias Selectors</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Available implementations">Available implementations</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Archivers">Archivers</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#OldDatabaseArchiver">OldDatabaseArchiver</a></li>
                                                                                            <li><a href="#Base64DatabaseArchiver">Base64DatabaseArchiver</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Accounters">Accounters</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#NoAccounter">NoAccounter</a></li>
                                                                                            <li><a href="#GlobalConfigSampleAccounter">GlobalConfigSampleAccounter</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_development">Development</a> 
                                                    [<a href="development.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Custom modules">Custom modules</a>
                                                                                                        </li>
                                                            <li><a href="#Custom sub modules">Custom sub modules</a>
                                                                                                        </li>
                                                            <li><a href="#Custom CLI">Custom CLI</a>
                                                                                                        </li>
                                                            <li><a href="#Plugin development">Plugin development</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Implementing Workers">Implementing Workers</a></li>
                                                                                            <li><a href="#Implementing Crypto Tokens">Implementing Crypto Tokens</a></li>
                                                                                            <li><a href="#Sample Workers and Components">Sample Workers and Components</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Other Customizations">Other Customizations</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#The IValidator Interface">The IValidator Interface</a></li>
                                                                                            <li><a href="#The IAuthorizer Interface">The IAuthorizer Interface</a></li>
                                                                                            <li><a href="#The Archiving API">The Archiving API</a></li>
                                                                                            <li><a href="#Using the Global Configuration Store">Using the Global Configuration Store</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Testing">Testing</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Automatic JUnit Tests">Automatic JUnit Tests</a></li>
                                                                                            <li><a href="#Random testing">Random testing</a></li>
                                                                                            <li><a href="#Stress testing">Stress testing</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                                     <li><a href="#ch_misc">Miscellaneous</a> 
                                                    [<a href="misc.html">Page</a>]
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#The Global Configuration Store">The Global Configuration Store</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#SignServer specific">SignServer specific</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Status Repository">Status Repository</a>
                                                                                                        </li>
                                                            <li><a href="#Logging">Logging</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Worker Log">Worker Log</a></li>
                                                                                            <li><a href="#System Log">System Log</a></li>
                                                                                            <li><a href="#CESeCore Security Events Logger">CESeCore Security Events Logger</a></li>
                                                                                            <li><a href="#Debug Log">Debug Log</a></li>
                                                                                            <li><a href="#Configure Log4j for Audit logs">Configure Log4j for Audit logs</a></li>
                                                                                            <li><a href="#Status Repository Logging">Status Repository Logging</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Database Command Line Interface">Database Command Line Interface</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Building">Building</a></li>
                                                                                            <li><a href="#Configuring">Configuring</a></li>
                                                                                            <li><a href="#Running">Running</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#SignServer without Database">SignServer without Database</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Configuration">Configuration</a></li>
                                                                                            <li><a href="#Structure of data">Structure of data</a></li>
                                                                                            <li><a href="#Migrating to/from database">Migrating to/from database</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#SignServer TimeMonitor">SignServer TimeMonitor</a>
                                                                                                        </li>
                                                            <li><a href="#Installation Packages">Installation Packages</a>
                                                                                                        </li>
                                                            <li><a href="#Contributed Howtos">Contributed Howtos</a>
                                                                                                        </li>
                                                            <li><a href="#References">References</a>
                                                                                                        </li>
                                                    </ul>

                    </li>


                             </ul>
                    </div>
        
            <div class="chapter">
    <h2>
      <a name="ch_introduction"></a>
      Introduction
    </h2>
      			          <div class="section">
    <h3>
      <a name="Introduction/scope"></a>
      Introduction/scope
    </h3>
      				  <p>
The SignServer is an application framework performing cryptographic operations
for other applications. It's intended to be used in environments where keys are
supposed to be protected in hardware but it isn't possible to connect such
hardware to existing enterprise applications or where the operations are
considered extra sensitive so the hardware have to protected more carefully.
Another usage is to provide a simplified method to provide signatures in
different application managed from one location in the company.
                </p>
	      				  <p>
The SignServer have been designed for high-availability and can be clustered for maximum
reliability.
                </p>
	      				  <p>
The SignServer comes with a RFC 3161 compliant Time-Stamp signer serving requests through
HTTP or client-authenticated HTTPS. A MRTD (Machine Readable Travel Document, i.e. electronic
passport) signer. A PDF signer that adds a signature automatically to a uploaded PDF document,
ODF signer that adds a signature automatically to uploaded ODF document, OOXML Signer that
adds signature automatically to a uploaded OOXML document, and a validation service used to
lookup the validation of a given certificate.
                </p>
	      				  <p>
                    <a href="../images/architecture.png"><img src="../images/architecture.png" align="middle" border="0" width="641" height="305" ALT="architecture" /></a><br />
                    Drawing 1: Overview of a possible set up of a highly available SignServer solution
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Major changes from previous versions"></a>
      Major changes from previous versions
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.6 and 3.7"></a>
        Changes between version 3.6 and 3.7
      </h4>
      				  <ul>
                        <li>Individual keys and certificates support</li>
                        <li>PKCS#11 libraries used by crypto tokens must be defined at deploy-time</li>
                        <li>Initial support for building using Maven</li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.5 and 3.6"></a>
        Changes between version 3.5 and 3.6
      </h4>
      				  <ul>
                        <li>Underlaying CESeCore library upgraded to version 6.1</li>
                        <li>Separation between community and enterprise editions</li>
                        <li>Separate worker and crypto tokens</li>
                        <li>New application: SignServer TimeMonitor (enterprise edition)</li>
                        <li>Querying of database archive from WS and GUI</li>
                        <li>HSM keep alive service</li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.4 and 3.5"></a>
        Changes between version 3.4 and 3.5
      </h4>
      				  <ul>
                        <li>Support for JBoss AS 7.1, JBoss EAP 6.1 and GlassFish 3.1</li>
                        <li>Support for MariaDB</li>
                        <li>Support for JDK 7</li>
                        <li>All worker configuration can now be done from the Admin GUI</li>
                        <li>Document signer and validator for XAdES-BES and XAdES-T</li>
                        <li>Support for different signature algorithms in XML signers</li>
                        <li>Various AdminGUI/remote administration improvements</li>
                        <li>Support for the group key framework has been discontinued</li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.3 and 3.4"></a>
        Changes between version 3.3 and 3.4
      </h4>
      				  <ul>
<!-- New major features -->
                        <li>Secure logging to database from CESeCore</li>
                        <li>Query audit log from CLI, GUI or over web services</li>
                        <li>See ChangeLog.txt and RELASE_NOTES.txt for details.</li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.2 and 3.3"></a>
        Changes between version 3.2 and 3.3
      </h4>
      				  <ul>
<!-- New major features -->
                        <li>New client web services API</li>
                        <li>MS Authenticode time-stamp signer</li>
                        <li>Support for archiving of time-stamp requests</li>
                        <li>Logging of all changes to service components</li>
                        <li>Stress test tool for measuring performance</li>
                        <li>Dropped support for JBoss 4.2.x.</li>
                        <li>Dropped support for cluster class loader</li>
                        <li>Dropped support for WSRA</li>
                        <li>Upgrade of cryptographic library</li>
                        <li>Many more minor changes and bug fixes. See 
                            ChangeLog.txt and RELASE_NOTES.txt for details.</li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.1 and 3.2"></a>
        Changes between version 3.1 and 3.2
      </h4>
      				  <ul>
<!-- New major features -->
                        <li>
A new administration web service (WS) for remote administration of SignServer.
                        </li>

                        <li>
A new administration GUI desktop application for managing workers. Supports
key generation and both local and remote administration.
                        </li>

                        <li>
A new client command line interface (CLI) for requesting signing and validation.
                        </li>

<!-- New support -->
                        <li>
Support for GlassFish Server 2.1.1.
                        </li>
                        <li>
Support for JBoss Application Server 5.1.
                        </li>

                        <li>
Support for Oracle Database.
                        </li>

<!-- New workers -->
                        <li>
Worker renewing signers by generating new keys and sending certificate requests
to EJBCA.
                        </li>

<!-- Improvements -->
                        <li>
Better audit and transaction logging.
                        </li>
                        <li>
New build scripts and project structure with the goal of decouple the different
SignServer modules and sub-projects and simplify future development.
                        </li>
                        <li>
Front page listing all demo web pages.
                        </li>

<!-- Other -->
                        <li>
The bundled SMTP server and MailSigner build of SignServer has been removed.
                        </li>

                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 3.0 and 3.1"></a>
        Changes between version 3.0 and 3.1
      </h4>
      				  <ul>
                        <li>
A new Cluster Class Loader, simplifying the management of customized workers in a
cluster. All the resource data including the classes themselves are stored in database and
accessible from all nodes simultaneously. It is also possible to run multiple versions of the
same worker in the same SignServer cluster, this is useful when migrating a worker to new
code since both the old and new worker can be run at the same time.
                        </li>
                        <li>
PDF Signer, Time-Stamp Authority and MRTD and their specific libraries have the
possibility to build into separate module archives (MAR files) that have to be uploaded to
the SignServer installation before usage, if the cluster classloader is enabled (default).
                        </li>
                        <li>
Installation packages for Linux/Windows of both SignServer and MailSigner using
generation software from Bitrock.
                        </li>
                        <li>
New extended module for signing ePassports: MRTD-SOD.
                        </li>
                        <li>
New modules for signing and validating XML documents.
                        </li>
                        <li>
A new ODF Signer module that adds signature to ODF documents, such as : odt,ods,odt
(tested with OpenOffice.org 3.1.0). Simple web page is added where ODF document can be
uploaded for signing, and resulted signed document downloaded.
                        </li>
                        <li>
A new OOXML Signer Module that adds signature to Office Open XML documents, such as
docx,xlsx,pptx (tested with Microsoft Office 2007).Simple web page is added where open
office xml document can be uploaded for signing, and resulted signed document
downloaded.
                        </li>
                        <li>
Validators for several document types as well.
                        </li>
                        <li>
Java 5 is no longer supported.
                        </li>
                        <li>
For minor changes see the change log at https://jira.primekey.se
                        </li>
                </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 2 and 3"></a>
        Changes between version 2 and 3
      </h4>
      				  <ul>
                        <li>
Complete refactorisation of J2EE from EJB2 to EJB3 to simplify further development.
                        </li>
                        <li>
Renamed component "Service" to "TimedService" since 3.0 supports other services.
                        </li>
                        <li>
A "TimedService" can now be configured with a 'cron-like' settings to have services
executed in other than just periodical intervals.
                        </li>
                        <li>
A Validation Service API used to validate certificate from different issuers. The Validation
Service API have it's own easy to use Web Service used to integrate with other platforms.
A Group Key Service API used to generate and manage group keys, symmetric or
asymmetric.
                        </li>
                        <li>
Possibility to have customized authorization of requests, not just the built in client certificate
authorization list.
                        </li>
                        <li>
The name SignToken is changed to CryptoToken and introduced a new concept of
ExtendedCryptoToken that supports symmetric operations.
                        </li>
                        <li>
The RMI-SSL interface have been removed and replaced with a JAX-WS interface with a
simple client framework supporting different load-balance or high availability policies.
                        </li>
                        <li>
All request data have changed from serialization to externalization to be easier to translate to
other platforms.
                        </li>
                        <li>
A completely new MailSigner API based upon the JAMES SMTP server to perform
automated cryptographic operations on e-mails very similar to the plug-ins for the
SignServer.
                        </li>
                        <li>
Java 1.4 is no longer supported.
                        </li>
                        <li>
A lot of new JUnit tests in the test suite.
                        </li>
                        <li>
A PDF Signer that can add a signature to a PDF document through a simple HTML
interface.
                        </li>
                        <li>
PKCS11 Crypto Token to connect to different PKCS11 implementations.
                        </li>
                    </ul>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Changes between version 1 and 2"></a>
        Changes between version 1 and 2
      </h4>
      				  <ul>
                        <li>
  signserver_server.property file have been removed and replaced with a global configuration
  store.
                        </li>
                        <li>
  It is now possible to dynamically add and remove available signers
                        </li>
                        <li>
  A new type of component, "Service" that is run on a timely basis, used to perform
  maintenance or report generation.
                        </li>
                        <li>
  Improved cluster deployment functionality.
                        </li>
                        <li>
  New CLI tools to batch configure the SignServer, and to backup a current configuration.
                        </li>
                        <li>
  This makes it possible to set-up a configuration in test environment, dump the configuration
  and configure the same it in production.
                        </li>
                    </ul>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Terms Used in This Document"></a>
      Terms Used in This Document
    </h3>
      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="1" rowspan="1"
      valign="top" align="left">
          Term
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Explanation
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Processable service performing signatures upon requests. This could be a ready made signer or a custom developed one.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Crypto Token (former Sign Token)
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Crypto Token is a name for the entity containing the private key and is responsible for its cryptographic operations. Each worker can contain a crypto token or reference a crypto token from an other worker.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Crypto Worker
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Is a worker not performing any operations on its own and instead only hosts a Crypto Token that can be referenced by other workers.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Extended Crypto Token
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          An enhanced Crypto Token with support for symmetric key operations.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PKCS11CryptoToken
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Crypto Token able to communicate with Hardware Security Modules through the standard PKCS11 interface.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          TimedService (former Service)
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A TimedService is a task that is run on a timely basis, performing maintenance tasks like changing active key or generate a report.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Worker
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A common name for Processable (Signer or other type of service) and TimedService
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Processable
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A type of worker that is used to process requests, i.e. not a TimedService.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Worker Configuration
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Each Worker can be configured with properties specific for that worker. There are two sets of worker configuration one "Active" that is used by the signer and one "current" which is the one configured by the administrator. The current configuration isn't used in production until the administrator issued the reload command. This makes it possible for the administrator to configure multiple properties and double-check them before they are actually used.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Global Configuration Store
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Is a dynamic store used to define available Workers and their Crypto Tokens. But other data that needs to be read globally could be set there as well. The global configuration properties are activated immediately. There are two different scopes for the store data, Global Scope and Node Scope.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Global Scope
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Data stored in the global configuration that can be read by all nodes in the cluster.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Node Scope
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Data that is node specific and can only be read within the same node.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Worker Id
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Unique identifier of a worker, an integer larger than 0
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Worker Name
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A name used as a human readable synonym for a Worker Id
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Validation Service 
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Processable that checks if a certificate is valid or not. Have a Default Validation Service implementation that should work in most cases.<br />A Validation Service should have one or more Validators configured.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Certificate Validator (former Validator)
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Certificate Validator is responsible for checking the status of one or more issuer's certificates. This could be as an OCSP client or a CRL checker or just looking up the status in a database.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Document Validator
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Document Validator is validating a signed document by checking its signature and corresponding certificate(s) and returns the validation result.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Authorizer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          An interface that enables developers to integrate the authorization parts with existing authorization systems of who is authorized to perform requests to a Processable.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Time Stamp Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that can be used to set up a Timestamp Authority according to RFC 3161. 
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          MRTD Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that performs signatures of MRTD (Machine Readable Travel Documents, i.e. Electronic Passports) blobs.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          MRTD SOD Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that creates the complete security object (SOd) for a MRTD (Machine Readable Travel Document, i.e. Electronic Passports) by signing the data groups.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PDF Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that attaches an electronic signature signature to a PDF document.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          XML Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that puts in an enveloped signature in XML documents (XMLDSig)
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          XML Validator
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Document Validator that validates signed XML documents (XMLDSig)
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          XAdES Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer signing XML documents using XAdES
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          ODF Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that attaches an electronic signature to an ODF document. ODF Signer is tested with documents produced by <a href="http://www.openoffice.org">OpenOffice.org v 3.1.0</a>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          ODF (Open Document Format) Document
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          XML-based file format for representing electronic documents such as spreadsheets, charts, presentations and word processing documents. <a href="http://en.wikipedia.org/wiki/OpenDocument">more...</a>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          OOXML (Office Open XML) Document
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          XML-based file format  for representing spreadsheets, charts, presentations and word processing documents. <a href="http://en.wikipedia.org/wiki/Office_Open_XML">more...</a>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          OOXML Signer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          A Signer that attaches an electronic signature to an OOXML document.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Archiver
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Implementation handling archiving of a worker's response and/or request by storing it in a database or similar.
                        
      </td>
      </tr>
        </table>
                </div>
          			          <div class="section">
    <h3>
      <a name="Overall Architecture"></a>
      Overall Architecture
    </h3>
      				  <p>
The SignServer is a framework designed to perform different kind of cryptographic operations for different applications.
                    </p>
	      				  <p>
Since the 3.0 version there are three kind of processable services. Signers (used to sign or in other way  process requested data). Validation Services used to verify the validity of a certificate against a set of backed issuers. The validation service can be used to simply the integration of PKIs into existing applications. In addition to processable services there also exists another concept called Timed Service (called just 'service' in 2.0 edition) which are plug-ins run at defined intervals performing maintenance or reporting routines.
                    </p>
	      				  <p>
The main way of communicating with the SignServer is through HTTP (web server) interface. There is also a web services (SOAP WS) interface available but that uses a special binary format for encoding the requests and responses.
                    </p>
	      				  <p>
For an overview of the different concepts in the SignServer see illustration 1. The base component is called Worker which is assigned an id, optionally a name and a configuration. A sub component is a Processable which receives and processes requests. A Processable (optionally) have access to a cryptographic token (CryptoToken) in charge of managing the keys of a Processable. A CryptoToken can be either software or hardware based.
                    </p>
	      				  <p>
The applications i administrated through a command-line interface, where the properties and access control can be configured.
                    </p>
	      				  <p>
One SignServer can have multiple services for different purposes.
                    </p>
	      				  <p>
                        <a href="../docs/SignServer_Manual_3_0_odt_18c42972.png"><img src="../docs/SignServer_Manual_3_0_odt_18c42972.png" align="middle" border="0" width="493" height="252" alt="SignServer components" /></a><br />
                        Illustration 1: Components in the SignServer project
                    </p>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_installguide"></a>
      Installation Guide
    </h2>
      			          <div class="section">
    <h3>
      <a name="Server installation"></a>
      Server installation
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="1. Check prerequisites"></a>
        1. Check prerequisites
      </h4>
      				  <p>
Make sure all required softwares are installed:
                    </p>
	      				  <ul>
                        <li>Java 6: OpenJDK 6 or Oracle JDK 6 Update 10 or later*<br />
                            Java 7: OpenJDK 7** or Oracle JDK 7*</li>
                        <li>Application server: JBoss 5.1.0.GA***, JBoss EAP 5.1, JBoss AS 7.1.1, JBoss EAP 6.1 or GlassFish Server Open Source Edition 2.1.1**** or 3.1.2</li>
                        <li>Database: MySQL or MariaDB 5.5, HypersonicSQL (bundled with JBoss 5), Oracle Database 10/11g or without*****</li>
                        <li>Build tool: Apache Ant 1.8.0 or later</li>
                    </ul>
	      				  <p>
* When using Oracle JDK you must install the 'Unlimited Strength Jurisdiction Policy Files' for JDK for the parts of SignServer that  makes use of strong crypto to work. The policy files can be found at the same place as the JDK download at Oracle. Further information on this can be found in the Oracle documentation on the JCE. <br />
** If the application server supports JDK 7. Works for GlassFish 3 and JBoss 7/EAP 6.<br />
*** JBoss 5.1.0.GA is available in two different versions (standard and JDK6) which differs in web services stacks. The one called JBoss 5.1.0.GA-JDK6 should be used.<br />
**** GlassFish version 2 support will be dropped in an upcoming version. Some features like KeystoreInConfigCryptoToken is not supported.<br />
***** See <a href="complete.en.html#SignServer%20without%20Database">SignServer without Database</a>
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="2. Unpack SignServer"></a>
        2. Unpack SignServer
      </h4>
      				  <p>
Download and unzip the
<a href="http://sourceforge.net/projects/signserver/files/signserver/">latest
SignServer release</a> archive from SourceForge or for the absolutely latest
unstable version checkout from the Subversion (SVN)
<a href="https://svn.cesecore.eu/svn/signserver/trunk/">repository</a>.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="3. Set environment variables"></a>
        3. Set environment variables
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="APPSRV_HOME"></a>
        *** APPSRV_HOME ***
      </h5>
      				  <p>
Set APPSRV_HOME to point to your application server installation (<code>/opt/jboss</code> could be a symbolic link).
                        </p>
	      				  <pre class="code">
export APPSRV_HOME=/opt/jboss
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="ANT_OPTS"></a>
        *** ANT_OPTS ***
      </h5>
      				  <p>
Set ANT_OPTS to give Ant more memory for building SignServer.
                        </p>
	      				  <pre class="code">
export ANT_OPTS=&quot;-Xmx512m -XX:MaxPermSize=128m&quot;
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNSERVER_HOME"></a>
        *** SIGNSERVER_HOME ***
      </h5>
      				  <p>
Set SIGNSERVER_HOME to point to your SignServer installation.
                        </p>
	      				  <pre class="code">
export SIGNSERVER_HOME=/opt/signserver
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNSERVER_NODEID"></a>
        *** SIGNSERVER_NODEID ***
      </h5>
      				  <p>
Set SIGNSERVER_NODEID to an unique ID for the server.
                        </p>
	      				  <pre class="code">
export SIGNSERVER_NODEID=node1
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="4. Setup database"></a>
        4. Setup database
      </h4>
      				  <p>
Skip this section and instead follow the instructions in 
<a href="complete.en.html#SignServer%20without%20Database">SignServer without Database</a> if
you decide to run SignServer without a database management system.
                    </p>
	      				  <p>
Create a database and user for SignServer. The application server will try to
create tables during startup of SignServer but if the database user does not
have table create permissions or if you run on GlassFish the tables must be
created manually. See doc/sql-scripts/create-tables-signserver34-*.sql.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="MariaDB binlog format configuration"></a>
        *** MariaDB binlog format configuration ***
      </h5>
      				  <p>
For MariaDB you will have to set binlog_format to "row", for instance in /etc/mysql/my.cnf:
                        </p>
	      				  <pre class="code">
binlog_format=row
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure database driver for JBoss 5 or GlassFish"></a>
        *** Configure database driver for JBoss 5 or GlassFish ***
      </h5>
      				  <p>
Copy the driver for your database to the application server lib folder.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure database driver for JBoss AS 7 or JBoss EAP 6"></a>
        *** Configure database driver for JBoss AS 7 or JBoss EAP 6 ***
      </h5>
      				  <p>
In JBoss 7/EAP6 it is not enough to just drop the JAR archive with a database JDBC driver into the deployments directory. Instead you will have to perform the following steps (for MySQL or MariaDB):
<ol>
<li>Create the necessary directories (relative to JBoss 7 base directory):
<br />
On JBoss 7.1.1 or EAP 6.0:
<pre>
mkdir -p modules/com/mysql/main/
</pre>
On JBoss 7.2 or EAP 6.1:
<pre>
mkdir -p modules/system/layers/base/com/mysql/main/
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
mkdir -p modules/org/mariadb/main/
</pre>
On JBoss 7.2 or EAP 6.1:
<pre>
mkdir -p modules/system/layers/base/org/mariadb/main/
</pre>
</li>
<li>Place the mysql.jar or mariadb.jar file in the directory you just created.</li>
<li>Create, in the created directory, the JDBC module configuration file module.xml with the following contents (replace mysql.jar with the full name of your jar file for example mysql-connector-java-5.1.18-bin.jar):
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="com.mysql"&gt;
  &lt;resources&gt;
    &lt;resource-root path="mysql.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
<!-- This is the original of above XML text.
<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="urn:jboss:module:1.0" name="com.mysql">
  <resources>
    <resource-root path="mysql.jar"/>
  </resources>
  <dependencies>
    <module name="javax.api"/>
    <module name="javax.transaction.api"/>
  </dependencies>
</module>
-->
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.mariadb"&gt;
  &lt;resources&gt;
    &lt;resource-root path="mariadb-java-client-1.1.2.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre>

</li>
<li>Register the driver by running the following two commands in the JBoss 7 CLI administration tool:
<pre>
/subsystem=datasources/jdbc-driver=com.mysql.jdbc.Driver:add(driver-name=com.mysql.jdbc.Driver,driver-module-name=com.mysql,driver-xa-datasource-class-name=com.mysql.jdbc.jdbc.jdbc2.optional.MysqlXADataSource)
:reload
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
/subsystem=datasources/jdbc-driver=org.mariadb.jdbc.Driver:add(driver-name=org.mariadb.jdbc.Driver,driver-module-name=org.mariadb,driver-xa-datasource-class-name=org.mariadb.jdbc.MySQLDataSource)
:reload
</pre>
</li>
</ol>
</p>
	      				  <p>For PostgreSQL you would use the following values instead:
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.postgresql"&gt;
  &lt;resources&gt;
    &lt;resource-root path="postgresql-9.1-903.jdbc4.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre>
<pre>
/subsystem=datasources/jdbc-driver=org.postgresql.Driver:add(driver-name=org.postgresql.Driver,driver-module-name=org.postgresql,driver-xa-datasource-class-name=org.postgresql.xa.PGXADataSource)
:reload
</pre>
</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss 5"></a>
        *** Configure data source for JBoss 5 ***
      </h5>
      				  <p>
This is done automagically by the SignServer build script later during "ant deploy".
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for GlassFish"></a>
        *** Configure data source for GlassFish ***
      </h5>
      				  <p>
For GlassFish also configure a connection pool and JNDI resource:
                    </p>
	      				  <ol>
                        <li>Go to the Admin Console: http://localhost:4848</li>
                        <li>Click on Resources -&gt; JDBC -&gt; Connection Pools</li>
                        <li>Add a new Pool. For instance: Name: MySQLPool</li>
                        <li>
                            Fill in:<br />
                            databaseName: signserver<br />
                            password: signserver<br />
                            portNumber 3306<br />
                            serverName: localhost<br />
                            user: signserver
                        </li>
                        <li>Click Ping to test</li>
                        <li>Click on Resources -&gt; JDBC -&gt; JDBC Resources</li>
                        <li>
                             Add new:<br />
                             JNDI Name: jdbc/SignServerDS<br />
                             Pool Name: MySQLPool
                         </li>
                        <ul />
                    </ol>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss AS 7.1"></a>
        *** Configure data source for JBoss AS 7.1 ***
      </h5>
      				  <p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>
	      				  <p>A normal datasource (Note: no --enabled=true for JBoss AS 7.1):</p>
	      				  <pre class="code">
data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot;
</pre>
	      				  <p>
Then restart the application server.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss EAP 6"></a>
        *** Configure data source for JBoss EAP 6 ***
      </h5>
      				  <p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>
	      				  <p>A normal datasource (Note: --enabled=true for JBoss EAP 6.x):</p>
	      				  <pre class="code">
data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot; --enabled=true
</pre>
	      				  <p>
Then restart the application server.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="5. Configure web server keystores"></a>
        5. Configure web server keystores
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 5 SSL configuration"></a>
        *** JBoss 5 SSL configuration ***
      </h5>
      				  <p>
For JBoss if you are going to protect the HTTP communication with SSL, you need
a JKS SSL server keystore. Rename the web server keystore to tomcat.jks and put
it in a 'p12' subdirectory. Place a keystore called truststore.jks in the 'p12' directory
containing the trusted root certificate(s).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="GlassFish SSL configuration"></a>
        *** GlassFish SSL configuration ***
      </h5>
      				  <p>
For GlassFish enable client authentication for http-listener-2 and manually
update the keystores with the right certificates.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7/EAP 6 SSL configuration"></a>
        *** JBoss 7/EAP 6 SSL configuration ***
      </h5>
      				  <p>
Copy the keystore file as JBOSS7_HOME/standalone/configuration/keystore/keystore.jks and the trust store as
                          JBOSS7_HOME/standalone/configuration/keystore/truststore.jks.
                        </p>
	      				  <p>
Configure interfaces using the approproate bind address (ie. 0.0.0.0 or 127.0.0.1).
                        </p>
	      				  <pre class="code">
/interfaces=/interface=http:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspub:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspriv:add(inet-address=&quot;0.0.0.0&quot;)
                        </pre>
	      				  <p>
Set-up the private port which requires client certificate. 
Use appropriate values for key-alias (hostname), password (keystore password), ca-certificate-password (truststore password),
and supported protocols.
                        </p>
	      				  <pre class="code">
/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port=&quot;8443&quot;,interface=&quot;httpspriv&quot;)
/subsystem=web/connector=httpspriv:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspriv, secure=true)
/subsystem=web/connector=httpspriv/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=verify-client, value=true)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-password, value=&quot;changeit&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-file, value=&quot;${jboss.server.config.dir}/keystore/truststore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;) 
                        </pre>
	      				  <p>
Set-up the public SSL port which doesn't require the client certificate.
Use appropriate values for key-alias (hostname), password (keystore password),
and supported protocols.
                        </p>
	      				  <pre class="code">
/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port=&quot;8442&quot;,interface=&quot;httpspub&quot;)
/subsystem=web/connector=httpspub:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspub, secure=true)
/subsystem=web/connector=httpspub/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;)
                        </pre>
	      				  <p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
	      				  <pre class="code">
:reload
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="6. Configure application server"></a>
        6. Configure application server
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix web service problem in JBoss 5"></a>
        *** Fix web service problem in JBoss 5 ***
      </h5>
      				  <p>
Edit jboss-beans.xml to force the endpoint URL to be generated based on the WSDL
request by commenting out the line:
                        </p>
	      				  <pre>
    &lt;property name="webServiceHost"&gt;${jboss.bind.address}&lt;/property&gt;
</pre>
	      				  <p>
For JBoss 5.1.0.GA the file is available under: server/default/deployers/jbossws.deployer/META-INF/
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix web service problem in JBoss AS 7/EAP 6"></a>
        *** Fix web service problem in JBoss AS 7/EAP 6 ***
      </h5>
      				  <p>
Configure WSDL web-host rewriting to use the request host. Needed for webservices to work correctly when requiring client certificate.
                        </p>
	      				  <pre class="code">
/subsystem=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)
/subsystem=webservices:write-attribute(name=modify-wsdl-address, value=true)
                        </pre>
	      				  <p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
	      				  <pre class="code">
:reload
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix JBoss 5 bug with Oracle JDK"></a>
        *** Fix JBoss 5 bug with Oracle JDK ***
      </h5>
      				  <p>
If you are using Oracle's JDK and JBoss 5.1.x you need to copy
SIGNSERVER_HOME/lib/ext/1.6/bc*.jar to JBOSS_HOME/server/default/lib/. Remember this
when it's time for upgrades! This is a bug tracked by JBoss as JBAS-7882.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7 and Oracle JDK BouncyCastle issues"></a>
        *** JBoss 7 and Oracle JDK BouncyCastle issues ***
      </h5>
      				  <p>
When using Oracle JDK and JBoss 7 you need to install BC jars as a module in JBoss 7. See <a href="https://issues.jboss.org/browse/JBAS-7882">JBAS-7882</a>.
                        </p>
	      				  <p>
How to install modules are described in <a href="https://docs.jboss.org/author/display/MODULES/Defining+a+module">docs.jboss.org/author/display/MODULES/Defining+a+module</a>.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue in JBoss 5"></a>
        *** Fix XML Security library issue in JBoss 5 ***
      </h5>
      				  <p>
JBoss 5 bundles an older version of the XML Security library which conflicts with the one included in SignServer.
Run the below Ant target to copy the SignServer version and its dependencies to the JBoss endorsed folder:
                        </p>
	      				  <pre class="code">
bin/ant j2ee:copy-xmlsec
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue 1 in JBoss 7"></a>
        *** Fix XML Security library issue 1 in JBoss 7 ***
      </h5>
      				  <p>
        JBoss 7 bundles version 1.5.1 of the XML Security library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR file from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
	      				  <p>
        On Linux/Unix systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        cp lib/ext/xmlsec-1.5.8.jar $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/
                                                </pre>
	      				  <p>
        On Windows systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        copy lib\ext\xmlsec-1.5.8.jar %APPSRV_HOME%\modules\org\apache\santuario\xmlsec\main\
                                                </pre>
	      				  <p>
        Edit $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/module.xml to use the correct version:
                                                </p>
	      				  <pre class="code">
        &lt;resource-root path=&quot;xmlsec-1.5.8.jar&quot;/&gt;
                                                </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue 2 in JBoss 7"></a>
        *** Fix XML Security library issue 2 in JBoss 7 ***
      </h5>
      				  <p>
        JBoss 7 bundles version 2.7.1 of the Xalan library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR files from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
	      				  <p>
        On Linux/Unix systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        cp lib/ext/xalan-2.7.2.jar lib/ext/serializer-2.7.2.jar $APPSRV_HOME/modules/org/apache/xalan/main/
                                                </pre>
	      				  <p>
        On Windows systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        copy lib\ext\xalan-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\
        copy lib\ext\serializer-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\
                                                </pre>
	      				  <p>
        Edit $APPSRV_HOME/modules/org/apache/xalan/main/module.xml to use the correct versions:
                                                </p>
	      				  <pre class="code">
        &lt;resource-root path=&quot;serializer-2.7.2.jar&quot;/&gt;
        &lt;resource-root path=&quot;xalan-2.7.2.jar&quot;/&gt;
                                                </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issues in JBoss EAP"></a>
        *** Fix XML Security library issues in JBoss EAP ***
      </h5>
      				  <p>
Make sure to apply the relevant security patches from Red Hat.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Install Hibernate in GlassFish 3"></a>
        *** Install Hibernate in GlassFish 3 ***
      </h5>
      				  <p>
If you are using GlassFish 3 and run with a database you will have to install Hibernate. 
Run pkg install in the GlassFish folder:
                        </p>
	      				  <pre class="code">
./bin/pkg install hibernate
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7/EAP 6 and PKCS11"></a>
        *** JBoss 7/EAP 6 and PKCS11 ***
      </h5>
      				  <p>
JBoss 7/EAP 6 isolates away most sun classes. That means you will not be able to send certificates through remote EJB calls, and will not be able to use the Sun PKCS#11 provider.
These classes can be made available by editing the file
<i>modules/sun/jdk/main/module.xml (JBoss 7.1/EAP6.0)</i> and adding the following packages to the list of system export paths:
                        </p>
	      				  <pre class="code">
&lt;path name=&quot;sun/security/x509&quot;/&gt;
&lt;path name=&quot;sun/security/pkcs11&quot;/&gt;
&lt;path name=&quot;sun/security/pkcs11/wrapper&quot;/&gt;
                        </pre>
	      				  <p>
This will allow an application to use these internal Sun/Oracle/OpenJDK classes.
                        </p>
	      				  <p>
This is not needed in JBoss EAP 6.1/JBoss 7.2, because the two first packages are exported by default since <a href="https://issues.jboss.org/browse/JBPAPP6-1748">JBPAPP6-1748</a>.
One package is however needed still. In JBoss EAP 6.1 the file is located in <i>modules/system/layers/base/sun/jdk/main/module.xml</i>.
                        </p>
	      				  <pre class="code">
&lt;path name=&quot;sun/security/pkcs11/wrapper&quot;/&gt;
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="7. Configure build"></a>
        7. Configure build
      </h4>
      				  <p>
Copy conf/signserver_deploy.properties.sample to conf/signserver_deploy.properties and open
it for editing in your favorite text editor.
                    </p>
	      				  <pre class="code">
cp conf/signserver_deploy.properties.sample conf/signserver_deploy.properties
                    </pre>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web GUI configuration"></a>
        *** Web GUI configuration ***
      </h5>
      				  <p>
Uncomment j2ee.web-nohttps=true if SignServer should be used to configure the
keystore in JBoss 5.
                        </p>
	      				  <pre class="code">
#j2ee.web-nohttps=true
                        </pre>
	      				  <p>
For GlassFish change httpserver.privhttps to a port configured with HTTPS and
client authentication.
                        </p>
	      				  <pre class="code">
httpserver.privhttps=8181
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Database configuration"></a>
        *** Database configuration ***
      </h5>
      				  <p>
For GlassFish make sure the datasource.jndi-name and datasource.jndi-name-prefix
matches the resource configured in the admin console.
                        </p>
	      				  <pre class="code">
datasource.jndi-name=SignServerDS
datasource.jndi-name-prefix=jdbc/
                        </pre>
	      				  <p>
Select database management system
                        </p>
	      				  <pre class="code">
database.name=mysql
                        </pre>
	      				  <p>
For JBoss set the database connection URL, database driver and username and
password.
                        </p>
	      				  <pre class="code">
database.url=jdbc:mysql://127.0.0.1:3306/signserver
database.driver=com.mysql.jdbc.Driver
database.username=signserver
database.password=signserver
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web Service Configuration"></a>
        *** Web Service Configuration ***
      </h5>
      				  <p>
Enable or disable the web services.
                        </p>
	      				  <pre class="code">
signserverws.enabled=true
genericws.enabled=true
validationws.enabled=true
adminws.enabled=true
clientws.enabled=true
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Modules Configuration"></a>
        *** Modules Configuration ***
      </h5>
      				  <p>
Enable all modules that should be built and choose if they should be included in the SignServer enterprise application archive (EAR). By setting includemodulesinbuild=true (default) all modules are built in. Otherwise for each module specify that it should be enabled and included:
                        </p>
	      				  <pre class="code">
module.xmlsigner.enabled=true
module.xmlsigner.include=true
...
                        </pre>
	      				  <p>
For GlassFish to enable debug logging include the Log4j module.
                        </p>
	      				  <pre class="code">
module.log4j.enabled=true
module.log4j.include=true
                        </pre>
	            </div>
	      				  <p>
See <a href="complete.en.html#Signed%20log">Signed log</a> for how to configure for signed audit logs in the database.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="8. Build and deploy SignServer"></a>
        8. Build and deploy SignServer
      </h4>
      				  <p>
Run "bin/ant build deploy" to build SignServer and deploy it to the selected application
server.
                    </p>
	      				  <pre class="code">
bin/ant clean build deploy
                    </pre>
	      				  <p>
Start the application server and verify that SignServer was deployed and
database tables were created. 
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="9. Accessing SignServer"></a>
        9. Accessing SignServer
      </h4>
      				  <p>
After startup a few different user interfaces are available.	
					</p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Command Line Interface"></a>
        *** Command Line Interface ***
      </h5>
      				  <pre class="code">
bin/signserver getstatus brief all
Assuming JBoss JNDI provider...
===========================================
Executing Command on host : localhost
===========================================


Current version of server is : SignServer 3.5.0alpha0
                    </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Graphical User Interface"></a>
        *** Graphical User Interface ***
      </h5>
      				  <pre class="code">
bin/signserver-gui
bin/signserver-gui -ws
						</pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web Interface"></a>
        *** Web Interface ***
      </h5>
      				  <p>
Point your web browser to <a href="http://localhost:8080/signserver">http://localhost:8080/signserver</a> for demo web pages and local documentation.
					</p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Signer setup"></a>
      Signer setup
    </h3>
      				  <p>
After server installation the different signers can be setup using the
SignServer CLI.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Loading signers"></a>
        Loading signers
      </h4>
      				  <p>
Signers (and other workers) can be loaded by setting properties using "setproperty" or "setproperties" etc.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="setproperties"></a>
        *** setproperties ***
      </h5>
      				  <p>
The "setproperties" command loads all the properties from a property file that
can define one or many signers. The code for the signers needs to be deployed
to the application server together with SignServer either by setting
includemodulesinbuild=true to include all modules or by setting individual
module.MODULENAME.include=true properties in signserver_deploy.properties.
                        </p>
	      				  <pre class="code">
bin/signserver setproperties doc/sample-configs/CONFIGURATION.PROPERTIES
                        </pre>
	            </div>
	      				  <p>
After adding or changing a property for a worker (by
any of the "setpropery" or "setproperties" commands) the configuration needs be
applied by issuing the reload command with the ID of the worker.
                    </p>
	      				  <pre class="code">
bin/signserver reload 4711
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo setup"></a>
        Quick start demo setup
      </h4>
      				  <p>
This is a quick start guide to quickly get you setup with a crypto token and a set of workers/signers for testing and demonstration purposes.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Setup a sample crypto token"></a>
        *** Setup a sample crypto token ***
      </h5>
      				  <p>Set up a crypto token called CryptoTokenSoft which uses a hard coded software keystore:</p>
	      				  <code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties</code>
	      				  <p>
Activate the configuration using the assigned worker ID that was printed (for instance 1):
                        </p>
	      				  <code>$ bin/signserver reload 1</code>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Add sample workers"></a>
        *** Add sample workers ***
      </h5>
      				  <p>
Workers can then be set up using the setproperties followed by the reload command. Sample configurations
are available in doc/sample-configs which by default uses the sample crypto token:
                        </p>
	      				  <code>$ bin/signserver setproperties doc/sample-configs/CONFIGURATION.properties</code>
	      				  <p>
Activate the configuration using the assigned worker ID that was printed (for instance 2):
                        </p>
	      				  <code>$ bin/signserver reload 2</code>
	      				  <p>See the following section for some example for specific workers.</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo Timestamp signer"></a>
        Quick start demo Timestamp signer
      </h4>
      				  <p>
This is a quick start guide to quickly get you setup with a demo Time Stamp service (TSA according to RFC3161). It will let you quickly get a feeling how the structure of the SignServer works, so you can move on to more advanced features described in the manual.
                    </p>
	      				  <ol>
                        <li>
Make sure the tsa module is built in by setting module.tsa.enabled=true and
module.tsa.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the Timestamp demo configuration and notice the generated worker ID (in this
example 2):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_timestamp_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 2</code>
                        </li>
                        <li>
You can check the status and configuration with:<br />
<code>$ bin/signserver getstatus complete all</code>
                        </li>
                        <li>
Run the test client to see that everything is up:<br />
<code>$ bin/signclient timestamp http://localhost:8080/signserver/process?workerName=TimeStampSigner</code>
<br />The message "TimeStampRequest validated" should appear once a second. Also
check JBOSS_HOME/server/default/log/server.log or
GLASSFISH_HOME/domains/domain1/logs/server.log that successful messages appear.
                        </li>
                    </ol>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo PDF signer"></a>
        Quick start demo PDF signer
      </h4>
      				  <p>
To install the PDF signer you can issue the following commands (either instead of the TSA or in addition to the TSA).
                    </p>
	      				  <ol>
                        <li>
Make sure the pdfsigner module is built in by setting module.pdfsigner.enabled=true and
module.pdfsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the PDF signer demo configuration and notice the generated worker ID (in this
example 3):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_pdfsigner_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 3</code>
                        </li>
                        <li>
You can check the status and configuration with:<br />
<code>$ bin/signserver getstatus complete all</code>
                        </li>
</ol>
	      				  <p>
You can now, with your web browser, access the URL <a href="http://localhost:8080/signserver/demo/pdfsign.jsp">http://localhost:8080/signserver/demo/pdfsign.jsp</a> to get PDF documents signed.
</p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo XML validator"></a>
        Quick start demo XML validator
      </h4>
      				  <p>
An XML validator validates the signature of an XML document. It uses a
certificate validation service worker for validating the certificate so
that worker has to be configured first.
                    </p>
	      				  <p>
To install a certificate validation service worker issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Load the configuration and notice the worker ID (in this example: 6):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_validator_dummy_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 6</code>
<br />
                        </li>
                        <li>
The status of the Worker can now be viewed with:<br />
<code>$ bin/signserver getstatus complete CertValidationWorker</code>
<br />
                        </li>
                    </ol>
	      				  <p>
Then to install the XML validator you can issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Make sure the xmlvalidator module is built in by setting module.xmlvalidator.enabled=true and
module.xmlvalidator.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Load the XML validator demo configuration and notice the generated worker ID (in this
example 7):
<br />$ bin/signserver setproperties doc/sample-configs/qs_xmlvalidator_configuration.properties
                        </li>
                    <li>
Verify the configuration with (notice that VALIDATIONSERVICEWORKER is set to "CertValidationWorker"):<br />
<code>$ bin/signserver getconfig 7</code>
<br />
                    </li>
                    <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 7</code>
<br />
                    </li>
                    <li>
The status of the Validator can now be viewed with:<br />
<code>$ bin/signserver getstatus complete DemoXMLValidator</code>
<br />
                    </li>
                    </ol>
	      				  <p>
Now <a href="integration.html">the SignServer APIs</a> can be used to request XML documents to be validated by the DemoXMLValidator worker.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo MRTD SOD signer"></a>
        Quick start demo MRTD SOD signer
      </h4>
      				  <p>
The MRTD SOD signer takes as input data group hashes and creates a signed SO(d). This means that the signserver will function
as a Document Signer for ePassports.</p>
	      				  <p>
To install the MRTD SOD signer you can issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Make sure the mrtdsodsigner module is built in by setting module.mrtdsodsigner.enabled=true and
module.mrtdsodsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the MRTD SOD signer demo configuration and notice the generated worker ID (in this
example 8):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_mrtdsodsigner_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 8</code><br />
                        </li>
                        <li>
The status of the signer can now be viewed with:<br />
<code>$ bin/signserver getstatus complete mrtdsodsigner</code><br />
                        </li>
                    </ol>
	      				  <p>
Now <a href="integration.html">the SignServer APIs</a> can be used to send MRTD SOD sign requests the MRTDSODSigner.
<br />
Also you can use the HTML page <a href="http://localhost:8080/signserver/demo/mrtdsodsign.jsp">http://localhost:8080/signserver/demo/mrtdsodsign.jsp</a> to enter requests and get the SOd back.
This HTML form also functions as a sample to show how you can make HTTP requests from the personalisation system to the Document Signer.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Production configuration with HSM"></a>
        *** Production configuration with HSM ***
      </h5>
      				  <p>
To install a production signer using an HSM instead of the CryptoTokenSoft, make 
a copy of doc/sample-configs/pkcs11-crypto-configuration.properties and configure
the necessary properties for the HSM and apply that file using setproperties and
reload with its worker ID.<br />
(note after changing properties in the file it needs to be loaded again
with setproperties)
                        </p>
	      				  <p>
Now when configuring a worker make sure to have the worker property CRYPTOTOKEN=CryptoTokenP11.
                        </p>
	      				  <p>
Before starting with an HSM installation you should read the about the
    <a href="plugins.html#PKCS11CryptoToken">PKCS11CryptoToken</a> in the plugins
section of the manual.
                        </p>
	      				  <pre class="code">
bin/signserver setproperties doc/sample-configs/pkcs11-crypto-configuration.properties
bin/signserver reload 9
bin/signserver setproperties doc/sample-configs/qs_mrtdsodsigner_configuration.properties
bin/signserver setproperty 10 CRYPTOTOKEN CryptoTokenP11
bin/signserver reload 10
bin/signserver activatecryptotoken 9 tokenpin
bin/signserver generatecertreq 9 &quot;C=SE,CN=MRTD SOD Signer&quot; SHA256WithRSA mrtdsodsigner.req
</pre>
	      				  <p>
Where 9 is the workerId that you got when running the 'setproperties' command for the pkcs11 crypto token.<br />
Tokenpin is the password for the HSM slot configured in the properties file.<br />
This will create a certificate request that you can get signed by your CA. When you have received the response you can import it and the CA certficate.
If you have the returned signer certificate as cert.pem and the CA certificate as cacert.pem, then:
                        </p>
	      				  <pre class="code">
cat cert.pem cacert.pem &gt; certchain.pem
bin/signserver uploadsignercertificate 10 glob cert.pem
bin/signserver uploadsignercertificatechain 10 glob certchain.pem
bin/signserver reload 9
</pre>
	      				  <p>
Hint: you can use EJBCA to create keys on a PKCS#11 HSM using clientToolBox.<br />
ejbcaClientToolBox.sh PKCS11HSMKeyTool generate /opt/ETcpsdk/lib/linux-x86_64/libcryptoki.so 2048 DSSignKey 5
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Upgrade"></a>
      Upgrade
    </h3>
      				  <p>
See SIGNSERVER_HOME/doc/RELEASE_NOTES.txt and UPGRADE.txt for information about upgrading from an earlier version of SignServer. 
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Historic Installation Guides"></a>
      Historic Installation Guides
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="Clustered SignServer 3.0 CentOS 4.4 Installation Guide"></a>
        Clustered SignServer 3.0 CentOS 4.4 Installation Guide
      </h4>
      				  <p>
Installation guide describing step-by-step how to setup a SignServer cluster on CentOS 4.4. Even if the document
is specific for this OS is should be quite easy to adopt it to other environments as well. It 
can be downloaded here either as <a href="../docs/SignServer_3_0_Installation_Guide.pdf">PDF</a> or viewed as
<a href="../docs/SignServer_3_0_Installation_Guide.html">HTML</a>
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Clustered SignServer 2.0 CentOS 4.4 Installation Guide"></a>
        Clustered SignServer 2.0 CentOS 4.4 Installation Guide
      </h4>
      				  <p>
Version 2.0 of the same documentation.<a href="../docs/SignServer_2_0_Installation_Guide.pdf">PDF</a> <a href="../docs/SignServer_2_0_Installation_Guide.html">HTML</a>
                    </p>
	            </div>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_usageguide"></a>
      Usage Guide
    </h2>
      			          <div class="section">
    <h3>
      <a name="Introduction"></a>
      Introduction
    </h3>
      				  <p>   
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Configuration/Administration"></a>
      Configuration/Administration
    </h3>
      				  <p>
The SignServer administration command line interface (Admin CLI) is started
using bin/signserver (or bin/signserver.cmd).
                </p>
	      				  <p>
Every worker is identified by an ID and an optional name that can be used in all
the CLI commands.
                </p>
	      				  <p>
It is possible to do configuration of a worker while it's in production. All
configuration commands are cached until a reload command is issued and the
configuration becomes active.
                </p>
	      				  <p>
There is a special property file for the cli interface called signserver_cli.properties defining which nodes that exists in the cluster. The properties are:
                </p>
	      				  <p>
<b>hostname.masternode</b> = Should only contain one of the nodes, specified as the default master node. Used by operations dealing with the database and where not all nodes in the cluster needs to be contacted. It is possible to override this setting in the CLI by using the -host &lt;host name&gt; parameter.
                </p>
	      				  <p>
<b>hostname.allnodes</b> = Should contain all the nodes in the cluster, separated by a ';'. Mainly used by the commands getStatus, activateCryptoToken and deactivateCryptoToken.
                </p>
	      				  <p>
Its possible to customize the CLI with your own code. How to do this is described in the development section.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Administration CLI"></a>
        Administration CLI
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="General Commands"></a>
        *** General Commands ***
      </h5>
      				  <p>
<b>getstatus:</b>
Returns the status of the given worker, it says if its crypto token is active or not and the loaded 'active' configuration. It is possible to get a <i>brief</i> summary or a <i>complete</i> listing for one worker or all configured workers. If all workers are displayed will also all the global configuration parameters be displayed.
                        </p>
	      				  <p>
<b>getconfig:</b>
Returns the current worker or global configuration depending on options.
                        </p>
	      				  <p>
For worker configuration observe that this configuration might not have been activated yet, not until a <i>reload</i> command is issued.
                        </p>
	      				  <p>
<b>setproperty:</b>
Sets a custom property used by the worker or crypto token, see reference for the given Worker and CryptoToken for available properties.
                        </p>
	      				  <p>
<b>getproperty:</b>
List the value of a worker or global property.
                        </p>
	      				  <p>
Usage:
                        </p>
	      				  <pre class="code">
signserver getproperty &lt;signerid | signerName | global | node&gt; &lt;propertykey&gt;
                        </pre>
	      				  <p>
<b>setproperties:</b>
Command used to batch a set of properties, both for the global and worker configuration.
It can be used to configure a Signer in a test environment, dump all the properties and upload it into production.
                        </p>
	      				  <p>
It reads all the configuration properties form a property file and depending on the contents of the key it sets the given property. All properties will be set  according to the following defined rule set.
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="1" rowspan="1"
      valign="top" align="left">
          Rule
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Comment
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Properties starting with id&lt;num&gt;.
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Will set the property to the value of the given id to the worker with the given id.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Properties starting with name&lt;name&gt;.
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Will set the property to a worker with the given name. (If the name doesn't exists a unique id will be generated and assigned).
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Property keys containing GENID&lt;NUM&gt;, example WORKERGENID1 or GLOB. WORKERGENID1
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
The SignServer will find a free unique id and assign substitute all GENID&lt;num&gt; with this id.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Properties starting with glob.
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Will set a global property with global scope.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Properties starting with node.
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Will set a global property with node scope.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Properties starting with -&lt;other prefix&gt;&lt;value&gt;
                                
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Will remove the property, either worker or global.
                                
      </td>
      </tr>
        </table>
          				  <p>
See the directory 'sample-configs' for examples.
                        </p>
	      				  <p>
<b>removeproperty:</b>
Removes a configured property
                        </p>
	      				  <p>
<b>dumpproperties:</b>
This tool will dump all configured properties for one or all workers in the system into a property file. If the configuration for one worker is dumped it can be used to transfer the configuration from one installation to another. If all configurations is dumped, it can be used as a backup tool.
                        </p>
	      				  <p>
<b>uploadsignercertificate:</b>
Used to upload the certificate when the worker only needs the actual signing certificate and not the entire chain.
                        </p>
	      				  <p>
<b>uploadsignercertificatechain:</b>
Used when uploading a complete certificate chain to the worker. Which command that is supposed to be used is depending on the worker and crypto token used.
                        </p>
	      				  <p>
<b>importcertificatechain:</b>
Used to import a certificate chain into a crypto token. It takes a worker ID of the crypto worker
(or a worker ID of a worker with the crypto token configured in the legacy way)
and a path pointing to a file containing the certificate chain and a key alias to import to.
This is currently supported by the PKCS11 and keystore crypto token implementations.
                        </p>
	      				  <p>
<b>generatecertreq:</b>
Used to generate a certificate request for a worker to be signed by a certificate authority. It takes
distinguished name and signature algorithm as parameters and writes the request in PEM format to
file. An optional key alias can be specified to generate a request given a specific key alias
from the crypto token.
                        </p>
	      				  <p>
<b>activatecryptotoken:</b>
Used to activate crypto tokens. Authentication code is usually the PIN used to unlock the keys on the HSM. Not used if the token is set to auto-activation.
                        </p>
	      				  <p>
<b>deactivatecryptotoken:</b>
Brings a crypto token off-line. Not used if token is set to auto-activation.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SignServer Specific Commands"></a>
        *** SignServer Specific Commands ***
      </h5>
      				  <p><b>Authorization Related</b></p>
	      				  <p>
These commands are used to configure the internal client certificate authorization when it is turned on. It controls which clients that is authorized to request a processable worker.
                        </p>
	      				  <p>
<b>addauthorizedclient:</b>
Adds a client certificate to a processable workers list of acceptable clients using this worker. Specify
certificate serial number in hex and the Issuer DN of the client certificate.
If DN components contains commas, these needs to be escaped with backslashes.
Alternatively a certificate file (PEM or DER format) can be specified,
from which the serial number and issuer DN is fetched.
                        </p>
	      				  <p>
Usage:
                        </p>
	      				  <pre class="code">
Example 1: signserver addauthorizedclient 1 EF34242D2324 &quot;CN=Test Root CA&quot;
Example 2: signserver addauthorizedclient 1 EF3456789ABC &quot;CN=Client,O=Test Organization,C=SE&quot;
Example 3: signserver addauthorizedclient 1 client.pem
                        </pre>
	      				  <p>
<b>removeauthorizedclient:</b>
Removes added client certificate entries.
                        </p>
	      				  <p>
<b>listauthorizedclients:</b>
Displays the current list of acceptable clients.
                        </p>
	      				  <p>
<b>renewsigner:</b>
Sends a request for renewal of the specified worker to the specified renewal worker. If the authcode parameter is omitted the command prompts for the password.
See also the section about the <a href="complete.en.html#RenewalWorker">RenewalWorker</a>.
                        </p>
	      				  <p><b>Database Related</b></p>
	      				  <p>
<b>resync:</b>
                        </p>
	      				  <p>
The 'resync' command is used after a SignServer had a complete database failure. When this happens  will the Global Configuration become in 'Off-line' mode and it's not possible for the nodes to communicate internally and the Global Configurations will not be in sync any more. After the database is up again can this command be sent to the node that have the most valid Global Configuration and write it to the database. After this will the Global Configuration be in 'On-line' mode again.
                        </p>
	      				  <p><b>Archive Related</b></p>
	      				  <p>
This commands can be used for processable workers that have archiving turned on. They 
are used to find specific archived responses. It's up to the implementation of the 
worker if it supports archiving or not and it is up to the chosen Archiver if it 
archives the data in way that it can be queried using this commands. For Archivers 
other than the default "OldDatabaseArchiver" and Base64DatabaseArchiver querying 
might have to be done directly in a database, filesystem or by some custom 
application.
                        </p>
	      				  <p>
<b>archive findfromarchiveid:</b>
Command used to extract archived data from database identified by the archive Id.
                        </p>
	      				  <p>
The Id depends on the worker, in case of the TSA is the TimeStampInfo serial number used.
The data is stored with the same file title as the archive id and with the file extension 
depending on the type of item, for instance ".request" or ".response".
                        </p>
	      				  <p>
<b>archive findfromrequestip:</b>
Used to extract all archived data requested from a specified IP address.
                        </p>
	      				  <p>
All data is stored as separate files with the archive id as file title and the file
extension depending on the type of item.
                        </p>
	      				  <p>
<b>archive findfromrequestcert:</b>
Used to extract all archived data requested from a client by specified it's certificates serial number and  issuer DN.
                        </p>
	      				  <p>
All data is stored as separate files with the archive id as file title and the file
extension depending on the type of item.
                        </p>
	      				  <p>
<b>archive query:</b>
Used to query contents of the archive. Actual archived data is not fetched by this command.
                        </p>
	      				  <p>
Usage:
                        </p>
	      				  <pre class="code">
signserver archive query -limit &lt;number&gt; [-criteria  \&quot;&lt;field&gt; &lt;op&gt; &lt;value&gt;\&quot; [-criteria...]] [-from &lt;index&gt;] [-header] [-request|-response]\n&quot;
        + &quot;&lt;field&gt; is a field name from the archive: archiveId, requestCertSerialNumber, requestIP, requestIssuerDN, signerid, time, type\n&quot;
        + &quot;&lt;op&gt; is a relational operator: GT, GE, LT, LE, EQ, NEQ, LIKE, NULL, NOTNULL\n&quot;
	+ &quot;-request shows only entries for requests\n&quot;
	+ &quot;-response shows only entries for responses\n&quot;
        + &quot;Example: signserver archive query -limit 10 -criteria \&quot;signerid EQ 1\&quot;\n&quot;
	+ &quot;Example: signserver archive query -limit 10 -criteria \&quot;signerid EQ 1\&quot; -request\n&quot;
        + &quot;Example: signserver archive query -limit 10 -criteria \&quot;time GT 1359623137000\&quot; -criteria \&quot;requestIP EQ 127.0.0.1\n&quot;
        + &quot;Example: signserver archive query -limit 10 -criteria \&quot;signerid EQ 1\&quot; -outpath /tmp/out\n\n&quot;
			</pre>
	      				  <p><b>Administrators Related</b></p>
	      				  <p>
<b>wsadmins -list:</b>
                        </p>
	      				  <p>
Lists administrator certificates (certificate serial number and issuer DN) for
administrators authorized to use the Admin Web Service interface to administrate
SignServer.
                        </p>
	      				  <p>
<b>wsadmins -add:</b>
                        </p>
	      				  <p>
Authorizes an administrator to use the Admin Web Service interface by
certificate serialnumber (in hexadecimal) and issuer DN with space after each comma
separating DN components. If DN components contains commas, these needs to be escaped with backslashes.
                        </p>
	      				  <p>
An example on how to enter the issuer DN when using a certificate issued from EJBCA with the default (as specified by EJBCA)
LDAP DN order:</p>
	      				  <pre class="code">C=SE, O=TestOrganization, CN=IssuingCA</pre>
	      				  <p>
An example using escaped DN components    
                        </p>
	      				  <pre class="code">C=SE, O=TestOrganization\, The, CN=IssuingCA\, The</pre>
	      				  <p>
This is the reversed order compared to how the issuer DN is stored in the certificate.
                        </p>
	      				  <p>
An example on how to enter the issuer DN when using a certificate issued from EJBCA with the Use LDAP DN order
option disabled:</p>
	      				  <pre class="code">CN=ReverseIssuingCA, O=TestOrganization, C=SE</pre>
	      				  <p>
Alternatively a certificate file can be specified, from which the serial number
and issuer DN will be taken.
                        </p>
	      				  <p>
Samples:
                        </p>
	      				  <pre class="code">
Example 1: signserver wsadmins -add -certserialno 123ABCDEF -issuerdn &quot;CN=Neo Morpheus, C=SE&quot;
Example 2: signserver wsadmins -add -cert wsadmin.pem
                        </pre>
	      				  <p>
<b>wsadmins -remove:</b>
                        </p>
	      				  <p>
Removes an administrator from the list of authorized administrators.
                        </p>
	      				  <p>
<b>wsadmins -allowany:</b>
                        </p>
	      				  <p>
Sets whether any administrator with a certificate accepted by the web server/proxy is authorized
or not. When set (true) it overrides the WSADMINS global property. Takes an optional boolean parameter, if left out sets to true (allow all).
This can be used for initial setup.
                        </p>
	      				  <p><b>Auditors Related</b></p>
	      				  <p>
<b>wsauditors -list:</b>
                        </p>
	      				  <p>
Lists auditor certificates (certificate serial number and issuer DN) for
administrators authorized to use the Admin Web Service interface to query the
audit log of SignServer.
                        </p>
	      				  <p>
<b>wsauditors -add:</b>
                        </p>
	      				  <p>
Authorizes an auditor to use the Admin Web Service interface by
certificate serialnumber (given in hexadecimal) and issuer DN.
                        </p>
	      				  <p>
<b>wsauditors -remove:</b>
                        </p>
	      				  <p>
Removes an auditor from the list of authorized administrators.
                        </p>
	      				  <p><b>Archive Auditors Related</b></p>
	      				  <p>
<b>wsarchiveauditors -list:</b>
                        </p>
	      				  <p>
Lists archive auditor certificates (certificate serial number and issuer DN) for
auditors authorized to use the Admin Web Service interface to query the
archive of SignServer.
                        </p>
	      				  <p>
<b>wsarchiveauditors -add:</b>
                        </p>
	      				  <p>
Authorizes an auditor, by specifying a certificate serial number (in hexadecimal) and issuer DN, to use the Admin Web Service interface for querying the archive.
                        </p>
	      				  <p>
<b>wsarchiveauditors -remove:</b>
                        </p>
	      				  <p>
Removes an auditor from the list of authorized archive auditors.
                        </p>
	      				  <p>
<b>auditlog -query:</b>
                        </p>
	      				  <p>
Query the CESeCore audit log.
                        </p>
	      				  <p>
Usage:
                        </p>
	      				  <pre class="code">
signserver auditlog -query -limit &lt;number&gt; [-criteria  &quot;&lt;field&gt; &lt;op&gt; &lt;value&gt;&quot; [-criteria...]] [-from &lt;index&gt;] [-header]
                        </pre>
	      				  <p>
-limit sets the maximum number of rows matched, this option is required to avoid putting too much load on the server.
                        </p>
	      				  <p>
&lt;field&gt; is a field name from the audit log: additionalDetails, authToken, customId, eventStatus, eventType, module, nodeId,
searchDetail1, searchDetail2, sequenceNumber, service, timeStamp.
                        </p>
	      				  <p>
&lt;op&gt; is a relational operator: GT, GE, LT, LE, EQ, NEQ, LIKE, NULL, NOTNULL
                        </p>
	      				  <p>
When given the -header option, a column header is outputted before the results.
                        </p>
	      				  <p>
If databaseprotection.enableverify is enabled at the server side the signature 
of each row displayed are verified. If the verification fails for any of the 
rows matching the search criteria, an error message is displayed. The error message contains 
information about the first row that failed.
                        </p>
	      				  <p>
<b>querytokenentries:</b>
                        </p>
	      				  <p>
Queries the entries (key alias, certificates etc) in a CryptoToken.
If no limit is given all entries are queried and printed (10 at a time).
You can specify to start query from an index in the result.
Search conditions can be added to only search for entries with certain key aliases.
                        </p>
	      				  <p>
Usage:
                        </p>
	      				  <pre class="code">
signserver querytokenentries -token &lt;id or name&gt; -limit &lt;number&gt; [-criteria  &quot;&lt;field&gt; &lt;op&gt; &lt;value&gt;&quot; [-criteria...]] [-from &lt;index&gt;] [-v]
                        </pre>
	      				  <p>
-limit sets the maximum number of rows matched, this option is required to avoid putting too much load on the server.
                        </p>
	      				  <p>
&lt;field&gt; is a field name from the token: alias
                        </p>
	      				  <p>
&lt;op&gt; is a relational operator: EQ, NEQ or LIKE
                        </p>
	      				  <p>
-v means verbose and if given outputs also entry type as well as any certificates or additional information available in each entry
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Database CLI"></a>
        Database CLI
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This is a SignServer Enterprise Edition (EE) feature.
                    </div>
</div>
	      				  <p>
The SignServer Database CLI uses Java Persistence API (JPA) to connect to the 
SignServer database. The CLI is configured by the dbcli.* properties in 
signserver_cli.properties.
                    </p>
	      				  <p>
The CLI needs to have the JDBC driver of the selected database available on the 
classpath. This can be achieved by setting the OPTIONAL_CLASSPATH environment 
variable when calling the bin/signserver-db script or by putting the JAR under
lib/ext/jdbc/ and calling it jdbc.jar. The last method is required to be able 
to run the JUnit tests. 
                    </p>
	      				  <p>
Sample usage:
                    </p>
	      				  <pre class="code">
bin/signserver-db audit
                    </pre>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Verify Auditlog Command"></a>
        *** Verify Auditlog Command ***
      </h5>
      				  <pre class="code">
Usage: verifylog -all
       verifylog [-node NODENAME[:OFFSET] ...]

Verifies logs from all nodes starting at sequence number 0 or only from the specified nodes and optional sequence number offsets specified.
If the nodename is suffixed with a colon and an number then the verification for that node is started from that sequence number.
The JDBC connector of the database might have to be put on the classpath. See the example below.

Example: a) signserver-db audit verifylog -all
Example: b) signserver-db audit verifylog -node server1 -node server2:708
Example: c) OPTIONAL_CLASSPATH=/usr/share/java/mysql-connector-java.jar signserver-db audit verifylog -all
                        </pre>
	      				  <p>
The command can be run to verify the signature of every entry in the auditlog 
as well as checking the sequence number in order to make sure that it does not 
contain any gaps.
                        </p>
	      				  <p>
The keys used to verify the log are configured in conf/databaseprotection.properties.
                        </p>
	      				  <p>
Sample output:
                        </p>
	      				  <pre class="code">
2013-07-04 15:29:10,073 INFO  [VerifyLogCommand] The following nodes exists: [server1, server2]
2013-07-04 15:29:10,074 INFO  [VerifyLogCommand] Start sequences: {server1=0, server2=0}
2013-07-04 15:29:10,635 INFO  [SoftCryptoToken] Invalid authentication code. Token id=400.
2013-07-04 15:29:10,716 INFO  [SoftCryptoToken] Activated Crypto Token with id 400.
2013-07-04 15:29:10,722 INFO  [VerifyLogCommand] Progress: node=server1 rowCount=3
2013-07-04 15:29:10,722 INFO  [VerifyLogCommand] Last sequence number: 2
2013-07-04 15:29:10,745 INFO  [VerifyLogCommand] Progress: node=server2 rowCount=11
2013-07-04 15:29:10,745 INFO  [VerifyLogCommand] Last sequence number: 7
2013-07-04 15:29:10,747 INFO  [VerifyLogCommand] Audit log validation completed in 0 seconds. 11 rows found. Errors: 0 Warnings: 0
2013-07-04 15:29:10,747 INFO  [VerifyLogCommand] Verification finished with success
2013-07-04 15:29:10,747 INFO  [VerifyLogCommand] Last sequences: {server1=2, server2=7}
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Archiving of the audit log"></a>
        *** Archiving of the audit log ***
      </h5>
      				  <p>
As the Database CLI audit verifylog command checks for gabs in the sequence numbering entries from the audit log can not be archived/moved to other storage without special care.
However since the command now supports the option to specify from which sequence number to start the verification the following scheme for archiving is proposed:                            
                        </p>
	      				  <ol>
                            <li>
Run the command to verify the complete log audit log:
<pre class="code">audit verifylog -all</pre>
Note down the last sequence number for each node. Ie:
<pre class="code">Last sequences: {server1=2, server2=7}</pre>
                            </li>
                            <li>
All entries from 0 up to the entry before the last can now be archived and removed from the database. In our example that would be entry 0 and 1 for node server1 and entries from 0 to 6 for node server2.                                
                            </li>
                            <li>
The next time the log should be verified start the verification from the last sequence numbers:
<pre class="code">audit verifylog -node server1:2 -node server2:7</pre>
Again note down the last sequence number for each node and all entries up to the sequence number before the last for each node can now be archived.
                            </li>
                        </ol>
	      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
It is important to not remove the row with the last sequence number for any node as if the application is restarted the sequence numbering would than start again from 0 for that node.
                        </div>
</div>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Administration GUI"></a>
        Administration GUI
      </h4>
      				  <p>
As a complement to the command line interface there is also a graphical user
interface for managing some of the most basic administrative tasks.
                    </p>
	      				  <p>
The SignServer AdminGUI is built by default (unless the property admingui.enabled is set to the value "false" in signserver_deploy.properties),
and can be started using the script bin/signserver-gui.
                    </p>
	      				  <p>
On startup, the connect to SignServer dialog offers the possibility to either
connect to a locally running SignServer instance or a remote one over web
services. If the "-ws" command line option is specified the later option is
already selected when the dialog opens.
                    </p>
	      				  <p>
See also the <a href="#Admin%20GUI%20troubleshooting">Admin GUI troubleshooting</a> section.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Connect to SignServer dialog"></a>
        *** Connect to SignServer dialog ***
      </h5>
      				  <p>
First select either to connect to a local or remote instance. If a remote one
is selected then also specify URL to SignServer server as well as keystore and
truststore for setting up the HTTPS connection.
Then click the button <b>Connect</b>.
By clicking the button <b>Load defaults</b> the settings from
the file default_connect.properties is loaded. The current settings are stored 
to connect.properties and displayed the next time the dialog is openned.
                        </p>
	      				  <p>
<b>Connect to</b>: Select to either connect to a "Local SignServer" using the
EJB interface or a "Remote SignServer" using web services on the specified URL.
                        </p>
	      				  <p>
<b>Web Service URL</b>: Base URL to the SignServer server. Default: https://localhost:8443/signserver
                        </p>
	      				  <p>
<b>Truststore Type</b>: Type of the truststore. Should match the choosen
truststore file (if any). Options are: "Use keystore", JKS, PKCS12 or PEM. If
"Use keystore" is choosen the trusted certificates are instead taken from the
keystore and no truststore is used.
                        </p>
	      				  <p>
<b>Truststore file path</b>: Path to the truststore file (if any).
                        </p>
	      				  <p>
<b>Truststore password</b>: Password of the truststore file (if any).
                        </p>
	      				  <p>
<b>Keystore Type</b>: Type of the keystore. Should match the choosen keystore file
path. Options are: JKS, PKCS12 or PKCS11. If PKCS11 is choosen the keystore file
path should be the path to the PKCS#11 shared library file.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window"></a>
        *** Main window ***
      </h5>
      				  <p>
The SignServer Administration GUI main window consists of a menu bar, a toolbar,
the working area and at the bottom a status bar. The working area constists of a
left and right part where the left is a list of all configured workers and the
right shows details for the selected workers (if any).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Menu bar"></a>
        *** Main window: Menu bar ***
      </h5>
      				  <p>
<b> File -&gt; Add Worker/Load Configuration?</b>: Opens the dialog to import a configuration or set-up a worker manually by specifying worker parameters. When selecting "Load from file" it is possible to load a configuration file. This is equivalent of the "setproperties" <a href="complete.en.html#Administration%20CLI">Admin CLI</a> command. Selecting "Add worker" enables setting up a worker from scratch by manually specifying a worker ID (the default selected will generate an ID dynamically), worker name, fully qualified class name for the implementation, and (optionally) a signer token implementation. Additional properties can be added using the table below. When the required parameters are given, the "Next" button will enable moving to the next step where additional manual editing of the resulting configuration can be made (the format is the same as the worker properties files). Clicking the "Apply" button from this stage will load the current configuration. The dialog can be dismissed in both states using the "Cancel" button.
			</p>
	      				  <p>
<b> File -&gt; Export...</b>: Opens the Export configuration dialog. This is the equivalent of the "dumpproperties" <a href="complete.en.html#Administration%20CLI">Admin CLI</a> command. The dialog gives the option to export all workers, the selected workers or none. In addition it also gives the option to include all global configurations not related to any worker (always enabled if no workers choosen for export). 
                        </p>
	      				  <p>
<b> File -&gt; Exit</b>: Exits the SignServer Administration GUI
                        </p>
	      				  <p>
<b> Edit -&gt; Activate</b>: Activates the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; deactivate</b>: Deactivates the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Renew key...</b>: Opens the Renew key dialog for the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Test key...</b>: Opens the Test key dialog for the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Generate CSR...</b>: Opens the Generate CSR dialog for the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Install certificates...</b>: Opens the Install certificates dialog for the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Renew signer...</b>: Opens the Renew signer dialog for the selected worker(s).
                        </p>
	      				  <p>
<b> Edit -&gt; Destroy key...</b>: Opens the Remove key dialog for the selected worker and asks for a key to remove from the crypto token.
                        </p>
	      				  <p>
<b> Edit -&gt; Remove worker...</b>: Removes the selected workers from the SignServer configuration.
                        </p>
	      				  <p>
<b> Edit -&gt; Reload from database...</b>: Reloads the global configuration or the selected workers from the database. This is only needed if the configuration was changed from an other node and the nodes uses a shared database.
                        </p>
	      				  <p>
<b> Edit -&gt; Global configuration...</b>: Opens the Global configuration window.
                        </p>
	      				  <p>
<b> Edit -&gt; Administrators...</b>: Opens the Administrators window.
                        </p>
	      				  <p>
Allows adding webservice administrators, auditors, and archive auditors.
The administrators can be added by explicitly entering the client certificate's
serial number in hexadecimal (leading zeroes and letter case is not significant)
and the issuer DN with space after each comma separating DN components.
If DN components contains commas, these needs to be escaped with backslashes.
                        </p>
	      				  <p>
An example using a certificate issued from EJBCA with the default (as specified by EJBCA) LDAP DN order:
                        </p>
	      				  <pre class="code">
C=SE, O=TestOrganization, CN=IssuingCA
</pre>
	      				  <p>
This is the reversed order compared to how the issuer DN is stored in the certificate.

An example using a certificate issued from EJBCA with the Use LDAP DN order option disabled:
                        </p>
	      				  <pre class="code">
CN=ReverseIssuingCA, O=TestOrganization, C=SE
</pre>
	      				  <p>
Alternatively a certificate file can be loaded, from which the serial number and issuer DN will be taken. 
                        </p>
	      				  <p>
<b> View -&gt; Refresh</b>: Refreshes the information about all workers.
                        </p>
	      				  <p>
<b> View -&gt; Status Summary...</b>: Switches to the Status Summary tab for the selected worker.
                        </p>
	      				  <p>
<b> View -&gt; Status Properties...</b>: Switches to the Status Properties tab for the selected worker.
                        </p>
	      				  <p>
<b> View -&gt; Configuration...</b>: Switches to the Configuration tab for the selected worker.
                        </p>
	      				  <p>
<b> View -&gt; Authorization...</b>: Switches to the Authorization tab for the selected worker.
                        </p>
	      				  <p>
Specify certificate serial number in hex and the Issuer DN of the client certificate.
If DN components contains commas, these needs to be escaped with backslashes.
Alternatively a certificate file (PEM or DER format) can be loaded, from which the serial number and issuer DN is fetched. 
                        </p>
	      				  <p>
<b> Help -&gt; About...</b>: Opens the about box doc.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Tool bar"></a>
        *** Main window: Tool bar ***
      </h5>
      				  <p>
<b>Refresh</b>: Refreshes the information about all workers.
                        </p>
	      				  <p>
<b>Activate</b>: Activates the selected worker(s).
                        </p>
	      				  <p>
<b>Deactivate</b>: Deactivates the selected worker(s).
                        </p>
	      				  <p>
<b>Renew key...</b>: Opens the Renew key dialog for the selected worker(s).
                        </p>
	      				  <p>
<b>Test key...</b>: Opens the Test key dialog for the selected worker(s).
                        </p>
	      				  <p>
<b>Generate CSR...</b>: Opens the Generate CSR dialog for the selected worker(s).
                        </p>
	      				  <p>
<b>Install certificates...</b>: Opens the Install certificates dialog for the selected worker(s).
                        </p>
	      				  <p>
<b>Renew signer...</b>: Opens the Renew signer dialog for the selected worker(s).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Status Summary Tab"></a>
        *** Main window: Status Summary Tab ***
      </h5>
      				  <p>
Displays the status summary for the selected worker in the same format as the
CLI command "signserver getstatus complete".
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Status Properties Tab"></a>
        *** Main window: Status Properties Tab ***
      </h5>
      				  <p>
Displays the status in properties format with the option of viewing details
for some properties such as for the certificates.
                        </p>
	      				  <p>
<b>Details...</b>: Selecting an property and clicking this button opens a dialog box
with more information for the property (if supported). Currently for certificates
this opens the Certificate details dialog.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Configuration Tab"></a>
        *** Main window: Configuration Tab ***
      </h5>
      				  <p>
Lists all the selected worker's configuration properties and gives the ability
to add, remove or edit properties.
                        </p>
	      				  <p>
<b>Add...</b>: Adds a new property to the selected worker.
                        </p>
	      				  <p>
<b>Edit</b>: Edit the selected property.
                        </p>
	      				  <p>
<b>Remove</b>: Removes the selected property.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Authorization Tab"></a>
        *** Main window: Authorization Tab ***
      </h5>
      				  <p>
Lists all the authorized client certificates for the selected worker. Notice 
that this only applies if the worker has the AUTHTYPE set to CLIENTCERT 
otherwise information about authorized clients might be taken from other sources.
If the checkbox "Allow any administrator with a valid certificate..." is selected, any user
with a valid certificate will be authorized. Having this enabled will override the administrators
added in the list above.
This is meant primarily for allowing a temporary certificate for setting up initial configuration. 
                        </p>
	      				  <p>
<b>Add...</b>: Adds a new authorized client. If the option 
"Apply changes to all selected workers" is checked the client is added to all 
the currently selected workers.
The "..." button can be used to read the values for serial number and issuer DN
from a certificate file in PEM or DER format. 
                        </p>
	      				  <p>
<b>Edit...</b>: Edits the selected authorized client. If the option 
"Apply changes to all selected workers" is checked the client is modified in all 
the currently selected workers.
                        </p>
	      				  <p>
<b>Remove</b>: Removes the selected client. If the option
"Apply changes to all selected workers" is checked the client is modified in all
the currently selected workers.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: CryptoToken Tab"></a>
        *** Main window: CryptoToken Tab ***
      </h5>
      				  <p>
The CryptoToken tab is only visible when selecting a worker that either is a CryptoWorker or is a worker that has crypto token configuration.
The tab allows quering of entries inside the crypto token as well as generating keys, certificate requests and importing certificates etc.
                        </p>
	      				  <p>
<b>First</b>: Go to the first search results page.
                        </p>
	      				  <p>
<b>Previous</b>: Go to the previous search results page.
                        </p>
	      				  <p>
<b>Reload</b>: Reloads the search result according the the current 
index and the selected number of entries per page.
                        </p>
	      				  <p>
<b>Next</b>: Go to the next search results page.
                        </p>
	      				  <p>
<b>Displaying results</b>: Displays the first row index and the last in the current result.
                        </p>
	      				  <p>
<b>Entries per page:</b>: The maximum number of rows to display in one page.
                        </p>
	      				  <p>
<b>Generate key...</b>: Opens the key generation dialog. 
Fill in the alias of the new key that should be generated as well as the key type (ie. RSA, DSA or ECDSA) as well as the the key specification (ie. key length such as "2048" for RSA and DSA or curve name such as "secp256r1" for ECDSA).
After filling in a key alias a new row will automatically added which allows for generating more keys.
                        </p>
	      				  <p>
Note that this dialog is different from the <a href="#Renew key dialog">Renew key dialog</a> as in this case the worker's next key property (NEXTCERTSIGNKEY) is not updated.
                        </p>
	      				  <p>
<b>Test</b>: Opens the <a href="#Test%20key%20dialog">Test key dialog</a> for the selected entry.
                        </p>
	      				  <p>
<b>Generate CSR...</b>: Opens the <a href="#Generate%20CSR%20dialog">Generate CSR dialog</a> with the key aliases of the selected entries filled in.
                        </p>
	      				  <p>
                            <b>Import certificates...</b>: Opens the <a href="#Install%20certificates">Install certificates</a> dialog for importing ceritificates to the selected token entries.
                        </p>
	      				  <p>
Note that installing certificates this way it is only possible to store the certificates in the token and the worker's current key (DEFAULTKEY) and next key (NEXTCERTSIGNKEY) properties are not updated.
                        </p>
	      				  <p>
<b>Remove</b>: Opens the <a href="#Remove%20key%20dialog">Remove key dialog</a> with the selected key aliases already filled in.
                        </p>
	      				  <p>
<b>Details...</b>: Opens the details window displaying more information about the token entry:
<ul>
    <li>Alias: The key alias</li>
    <li>Type: The type of entry, ie. private key, secret key or trusted certificate</li>
    <li>Creation date: If available the time and date the entry was created</li>
    <li>Certificate: If available, the subject DN of the end entity certificate. The View button opens a window where the certificates can be inspected.</li>
    <li>Key specification: If available, the key length or curve used</li>
    <li>Key algorithm: If available, the algorithm used for the key, ie RSA, DSA, ECDSA or AES etc.</li>
    <li>Additional information might be available depending on the crypto token implementation.</li>
</ul>
                        </p>
	      				  <p>
Double clicking or pressing the Enter key on a selected row opens the details window as well.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Audit log"></a>
        *** Main window: Audit log ***
      </h5>
      				  <p>
In the "Audit log" tab controls for querying and filter the audit log exists.
                        </p>
	      				  <ul>
<li><b>Current conditions</b>: Lists query conditions used to filter the search results.</li>
<li><b>Add</b>: Opens a dialog box for adding query conditions.</li>
<li><b>Remove</b>: Removes the selected query condition.</li>
<li><b>First</b>: Go to the first search results page.</li>
<li><b>Previous</b>: Go to the previous search results page.</li>
<li><b>Reload</b>: Loads or reloads the search result according the the current 
search condition(s), index and the selected number of entries per page.</li>
<li><b>Next</b>: Go to the next search results page.</li>
<li><b>Displaying results</b>: Displays the first row index and the last in the current result.</li>
<li><b>Entries per page:</b>: The maximum number of rows to display in one page.</li>
                        </ul>
	      				  <p>
Double clicking or pressing the Enter key on a selected row opens a window 
showing details for the row.
                        </p>
	      				  <p>
If databaseprotection.enableverify is enabled at the server side the signature 
of each row displayed are verified. If the verification fails for any of the 
rows in a page, an error message is displayed. The error message contains 
information about the first row that failed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Main window: Archive"></a>
        *** Main window: Archive ***
      </h5>
      				  <p>
In the "Archive" tab controls for querying and filter the archive.
                        </p>
	      				  <ul>
<li><b>Current conditions</b>: Lists query conditions used to filter the search results.</li>
<li><b>Add</b>: Opens a dialog box for adding query conditions.</li>
<li><b>Remove</b>: Removes the selected query condition.</li>
<li><b>First</b>: Go to the first search results page.</li>
<li><b>Previous</b>: Go to the previous search results page.</li>
<li><b>Reload</b>: Loads or reloads the search result according the the current 
search condition(s), index and the selected number of entries per page.</li>
<li><b>Next</b>: Go to the next search results page.</li>
<li><b>Displaying results</b>: Displays the first row index and the last in the current result.</li>
<li><b>Entries per page:</b>: The maximum number of rows to display in one page.</li>
                        </ul>
	      				  <p>
When selection one or more rows from the search result, the "Fetch selected archive data items"
button is enabled. Clicking this button opens a dialog allowing to select a download directory
and downloading the archived data of the selected rows.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Renew key dialog"></a>
        *** Renew key dialog ***
      </h5>
      				  <p>
Generates new keys for all the listed workers. For this to work all workers should
have the same password. Key algorithm, Key specification and New key alias must
be specified if it is not taken from the worker's configuration.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Test key dialog"></a>
        *** Test key dialog ***
      </h5>
      				  <p>
Test keys for all the listed workers. It is optional to either test the current
key or the next key (if any) or all the keys in the keystore. For this to work
all workers should have the same password. The results shows for each key the
key alias, SUCCESS and the public key hash if the test signing succeded.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Generate CSR dialog"></a>
        *** Generate CSR dialog ***
      </h5>
      				  <p>
Generates certificate signing requests (CSR:s) in PKCS#10 format for all listed 
signers. In the key dropdown menu either the current key (Default key) or the next key
can be selected. It is also possible to manually enter a value in the field to
generate a CSR for a specific key alias in the crypto token.
Signature algorithm, subject distingueshed name (DN) and Filename must be 
specified if not already taken from the worker's configuration. The format of 
the request could either be a Standard CSR file or a CSR wrapped in PKCS#7/CMS 
signed object created by a RequestSigner. The with the last option is that at 
the CA the signature of the request can be verified.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Install certificates"></a>
        *** Install certificates ***
      </h5>
      				  <p>
Installs signer certificate and certificate chains for the listed workers and
if next key is choosen that key becomes the new default key.
                        </p>
	      				  <p>
At least one of "Signer certificate" and "Signer certificate chain" columns needs to be filled in.
If a file is chosen for "Signer certificate" then the first certificate from that file will be used as signer certificate. It will also be added to the beginning of the certificate chain (if it is not already there).
If a file is chosen for "Signer certificate chain" then all of the certificates from that file will be included in the certificate chain. The first certificate will be used as signer certificate (if a "Signer certificate" was not chosen).
                        </p>
	      				  <p>
If the "Install in token" check box is selected, the certificate chain will be
imported to the worker's crypto token (if the crypto token supports this operation).
When this is selected, the key alias to import the chain to in the token can
be manually entered in the key column. This is currently only supported for
keystore and PKCS11 crypto tokens.
                        </p>
	      				  <p>
<b>Signer certificate</b>: Browse for the signer certificate file in PEM format.
                        </p>
	      				  <p>
<b>Certificate chain</b>: Browse for the signer certificate chain file (or CA certificate(s)) in PEM
format.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Renew signer dialog"></a>
        *** Renew signer dialog ***
      </h5>
      				  <p>
Requests a Renewal worker to renew all the choosen and selected workers. The 
Renewal worker will generate a new key if there isn't already a next key available 
and then contact EJBCA using its web service interface to request a new certificate.
After recieving the new certificate it is installed and the next key becomes 
the current default key. Notice how the "Not valid after" date and possibly also
the Signings column changes and the Renewal checkbox gets unchecked after a
successfull renewal.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Remove key dialog"></a>
        *** Remove key dialog ***
      </h5>
      				  <p>
Enter the key alias of the key to remove from the crypto token. Note that 
multiple workers might be using the key. If the crypto token supports key 
removal the key will be deleted and it might not be possible to restore it.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Global configuration dialog"></a>
        *** Global configuration dialog ***
      </h5>
      				  <p>
Lists all the global configuration properties and gives the ability to add,
remove or edit properties.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Administrators dialog"></a>
        *** Administrators dialog ***
      </h5>
      				  <p>
Lists all the authorized WS administrators, auditors, and archive auditors and gives the ability to add,
remove or edit them.
It is also possible to get the serial number and issuer DN from a certificate file
in PEM or DER format by using the "From file" button.
                        </p>
	      				  <p>
If already connected over WS, it is possible to click the "Load current" button 
to fill in the values from the currently used administrator certificate.
                        </p>
	      				  <p>
If the "Allow any aministrator with a valid certificate" is checked all 
administrators are given access even if they are not present in the list. This 
is for instance useful when first setting up the system. After adding your 
administrators the checkbox can be unchecked. It is recommended to add your self 
using the "Load current" button to be sure the correct information is filled in 
before disabling access for admins not in the list.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Admin GUI troubleshooting"></a>
        *** Admin GUI troubleshooting ***
      </h5>
      				  <ul>
                            <li>
                                <p>
<b>AdminGUI login using smartcard fails on 64-bit (x86_64) version of Windows</b>:<br />
The 64-bit version of Oracle Java does not support PKCS#11. A 32-bit version of Java and the PKCS#11 shared library should be used instead on that platform.
                                </p>
                            </li>
                            <li>
                                <p>
<b>AdminGUI login using smartcard fails if path to DLL contains parenthesis</b>:<br />
For instance the following path would cause problem: c:\program files (x86)\middleware\pkcs11.dll<br />
The problem is Java <a href="http://bugs.java.com/bugdatabase/view_bug.do?bug_id=7196009">bug 7196009</a>.<br />
Until this has been fixed you will need to install the middleware (PKCS#11/smartcard library) to a path without parenthesis.
                                </p>
                            </li>
                            <li>
                                <p>
<b>IPv6 dualstack can give permission denied when trying to connect from AdminGUI</b>:<br />
Trying to connect to SignServer over web services using the AdminGUI on Windows where both IPv4 and IPv6 is available can give "permission denied".<br />
One workaround is to edit signserver-gui.cmd and adding the following to the command:<br />
-Djava.net.preferIPv4Stack=true
                                </p>
                            </li>
                            <li>
                                <p>
<b>AdminGUI login using smartcard fails most of the time with some cards</b>:
                                </p>
                                <p>
The card prompts for the PIN but then doesn't ask for which certificate to login with.
Instead an error message with the text "Received fatal alert: bad_certificate" is displayed.
This error message indicates that the server did not accept the provided certificate (ie, the issuer was not in the server's truststore). However, in this case the error could be because no certificate was possible to read from the card.
This has been observed with some type of smart cards.
                                </p>
                                <p>
A workaround that has been working in those cases are:
                                </p>
                                <ol>
                                    <li>Start the GUI without the card inserted</li>
                                    <li>Press Connect (without the card inserted)</li>
                                    <li>There will be an error message saying that "slotListIndex is 0 but token has 0 slots". Just ignore it.</li>
                                    <li>Now insert the card and press Connect again</li>
                                    <li>This time after the PIN prompt you are asked for which certificate to login with</li>
                                </ol>
                            </li>
                        </ul>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Working with Workers"></a>
        Working with Workers
      </h4>
      				  <p>
In SignServer operations are performed by workers. There can be many workers 
and each worker has its own configuration. Each worker is identified by an unique 
ID. A worker can also be configured with a name by setting the property NAME. 
After the configuration has been activated (by issuing reload with the worker ID) 
that name can also be used to address the worker.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configuring"></a>
        *** Configuring ***
      </h5>
      				  <p>
A worker is configured by setting properties for it. Specifically if the plugin
is built-in it is specified by setting the property CLASSPATH to the fully
qualified name of the class implementing the plugin.
                        </p>
	      				  <p>
The properties can be set manually using the setproperty command or by loading
them all at once from a configuration file using the setproperties command.
Sample configuration files are available in SIGNSERVER_HOME/sample-configs.
                        </p>
	      				  <p>
To setup a PDFSigner using the quick start configuration file issue the
following command:
                        </p>
	      				  <pre class="code">
bin/signserver setproperties sample-configs/qs_pdfsigner_configuration.properties
                        </pre>
	      				  <p>
Notice the created workerId and use it when applying the configuration using the
reload command:
                        </p>
	      				  <pre class="code">
bin/signserver reload WORKER-ID
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Remove Workers"></a>
        *** Remove Workers ***
      </h5>
      				  <p>
                    You can list which workers you have with the command:
                    </p>
	      				  <pre class="code">
bin/signserver getstatus brief all                    
                    </pre>
	      				  <p>
                    If will display for example:
                    </p>
	      				  <pre class="code">
===========================================
Executing Command on host : localhost
===========================================


Current version of server is : SignServer 3.3.0alpha0


Status of Signer with Id 1 is :
  SignToken Status : Offline
  Signings: 0
                    </pre>
	      				  <p>
                    You can remove the worker with Id 1 with the command:                    
					</p>
	      				  <pre class="code">
bin/signserver removeworker 1
bin/signserver reload all                    
                    </pre>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Making the SignServer highly-available"></a>
      Making the SignServer highly-available
    </h3>
      				  <p>
Here are some tips on configuration used to make the SignServer redundant. Usually is the SignServer set-up with three nodes (required minimum for MySQL cluster) where one node is a management node from were all deployment and administration is done and the other two services are service nodes processing the actual requests.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="HTTP access requires a load balancer"></a>
        HTTP access requires a load balancer
      </h4>
      				  <p>
HTTP based workers like the TSA can be clustered using a load balancer accessing a health check servlet returning the state of the SignServer. The basic settings of the health check servlet can be configured in the build configuration file but more advanced settings are done in 'src/web/healthcheck/WEB-INF/web.xml'. With the default settings will the servlet return the text 'ALLOK' when accessing the URL http://localhost:8080/signserver/healthcheck/signserverhealth. If something is wrong with the sign server will an error message be sent back instead.
                    </p>
	      				  <p>
The health check servlet can also be used to monitor the SignServer by creating a script that monitors the URL periodically for error messages.
                    </p>
	      				  <p>
Tip, heartbeat with ldirectord is a good solution for a load balancer and works well with the SignServer. KeepAlived is another open source solution.
                    </p>
	      				  <p>
The Main WebService using the Java client API manages the HA parts itself and then isn't a load balancer necessary.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Setting up a MySQL Cluster"></a>
        Setting up a MySQL Cluster
      </h4>
      				  <p>
The database backed of the SignServer can be made redundant using MySQL Cluster. Details on how to set-up the MySQL cluster can be found in the document <a href="../docs/SignServer_3_0_Installation_Guide.pdf">SignServer_3_0_Installation_Guide.pdf</a> that can be downloaded from <a href="http://www.signserver.org">www.signserver.org</a>.
More information about the MySQL Cluster can be found at
<a href="http://www.mysql.com/products/database/cluster/">http://www.mysql.com/products/database/cluster/</a>.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Healthcheck"></a>
        Healthcheck
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Setting up the Health check servlet"></a>
        *** Setting up the Health check servlet ***
      </h5>
      				  <p>
In SignServer there exists a health check service that can be used for health monitoring. It is also useful for cluster, as it can be checked by load balancers to determine if a node should be active in the cluster (healthy) or taken out of the cluster (unhealthy).
                    </p>
	      				  <p>
The servlet is located at the URL: http://localhost:8080/signserver/healthcheck/signserverhealth and configured in signserver_deploy.properties.
                    </p>
	      				  <p>
The following configuration parameters may be set to configure authorization and what the service checks: 
                    </p>
	      				  <p>
<source>healthcheck.authorizedips</source> - A semicolon-delimited list of IP addresses authorized to access
the healthcheck servlet, if the list contains the keyword "ANY", any IP address is authorized access (defaults to <source>127.0.0.1</source>).
                    </p>
	      				  <p>
<source>healthcheck.minimumfreememory</source> - Number of megabytes of memory that must be free before removing     
the node out of the cluster (defaults to 1).
                    </p>
	      				  <p>
<source>healthcheck.checkdbstring</source> - The string that should be used to do 
a minimal check that the database is working. May differ between databases.
(defaults to <source>Select count(*) from signerconfigdata</source>, the property is not used when running without database).
                    </p>
	      				  <p>
<source>healthcheck.maintenancefile</source> - The path to a file containing the maintenance state, this file is a
standard Java property file and should have a property (by default named <source>DOWN_FOR_MAINTENANCE</source>").
If this property has the value <source>true</source>, none of the standard health checks will be performed, and instead
the result will be a string of the form <source>MAINT: DOWN_FOR_MAINTENANCE</source>.
If this property is not set (or an invalid file is given), the maintenance functionallity is disabled.
                    </p>
	      				  <p>
<source>healthcheck.maintenancepropertyname</source> - The property name to be used in the maintenance file. This will also
affect the error message returned when in maintenance mode (the part of the string after <source>MAINT: </source>
(defaults to <source>DOWN_FOR_MAINTENANCE</source>).
                    </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available tests and responses"></a>
        *** Available tests and responses ***
      </h5>
      				  <ul>
                        <li>
                            <p>
<b>No errors</b><br />
If all tests passed the HTTP result code is "200 OK" and page contains only the text "ALLOK".
                            </p>
                        </li>
                        <li>
                            <p>
<b>Down for maintenance</b><br />
If the down for maintenance file indicates that the server is down for maintenance an HTTP response code in 5xx range is returned with an error page containing "MAINT: " followed of the name of the maintenance property as configured. No further checks are performed.
                            </p>
                        </li>
                        <li>
                            <p>
<b>Database test</b><br />
A test is performed that SignServer is able to query the database. When running without database a check is made that the configured directory is initialized correctly and is not empty. If anything failed one or more error messages are included in an error page returned with the HTTP response code in the 5xx range.
                            </p>
                        </li>
                        <li>
                            <p>
<b>Memory test</b><br />
Checks the available free memory. If anything failed an error message is included in an error page returned with the HTTP response code in the 5xx range.
                            </p>
                        </li>
                        <li>
                            <p>
<b>Workers test</b><br />
Each (non-disabled) worker is checked for a number of things. If anything failed one or more error messages are included in an error page returned with the HTTP response code in the 5xx range.
                            </p>
                            <ul>
                                <li><b>Token offline:</b> Workers having a crypto token can be reported as offline</li>
                                <li><b>Worker status and errors: </b> Each worker implementation can put different requirements on when it is status is considered to be offline.</li>
                                <li><b>Signer certificate:</b> Signers requiring a certificate are checked that they have a certificate matching the configured key-pair and that the certificate is valid according the certificate validity time and the configured minimum remaining validity time.</li>
                                <li><b>TimeStampSigner certificate missing EKU:</b> If a TimeStampSigner certificate does not include the required EKU its status is set to offline.</li>
                                <li><b>TimeStampSigner certificate not included in certificate chain</b> If a TimeStampSigner certificate chain property does not include the signer certificate its status is set to offline.</li>
                            </ul>
                        </li>
                        <li>
<b>Disabled workers</b><br />
Workers that are disabled by having the worker property DISABLED=true are not considered in the Health check report.
                        </li>
                    </ul>
	            </div>
	            </div>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_integration"></a>
      Integration
    </h2>
      			          <div class="section">
    <h3>
      <a name="JavaDoc"></a>
      JavaDoc
    </h3>
      				  <p>
                            The JavaDoc for SignServer is available at SIGNSERVER_HOME/doc/api/index.html
                            after running "ant javadoc".
                    </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Client Web Service"></a>
      Client Web Service
    </h3>
      				  <p>
The SignServer ClientWS interface can be used to request signings from SignServer.
            </p>
	      				  <p>
The WSDL file is located at the URL http://&lt;hostname&gt;:8080/signserver/ClientWSService/ClientWS?wsdl and locally in the sources under modules/SignServer-Client-ClientWS/xml-resources/web-service-references/ClientWS/wsdl/localhost_8080/signserver/ClientWSService/ClientWS.wsdl.
            </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Operations"></a>
        Operations
      </h4>
      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                            <p>
                                <b>
processData
                                </b>
                            </p>
                        
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                            <p>
Generic operation for request signing of any binary (or character) data.
                            </p>
                            <p>
Parameters:
                                <ul>
                                    <li>
<b>worker</b> (string)<br />
Name of worker in SignServer which should handle the request.
                                    </li>
                                    <li>
<b>metadata</b> (sequence of key-value pairs)<br />
Optional additional request data. For instance the PDFSigner accepts the PDF password as a request data.
                                    </li>
                                    <li>
<b>data</b> (base64Binary)<br />
The document/data to process.
                                    </li>
                                </ul>
                            </p>
                            <p>
Output:
                                <ul>
                                    <li>
<b>archiveId</b> (string)
                                        <br />
Identifier for the request if archiving was used.
                                    </li>
                                    <li>
<b>data</b> (base64Binary)<br />
The signed binary/document.
                                    </li>
                                    <li>
<b>metadata</b> (sequence of key-value pairs)<br />
Any optional additional response data.
                                    </li>
                                    <li>
<b>requestId</b> (integer)<br />
Identifier for the request/response.
                                    </li>
                                    <li>
<b>signerCertificate</b> (base64Binary)<br />
The signer certificate in binary format if available.
                                    </li>
                                </ul>
                            </p>
                            <p>
Faults:
                                <ul>
                                    <li>RequestFailedException</li>
                                    <li>InternalServerException</li>
                                </ul>
                            </p>
                        
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                            <p>
                                <b>
processSOD
                                </b>
                            </p>
                        
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                            <p>
Operation for requesting an SOD to be created and signed.<br />
The ePassport production system calls this operation to get an SOD for the supplied data groups.
                            </p>
                            <p>
Parameters:
                                <ul>
                                    <li>
<b>worker</b> (string)<br />
Name of worker in SignServer which should be used for constructing the SOD.
                                    </li>
                                    <li>
<b>metadata</b> (sequence of key-value pairs)<br />
Optional additional request data. Not used.
                                    </li>
                                    <li>
<b>sodData</b> (a sodRequest structure)<br />
The sodRequest should contain a sequence of datagroups (id 1-16 and their values),
optionally also the version of the LDS to use and the version of Unicode.
                                    </li>
                                </ul>
                            </p>
                            <p>
Output:
                                <ul>
                                    <li>
<b>archiveId</b> (string)
                                        <br />
Identifier for the request if archiving was used.
                                    </li>
                                    <li>
<b>data</b> (base64Binary)<br />
The SOD binary.
                                    </li>
                                    <li>
<b>metadata</b> (sequence of key-value pairs)<br />
Any optional additional response data.
                                    </li>
                                    <li>
<b>requestId</b> (integer)<br />
Identifier for the request/response.
                                    </li>
                                    <li>
<b>signerCertificate</b> (base64Binary)<br />
The signer (DS) certificate in binary format if available.
                                    </li>
                                </ul>
                            </p>
                            <p>
Faults:
                                <ul>
                                    <li>RequestFailedException</li>
                                    <li>InternalServerException</li>
                                </ul>
                            </p>
                        
      </td>
      </tr>
        </table>
                </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="The old Web Services interface"></a>
      The old Web Services interface
    </h3>
      				  <p>
The SignServerWS is the old web services interface now replaced by SignServer ClientWS. It was 
new to version 3.0 and at the time replaced the RMI-SSL interface from version 1.0 and 2.0 for two reasons, the RMI-SSL were based on a commercial library and it only worked for Java clients.
                    </p>
	      				  <p>
The SignServerWS WSDL file is located at the URL http://&lt;hostname&gt;:8080/signserver/signserverws/signserverws?wsdl
                    </p>
	      				  <p>
The interface has two calls, the main one is 'process' which takes a collection of process request to a processable worker and returns a collection of process responses, the second one is getStatus that performs a health check of the node and returns an OK message if the node is healthy.
                    </p>
	      				  <p>
                        <b>Notice:</b>
All though the SignServerWS interface uses web services the actual process data is base64 encoded byte arrays in a special binary format. You will have to lookup the Java source code for the exact format of the request and response data. An alternative is to instead use the much simpler <a href="#Web%20Server%20Interface">Web Server Interface</a> or the newer <a href="#Client%20Web%20Service">ClientWS interface</a>. 
                    </p>
	      				  <p>
The getStatus call can be used to implement high-availability towards the client. The Java client API described in the next section have built in support for different high availability policies.
                    </p>
	      				  <p>
It's possible to turn off the WebService interface by disabling it in the build configuration.
                    </p>
	      				  <p>
This interface is only supported using HTTPS. The reason is that JBoss 4 does not rewrite the protocol part of the WSDL URL so we had to hard code it for it to work with HTTPS. For details about this see <a href="https://jira.primekey.se/browse/DSS-327">DSS-327</a>. 
                    </p>
	      				  <p>
Since SignServer &gt;=3.2.1 it is possible to supply extra request data called RequestMetadata containing key/value pairs that can be used by the signers. For instance the PDFSigner uses this feature to let the client supply a PDF password. 
                    </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Java Client API"></a>
      Java Client API
    </h3>
      				  <p>
Built along with the WebService is a Java API that can be used by clients. It's available in the file lib/SignServer-Client-SignServerWS.jar (the old SignServerWS interface) and lib/SignServer-Client-ClientWS.jar (the ClientWS interface). 
                    </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SigningAndValidation API"></a>
      SigningAndValidation API
    </h3>
      				  <p>
				The SigningAndValidation API is a wrapper around the previous
				mentioned API in order to have a simplified interface that also
				is the same regardless if WebService or EJB Remote calls are used.
			</p>
	      				  <p>
				To use the API include the file lib/SignServer-Client-SigningAndValidationAPI.jar.
			</p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Sample Code"></a>
        Sample Code
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Signing and validating an XML document"></a>
        *** Signing and validating an XML document ***
      </h5>
      				  <pre class="code">
try {
    System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;p12/truststore.jks&quot;);
    System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;changeit&quot;);
  
    ISigningAndValidation signserver = new SigningAndValidationWS(&quot;localhost&quot;, 8442, true);

    // Document to sign
    byte[] unsigned = &quot;&lt;document&gt;&lt;name&gt;Some content&lt;/name&gt;&lt;/document&gt;&quot;.getBytes();
    byte[] signed;

    // Signing
    GenericSignResponse signResp = signserver.sign(&quot;DemoXMLSigner&quot;, unsigned);
    signed = signResp.getProcessedData();
    System.out.println(&quot;Signed: &quot; + new String(signed));

    // Validating
    GenericValidationResponse validateResp = signserver.validate(&quot;DemoXMLValidator&quot;, signed);
    System.out.println(&quot;Valid: &quot; + validateResp.isValid());

    if(validateResp.getSignerCertificate() != null) {
        if(validateResp.getSignerCertificate() instanceof X509Certificate) {
            X509Certificate signerCert = (X509Certificate) validateResp.getSignerCertificate();
            System.out.println(&quot;Signed by: &quot; + signerCert.getSubjectDN().getName());
        }
    }
} catch (Exception ex) {
    ex.printStackTrace();
}                                   </pre>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Web Server Interface"></a>
      Web Server Interface
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="GenericProcessServlet"></a>
        GenericProcessServlet
      </h4>
      				  <p>
				HTTP requests can be sent to the SignServer servlet GenericProcessServlet located at /signserver/process using
                                either POST or GET.
			</p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          URL:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>/signserver/process</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Method:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>GET</b> or <b>POST</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Request content-type:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>None</b>, <b>"x-www-form-urlencoded"</b>, <b>"multipart/form-data"</b> or <b>other<sup>*</sup></b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Request parameters:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>workerName</b> - Name of the worker that should handle the request. Required unless workerId specified.</li>
                                        <li><b>workerId</b> - Id of the worker that should handle the request. Required unless workerName specified.</li>
                                        <li><b>data</b> - The bytes that should be signed or validated. Required for x-www-form-urlencoded.</li>
                                        <li><b>filerecievefile</b> - File upload used with multipart/form-data.</li>
                                        <li><b>pdfPassword</b> - Password for changing PDF. This can also be specified using the generic meta data parameters described below, using the key "pdfPassword". Optional and only used by PDFSigner.</li>
                                        <li><b>REQUEST_METADATA</b> - Meta data to pass on. Specified in Java properties file syntax. Optional.</li>
                                        <li><b>REQUEST_METADATA.x</b> - Sets a meta data parameter with the key specified by x. Overrides a value using the same key specified in the REQUEST_METADATA map. Optional.</li>
                                        <li><b>encoding</b> - Encoding of the data field. Optional. By specifying "base64" SignServer Base64-decodes
                                        the data property before passing it to the worker.</li>
                                        <li><b>processType</b> - The type of request. Can be any of "signDocument", "validateDocument",
                                        or "validateCertificate". Optional. If not specified, defaults to "signDocument".</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response code:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>HTTP 200</b> (OK): The request was successfull</li>
                                        <li><b>HTTP 400</b> (Bad Request): The request could not be fulfilled. Some request data were missing or incorrect etc.</li>
                                        <li><b>HTTP 401</b> (Unauthorized): The worker requires user authentication</li>
                                        <li><b>HTTP 404</b> (Not Found): The requested workerName or workerId does not represent an existing worker</li>
                                        <li><b>HTTP 413</b> (Request Entity Too Large): The data field or uploaded file is too large. See the HTTP_MAX_UPLOAD_SIZE global configuration property.</li>
                                        <li><b>HTTP 500</b> (Internal Server Error): There was an internal error when processing the request. Typically indicating an configuration problem or unexpected error at the server side.</li>
                                        <li><b>HTTP 503</b> (Service Unavailable): The worker is not active, its crypto token is not activated or similar</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response content-type:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Depending on the worker, text/plain for the validators.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response content:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          The signed document for signers.<br />
                                A string starting with "VALID" or "INVALID" for document validators.
                                <sup>*</sup>Note to integrators: In future versions of SignServer there might be more information added after VALID/INVALID, such as a ;-separated list of addtional information or more lines with information.<br />
                                A ;-separated string containing
                                validation status code (see list below), valid purposes, status message, revocation reason (-1 if not revoked), and revocation date (empty when not revoked)
                                for certificate validators.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Validation status codes:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>VALID</b> The certificate is valid</li>
                                        <li><b>REVOKED</b> The certificate has been revoked</li>
                                        <li><b>NOTYETVALID</b> The certificate is not yet valid</li>
                                        <li><b>EXPIRED</b> The certificate has expired</li>
                                        <li><b>DONTVERIFY</b> The certificate doesn't verify</li>
                                        <li><b>CAREVOKED</b> The CA certificate has been revoked</li>
                                        <li><b>CANOTYETVALID</b> The CA certificate is not yet valid</li>
                                        <li><b>CAEXPIRED</b> The CA certificate has expired</li>
                                        <li><b>BADCERTPURPOSE</b> The certificate has no valid certificate purpose</li>
                                        <li><b>ISSUERNOTSUPPORTED</b> The issuer of the certificate is not supported</li>
                                    </ul>
                                
      </td>
      </tr>
        </table>
          				  <p>
                            <sup>*</sup> if the request content-type in a POST is specified as something else than "x-www-form-urlencoded" or
                            "multipart/form-data" the message body is not parsed but instead directly passed to the worker specified by workerName or workerId
                            in the URI's query string.
                        </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configuration"></a>
        *** Configuration ***
      </h5>
      				  <p><b>HTTP_MAX_UPLOAD_SIZE</b> = Global configuration property that can be set to specify the maximum size (in bytes) of the HTTP request (Defaut: 104857600).</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Samples"></a>
        *** Samples ***
      </h5>
      				  <ul>
                                <li>
                                    HTTP GET:<br />
                                    http://localhost:8080/signserver/process?workerName=DemoXMLSigner&amp;data=%3Croot%3Ehej2%3C/root%3E<br />
                                    http://localhost:8080/signserver/process?workerName=DemoXMLSigner&amp;encoding=base64&amp;data=PGhlajI%2Bb2s8L2hlajI%2BCg%3D%3D<br />
                                    <br />
                                </li>
                                <li>
                                    HTTP POST with multipart/form-data or x-www-form-urlencoded:<br />
                                    For example see /signserver/demo/xmlsign.jsp (multipart/form-data) and /signserver/demo/genericsign.jsp (x-www-form-urlencoded).<br />
                                    <br />
                                </li>
                                <li>
                                    HTTP POST with other content-type:<br />
                                    See the TimeStampClient.<br />
                                    <br />
                                </li>
                                <li>
                                    Samples of content output for certificate validation:<br />
                                    <ul>
                                        <li>VALID;;This certificate is valid;-1;</li>
                                        <li>ISSUERNOTSUPPORTED;;Issuer of given certificate isn't supported;-1;</li>
                                        <li>REVOKED;;This certificate is revoked;3;1376565200519</li>
                                    </ul>
                                </li>
                            </ul>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="WorkerServlet"></a>
        WorkerServlet
      </h4>
      				  <p>
				HTTP requests can be sent to the SignServer servlet WorkerServlet located at /signserver/worker/* using
                                either POST or GET.<br />
                Requests are forwarded to the GenericProcessServlet, except that the worker name is taken from the URL.<br />
                            Worker name or ID given through request parameters are ignored.
			</p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          URL:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>/signserver/worker/*</b> (* denotes a worker name)
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Method:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>GET</b> or <b>POST</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Request content-type:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>None</b>, <b>"x-www-form-urlencoded"</b>, <b>"multipart/form-data"</b> or <b>other<sup>*</sup></b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Request parameters:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>data</b> - The bytes that should be signed or validated. Required for x-www-form-urlencoded.</li>
                                        <li><b>filerecievefile</b> - File upload used with multipart/form-data.</li>
                                        <li><b>pdfPassword</b> - Password for changing PDF. Optionally and only used by PDFSigner.</li>
                                        <li><b>encoding</b> - Encoding of the data field. Optional. By specifying "base64" SignServer Base64-decodes
                                        the data property before passing it to the worker.</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response code:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>HTTP 200</b> (OK): The request was successfull</li>
                                        <li><b>HTTP 400</b> (Bad Request): The request could not be fulfilled. Some request data were missing or incorrect etc.</li>
                                        <li><b>HTTP 401</b> (Unauthorized): The worker requires user authentication</li>
                                        <li><b>HTTP 404</b> (Not Found): The requested workerName or workerId does not represent an existing worker</li>
                                        <li><b>HTTP 413</b> (Request Entity Too Large): The data field or uploaded file is too large</li> 
                                        <li><b>HTTP 500</b> (Internal Server Error): There was an internal error when processing the request. Typically indicating an configuration problem or unexpected error at the server side.</li>
                                        <li><b>HTTP 503</b> (Service Unavailable): The worker is not active, its crypto token is not activated or similar</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response content-type:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Depending on the worker
      </td>
      </tr>
        </table>
          				  	  <div class="subsubsection">
      <h5>
        <a name="Samples"></a>
        *** Samples ***
      </h5>
      				  <ul>
                                <li>
                                    HTTP GET:<br />
                                    http://localhost:8080/signserver/worker/DemoXMLSigner?data=%3Croot%3Ehej2%3C/root%3E<br />
                                    http://localhost:8080/signserver/worker/DemoXMLSigner?encoding=base64&amp;data=PGhlajI%2Bb2s8L2hlajI%2BCg%3D%3D<br />
                                    <br />
                                </li>
                            </ul>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="SODProcessServlet"></a>
        SODProcessServlet
      </h4>
      				  <p>
                            Servlet recieving HTTP POST requests containing data group hashes
                            and creates a MRTDSODSignerRequest and passes it to the specified
                            MRTDSODSigner. The response from the servlet is the signed security
                            object in binary format.
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          URL:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>/signserver/sod</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Method:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
           <b>POST</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Request parameters:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <ul>
                                        <li><b>workerName</b> - Name of the worker that should handle the request. Required unless workerId specified.</li>
                                        <li><b>workerId</b> - Id of the worker that should handle the request. Required unless workerName specified.</li>
                                        <li><b>dataGroup1 to dataGroup16</b> - The data group hashes that should be put in the SO(d). At least one required.</li>
                                        <li><b>encoding</b> - Encoding of the data group hash fields. Optional. By specifying "base64" SignServer Base64-decodes
                                        the data property before passing it to the MRTDSODSigner.</li>
                                        <li><b>ldsVersion</b> - Request a specific LDS version: "0107" for V1.7 or "0108" for V1.8. Optional. If not specified the version from the configuration is used. If version is V1.8 unicodeVersion also needs to be specified.</li>
                                        <li><b>unicodeVersion</b> - Unicode version to store in the SOd. Optional. Only supported if ldsVersion "0108" specified. Specify "040000" for Unicode version 4.0.0.</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response code:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          The same response codes as for the GenericProcessServlet are used.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Response content-type:
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>application/octet-stream</b>
      </td>
      </tr>
        </table>
          				  	  <div class="subsubsection">
      <h5>
        <a name="Samples"></a>
        *** Samples ***
      </h5>
      				  <ul>
                                <li>
                                    See /signserver/demo/mrtdsodsign.jsp.<br />
                                    <br />
                                </li>
                            </ul>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Client Command Line Interface (CLI)"></a>
      Client Command Line Interface (CLI)
    </h3>
      				  <p>
Requests can be sent to the workers using the Client CLI. After building
SignServer the script bin/client.sh can be run.
                    </p>
	      				  <pre class="code">
$ bin/signclient
INFO  usage: client &lt;signdocument | validatedocument | timestamp | validatecertificate | signdatagroups&gt;
                    </pre>
	      			      	  <div class="subsection">
      <h4>
        <a name="signdocument"></a>
        signdocument
      </h4>
      				  <p>
Request signing of a document using HTTP(s) or web services. 
                        </p>
	      				  <pre class="code">
usage: signdocument &lt;-workername WORKERNAME | -workerid WORKERID&gt;
                    [options]
Request a document to be signed by SignServer
 -data             Data to send to the worker.
 -host             Server name or IP address. Default: localhost
 -indir            Directory to read input files from. Required if
                   outdir specified. Can not be combined with infile
                   or outfile.
 -infile           File to read data to send to the worker from.
 -keyalias         Alias of the key in the keystore to use for
                   authentication.
 -keystore         Keystore with private key and certificate for
                   client certificate authentication.
 -keystorepwd      Password for reading the keystore.  If keystore is
                   specified but not this keystore password option,
                   the CLI will instead prompt for the password.
 -metadata         Additional meta data to send to the signer. The
                   parameters should be given in the form KEY=VALUE.
                   This option can be given multiple times.
 -onefirst         In batch mode, don't send all requests until the
                   first succeeds. This is primary to prevent too many
                   incorrect password attempts. Default if username
                   is provided and -startall not provided.
 -outdir           Directory to write output files to. Required if
                   indir specified. Can not be combined with infile
                   or outfile.
 -outfile          File to write the result to. If not specified the
                   result is written to stdout.
 -password         Password for authentication. If username is
                   specified but not this password option, the CLI
                   will instead prompt for the password.
 -pdfpassword      Password for changing the PDF (if required).
 -port             Server port. Default: 8080 (for HTTP), 8442 for
                   HTTPS and 8443 for HTTPS with client
                   authentication.
 -protocol         Method of interacting with SignServer. HTTP,
                   CLIENTWS or WEBSERVICES. Default: HTTP.
 -removefromindir  Specify this flag to have the successfully
                   processed input files removed from indir.
 -servlet          Servlet to call. Default /signserver/process
 -startall         In batch mode, send all requests at once, without
                   waiting for the first to succeed. Default unless
                   username is provided or -onefirst provided.
 -threads          Number of threads for sending the requests. Only
                   allowed in batch mode, ie when indir and outdir
                   are specified. Default: 1.
 -truststore       Keystore with trusted certificates to use with
                   HTTPS.
 -truststorepwd    Password for the keystore with trusted
                   certificates. If truststore is specified but not
                   this truststore password option, the CLI will
                   instead prompt for the password.
 -username         Username for authentication.
 -workerid         ID of worker which should perform the operation.
 -workername       Name of worker which should perform the operation.

Sample usages:
a) signdocument -workername XMLSigner -data &quot;&lt;root/&gt;&quot;
b) signdocument -workername XMLSigner -infile /tmp/document.xml
c) signdocument -workerid 2 -data &quot;&lt;root/&gt;&quot; -truststore truststore.jks
-truststorepwd changeit
d) signdocument -workerid 2 -data &quot;&lt;root/&gt;&quot; -keystore superadmin.jks
-truststorepwd foo123
e) signdocument -workerid 2 -data &quot;&lt;root/&gt;&quot; -metadata param1=value1
-metadata param2=value2
f) signdocument -workerid 3 -indir ./input/ -removefromindir -outdir
./output/ -threads 5
                        </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="validatedocument"></a>
        validatedocument
      </h4>
      				  <p>
Request a document to be validated.
                        </p>
	      				  <pre class="code">
usage: validatedocument &lt;-workername WORKERNAME | -workerid WORKERID&gt;
                        [options]
Request a document to be validated by SignServer
 -data             Data to send to the worker.
 -host             Server name or IP address. Default: localhost
 -infile           File to read data to send to the worker from.
 -keyalias         Alias of the key in the keystore to use for
                   authentication.
 -keystore         Keystore with private key and certificate for
                   client certificate authentication.
 -keystorepwd      Password for reading the keystore.  If keystore is
                   specified but not this keystore password option,
                   the CLI will instead prompt for the password.
 -metadata         Additional meta data to send to the signer. The
                   parameters should be given in the form KEY=VALUE.
                   This option can be given multiple times.
 -password         Password for authentication.
 -port             Server port. Default: 8080 (for HTTP), 8442 for
                   HTTPS and 8443 for HTTPS with client
                   authentication.
 -protocol         Method of interaction with SignServer.
                   WEBSERVICES, or HTTP. Default: WEBSERVICES.
 -servlet          URL to the webservice servlet. Default:
                   /signserver/signserverws/signserverws?wsdl
 -truststore       Keystore with trusted certificates to use with
                   HTTPS.
 -truststorepwd    Password for the keystore with trusted
                   certificates. If truststore is specified but not
                   this truststore password option, the CLI will
                   instead prompt for the password.
 -username         Username for authentication.
 -workerid         ID of worker which should perform the operation.
 -workername       Name of worker which should perform the operation.

Sample usages:
a) validatedocument -workername XMLValidator -data &quot;&lt;root&gt;&lt;Signature...
b) validatedocument -workername XMLValidator -infile /tmp/signed.xml
c) validatedocument -workerid 2 -infile /tmp/signed.xml -truststore
truststore.jks -truststorepwd changeit
d) validatedocument -workerid 2 -infile /tmp/signed.xml -keystore
superadmin.jks -truststorepwd foo123
e) validatedocument -workername XMLValidator -protocol HTTP -infile
/tmp/signed.xml
f) validatedocument -workername XMLValidator -infile /tmp/signed.xml -metadata param1=value1 -metadata param2=value2
                        </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="timestamp"></a>
        timestamp
      </h4>
      				  <pre class="code">
$ bin/signclient timestamp
usage: timestamp &lt;options&gt; [url]
 -base64                Give this option if the stored request/reply
                        should be base64 encoded, default is not.
 -certreq               Request signer certificate
 -help                  Print this message.
 -infile &lt;file&gt;         File containing message to time stamp.
 -inrep &lt;file&gt;          Input file containing an earlier stored base64
                        encoded response, to verify.You must specify the
                        verify flag also.
 -inreq &lt;file&gt;          Input file containing an earlier stored request to
                        use instead of creating a new. You must specify
                        the request flag also.
 -instr &lt;string&gt;        String to be time stamped, if neither instr or
                        infile is given, the client works in test-mode
                        generating it's own message.
 -keyalias &lt;arg&gt;        Alias of the key in the keystore to use for
                        authentication.
 -keystore &lt;arg&gt;        Keystore with private key and certificate for
                        client certificate authentication.
 -keystorepwd &lt;arg&gt;     Password for reading the keystore.  If keystore is
                        specified but not this keystore password option,
                        the CLI will instead prompt for the password.
 -outrep &lt;file&gt;         Output file to store the recevied TSA reply, if
                        not given the reply is not stored.
 -outreq &lt;file&gt;         Output file to store the sent TSA request, if not
                        given the request is not stored.
 -print                 Prints content of a request, response and/or token
 -reqpolicy &lt;oid&gt;       Request timestamp issued under a policy OID
 -signerfile &lt;file&gt;     Input file containing the PEM encoded certificate
                        of the TSA signer.Used to verify a stored
                        response.
 -sleep &lt;num&gt;           Sleep a number of milliseconds after each request.
                        Default 1000 ms.
 -truststore &lt;arg&gt;      Keystore with trusted certificates to use with
                        HTTPS.
 -truststorepwd &lt;arg&gt;   Password for the keystore with trusted
                        certificates. If truststore is specified but not
                        this truststore password option, the CLI will
                        instead prompt for the password.
 -url &lt;url&gt;             Url of TSA, e.g.
                        http://127.0.0.1:8080/signserver/process?workerId=
                        1.
 -verify                Give this option if verification of a stored reply
                        should be done, work together with inrep and
                        cafile. If given, no request to the TSA will
                        happen.

Sample usages:
a) timestamp -url http://localhost:8080/signserver/tsa?workerName=TimeStampSigner
b) timestamp -print -inreq query.tsq
c) timestamp -print -inrep reply.tsr
                        </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="validatecertificate"></a>
        validatecertificate
      </h4>
      				  <p>
Request a certificate to be validated by the specified service.
                        </p>
	      				  <pre class="code">
usage: Usage: java -jar validate.jar &lt;options&gt;

 -cert &lt;cert-file&gt;              Path to certificate file (DER or PEM)
                                (Required).
 -certpurposes &lt;certpurposes&gt;   A ',' separated string containing
                                requested certificate purposes.
 -der                           Certificate is in DER format.
 -help                          Display this info
 -hosts &lt;hosts&gt;           A ',' separated string containing the
                                hostnames of the validation service nodes.
                                Ex 'host1.someorg.org,host2.someorg.org'.
                                When using the HTTP protocol, only one
                                host name can be specified. (Required).
 -pem                           Certificate is in PEM format (Default).
 -port &lt;port&gt;                   Remote port of service (Default is 8080 or
                                8442 for SSL).
 -protocol &lt;protocol&gt;           Protocol to use, either WEBSERVICES or
                                HTTP. Default: WEBSERVICES.
 -service &lt;service-name&gt;        The name or id of the validation service
                                to process request. (Required)
 -silent                        Don't produce any output, only return
                                value.
 -truststore &lt;jks-file&gt;         Path to JKS truststore containing trusted
                                CA for SSL Server certificates.
 -truststorepwd &lt;password&gt;      Password to unlock the truststore.

The following values is returned by the program that can be used when scripting.
  -2   : Error happened during execution
  -1   : Bad arguments
   0   : Certificate is valid
   1   : Certificate is revoked
   2   : Certificate is not yet valid
   3   : Certificate have expired
   4   : Certificate doesn't verify
   5   : CA Certificate have been revoked
   6   : CA Certificate is not yet valid
   7   : CA Certificate have expired.
   8   : Certificate have no valid certificate purpose.

Sample usages:
a) validatecertificate -service CertValidationWorker -hosts localhost -cert
    certificate.pem
b) validatecertificate -service 5806 -hosts localhost -cert certificate.pem
    -truststore p12/truststore.jks -truststorepwd changeit
c) validatecertificate -service CertValidationWorker -hosts localhost
    -cert certificate.pem -protocol HTTP
                        </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="signdatagroups"></a>
        signdatagroups
      </h4>
      				  <p>
Sign the specified data groups and produce an SOd (MRTD).
                        </p>
	      				  <pre class="code">
$ bin/client.sh signdatagroups
usage: signdatagroups &lt;options&gt;
Request MRTD data groups to be signed
 -data &lt;arg&gt;            Data to send to the worker.
 -encoding &lt;arg&gt;        Encoding of the data option. None or base64.
                        Default: none.
 -host &lt;arg&gt;            Server name or IP address. Default: localhost
 -keyalias &lt;arg&gt;        Alias of the key in the keystore to use for
                        authentication.
 -keystore &lt;arg&gt;        Keystore with private key and certificate for
                        client certificate authentication.
 -keystorepwd &lt;arg&gt;     Password for reading the keystore.  If keystore is
                        specified but not this keystore password option,
                        the CLI will instead prompt for the password.
 -metadata &lt;arg&gt;        Additional meta data to send to the signer. The
                              parameters should be given in the form KEY=VALUE.
                              This option can be given multiple times.
 -password &lt;arg&gt;        Password for authentication. If username is
                        specified but not this password option, the CLI
                        will instead prompt for the password.
 -port &lt;arg&gt;            Server port. Default: 8080 (for HTTP), 8442 for
                        HTTPS and 8443 for HTTPS with client
                        authentication.
 -protocol &lt;arg&gt;        Method of interacting with SignServer. HTTP or
                        CLIENTWS. Default: HTTP.
 -repeat &lt;arg&gt;          Run the operation this number of times. Default: 1
 -servlet &lt;arg&gt;         Servlet to call. Default /signserver/sod
 -truststore &lt;arg&gt;      Keystore with trusted certificates to use with
                        HTTPS.
 -truststorepwd &lt;arg&gt;   Password for the keystore with trusted
                        certificates. If truststore is specified but not
                        this truststore password option, the CLI will
                        instead prompt for the password.
 -username &lt;arg&gt;        Username for authentication.
 -workerid &lt;arg&gt;        ID of worker which should perform the operation.
 -workername &lt;arg&gt;      Name of worker which should perform the operation.

Sample usages:
a) signdatagroups -workername MRTDSODSigner -data &quot;1=value1&amp;2=value2&amp;3=value3&quot;
b) signdatagroups -workername MRTDSODSigner -data &quot;1=value1&amp;2=value2&amp;3=value3&quot; -metadata param1=value1 -metadata param2=value2
                        </pre>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Administration Web Service"></a>
      Administration Web Service
    </h3>
      				  <p>
The SignServer AdminWS can be used for remote administration of SignServer
over client authenticated HTTPS. Access is granted based on a list of
certificate serial number and issuer distinguished name pairs. Currently there
is only one access level and all administrators granted access will be able to
perform all operations.
                    </p>
	      				  <p>
The WSDL file is located at the URL http://&lt;hostname&gt;:8080/signserver/AdminWSService/AdminWS?wsdl
                    </p>
	      				  <p>
Authorizing administrators can be done using the Admin CLI command "wsadmins".
                    </p>
	      				  <pre class="code">
Usage: signserver wsadmins -add -certserialno &lt;certificate serial number (in hex)&gt; -issuerdn &lt;issuer DN&gt;
Usage: signserver wsadmins -add -cert &lt;PEM or DER file&gt;
Usage: signserver wsadmins -remove -certserialno &lt;certificate serial number (in hex)&gt; -issuerdn &lt;issuer DN&gt;
Usage: signserver wsadmins -list
Example 1: signserver wsadmins -add -certserialno 123abcdef -issuerdn &quot;C=SE, CN=Neo Morpheus&quot;
Example 2: signserver wsadmins -add -cert cert.pem
Example 3: signserver wsadmins -remove -certserialno 123abcdef -issuerdn &quot;C=SE, CN=Neo Morpheus&quot;
Example 4: signserver wsadmins -list
                    </pre>
	      				  <p>
Notice that the certificate serial number should be entered as the hexadecimal
representation (leading zeros and upper/lowercase is not significant). 
Also notice that the issuer DN currently should be entered in the reversed order 
and with spaces after each component. In the example above the issuer DN from the 
certificate actually is "CN=Neo Morpheus, C=SE". 
                    </p>
	      				  <p>
An administrator can also be added by supplying a client certificate as an argument.
The serial number and issuer DN is then taken from that certificate.
                    </p>
	      				  <p>
To troubleshoot an "Administrator not authorized to resource" see the logs for how 
SignServer interprets the serialnumber and subject DN. Example:
                    </p>
	      				  <pre>
19:00:33,946 INFO  [AdminWS] ADMIN OPERATION; subjectDN=C=SE, O=Markus Organization, OU=Internal Testing 1, CN=External RA Admin 1; serialNumber=4a3442e98e3ce428; issuerDN=C=SE, O=Markus Organization, OU=Internal Testing 1, CN=MarkusAdminCA1; authorized=false; operation=getWorkers; arguments=
                    </pre>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Apache HTTP Server as proxy"></a>
      Apache HTTP Server as proxy
    </h3>
      				  <p>
This section will show you examples on how the Apache Web Server (version 2.2.20) can be used as a proxy in front of SignServer. This guide is only informative, you should also always consult the current Apache documentation for the modules used. The proxy could be used for multiple reasons including:
                    </p>
	      				  <ul>
                        <li>Use standard ports (80, 443) instead of unprivileged ports used by the application server</li>
                        <li>Making workers accessible through more nice looking URLs.<br />For example "http://tsa.example.com" instead of "http://example.com:8080/signserver/tsa?workerName=TimeStampSigner1"</li>
                        <li>Use any of the access control and authentication mechanism available in Apache</li>
                        <li>Redirect HTTP traffic to HTTPS</li>
                        <li>Only accepting requests to specified locations</li>
                    </ul>
	      				  <p>
As the requests should go through the proxy you will probably want to configure the application server to only listen to localhost and/or use a firewall blocking the application server ports from external requests. To configure JBoss to only listen to localhost set the following properties in signserver_deploy.properties:
                    </p>
	      				  <pre class="code">
httpsserver.bindaddress.pubhttp=127.0.0.1
httpsserver.bindaddress.pubhttps=127.0.0.1
httpsserver.bindaddress.privhttps=127.0.0.1
                </pre>
	      				  <p>
Install the Apache web server and enable required modules (the following commands are for Ubuntu but should be similar in other distributions as well):
                    </p>
	      				  <pre class="code">
$ sudo apt-get install apache2
$ cd /etc/apache2/mods-enabled/
$ sudo ln -s ../mods-available/proxy.load proxy.load
$ sudo ln -s ../mods-available/proxy_http.load proxy_http.load
$ sudo ln -s ../mods-available/proxy_ajp.load proxy_ajp.load
$ sudo ln -s ../mods-available/proxy_balancer.load proxy_balancer.load
$ sudo ln -s ../mods-available/rewrite.load rewrite.load
$ sudo ln -s ../mods-available/ssl.load ssl.load
                </pre>
	      			      	  <div class="subsection">
      <h4>
        <a name="Example: Rewrite URLs for TSA (using mod_proxy and mod_rewrite)"></a>
        Example: Rewrite URLs for TSA (using mod_proxy and mod_rewrite)
      </h4>
      				  <p>
A sample configuration how to fix up nice URLs for time-stamping so that you can point your TSA clients to http://tsa.example.com/ instead of http://tsa.example.com:8080/signserver/process?workerName=TimeStampSigner1.
                    <br />
This configuration combines mod_proxy with mod_rewrite to be able to set the workerName or workerId, so you can have different TSAs available on different URLs.
                    </p>
	      				  <pre class="code">
&lt;VirtualHost tsa.example.com:80&gt;
    ServerName tsa.example.com
    ServerAlias tsa.example.com
    CustomLog /var/log/apache2/access.log combined

    RewriteEngine on
    RewriteLogLevel 5
    RewriteLog &quot;/var/log/apache2/rewrite.log
    RewriteRule ^/$ /?workerName=TimeStampSigner1 [PT]

    ProxyRequests Off
    &lt;Proxy *&gt;
        Order deny,allow
        Allow from all
    &lt;/Proxy&gt;
    ProxyPass / http://127.0.0.1:8080/signserver/process
    ProxyPassReverse / http://127.0.0.1:8080/signserver/process
&lt;/VirtualHost&gt;
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Example: Rewrite URLs and redirect to HTTPS (using AJP)"></a>
        Example: Rewrite URLs and redirect to HTTPS (using AJP)
      </h4>
      				  <p>
The following example configures three virtual hosts. The first signserver.example.com:80 just redirects all requests to use HTTPS and thus the virtual host signserver.example.com:443. The second virtual host is configured to proxy requests to the /signserver path on the application server using the AJP protocol. It is also configured to use HTTPS with a server certificate. The last virtual hosts auth.signserver.example.com using an additonal IP address is configured to require client certificate authentication. 
                    </p>
	      				  <p>
Notice: Some application servers (i.e. JBoss 4) might have problems writing the correct port number in the endpoint URL in the web services WSDL file when using a proxy (i.e. writing 8443 instead of 443).
                    </p>
	      				  <pre class="code">
&lt;VirtualHost signserver.example.com:80&gt;
    ServerName signserver.example.com
    ServerAlias signserver.example.com

    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

    # Configure log
    LogLevel warn
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

&lt;/VirtualHost&gt;

&lt;VirtualHost signserver.example.com:443&gt;
    ServerName signserver.example.com
    ServerAlias signserver.example.com

    ProxyRequests Off
    &lt;Proxy balancer://mycluster-3&gt;
        BalancerMember ajp://localhost:8009/signserver
    &lt;/Proxy&gt;
    ProxyPass / balancer://mycluster-3/

    RewriteEngine   On

    # Treat requests to / and /signserver/ as the same for web services endpoints to work.
    RewriteCond     %{THE_REQUEST}  /signserver/
    RewriteRule     ^/signserver/(.*)$ /$1 [PT]

    # Configure secure SSL for this server using SSL certificate generated by EJBCA
    SSLEngine on
    SSLCipherSuite HIGH
    SSLProtocol all -SSLv2
    SSLCertificateFile /home/markus/Documents/PrimeKey/MarkusCA/example.com/signserver.example.com-cert.pem
    SSLCertificateKeyFile /home/markus/Documents/PrimeKey/MarkusCA/example.com/signserver.example.com-key.pem

    # Configure log
    LogLevel warn
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined
&lt;/VirtualHost&gt;

# Note: auth.signserver.example.com must have a different IP address
&lt;VirtualHost auth.signserver.example.com:443&gt;
    ServerName auth.signserver.example.com
    ServerAlias auth.signserver.example.com

    ProxyRequests Off
    &lt;Proxy balancer://mycluster-4&gt;
        BalancerMember ajp://localhost:8009/signserver
    &lt;/Proxy&gt;
    ProxyPass / balancer://mycluster-4/

    RewriteEngine   On
    # Treat requests to / and /signserver/ as the same for web services endpoints to work.
    RewriteCond     %{THE_REQUEST}  /signserver/
    RewriteRule     ^/signserver/(.*)$ /$1 [PT]

    # Configure secure SSL for this server using SSL certificate generated by EJBCA
    SSLEngine on
    SSLCipherSuite HIGH
    SSLProtocol all -SSLv2
    SSLCertificateFile /home/markus/Documents/PrimeKey/MarkusCA/example.com/auth.signserver.example.com-cert.pem
    SSLCertificateKeyFile /home/markus/Documents/PrimeKey/MarkusCA/example.com/auth.signserver.example.com-key.pem

    SSLVerifyClient require
    SSLVerifyDepth 1
    SSLCACertificateFile /home/markus/Documents/PrimeKey/MarkusCA/example.com/truststore.pem

    # Configure log
    LogLevel warn
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined
&lt;/VirtualHost&gt;
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Example: Granting access to specific workers only"></a>
        Example: Granting access to specific workers only
      </h4>
      				  <p>
This example shows how it is possible to limit access to only specified resources. 
                    </p>
	      				  <p>
If you are going to grant different users access to different workers always remember to first deny access from the root location. The reason is that there are other ways to access a worker than the "/worker/*" pattern. For instance /process, /tsa, /pdf and /sod etc as well as using the web services interfaces /signserverws, /SignServerWSService, /validationws, /ValidationWSService and /ClientWSService all can be used to invoke <b>any</b> worker.
                    </p>
	      				  <p>
If you instead relay on SignServer to do the authentication/authorization it could still be good from a security point to only grant access to the locations you intend to use. In that case you would probably want to also give access to the  web services interfaces, /worker and /process etc.
                    </p>
	      				  <p>
Also remember if you are proxying from multiple virtual hosts (i.e. if you have one with and one without client authentication as in the example above) that you might want to add the access restrictions to all of them.
                    </p>
	      				  <pre class="code">
    ...
    # First, deny access globally and then only give access to resources explicitly
    &lt;Location /&gt;
    	Order Deny,Allow
    	Deny from all
    &lt;/Location&gt;

    # Allow index page
    &lt;LocationMatch &quot;^/$&quot;&gt;
	Order Allow,Deny
	Allow from all
    &lt;/LocationMatch&gt;

    # Allow demo web pages
    &lt;Location /demo/&gt;
	Order Allow,Deny
	Allow from all
    &lt;/Location&gt;

    # Allow documentation
    &lt;Location /doc/&gt;
	Order Allow,Deny
	Allow from all
    &lt;/Location&gt;

    # Allow web page resources
    &lt;LocationMatch &quot;\.(css|js|jpg|png)$&quot;&gt;
	Order Allow,Deny
	Allow from all
    &lt;/LocationMatch&gt;
    
    # Allow the Admin interface
    &lt;Location /AdminWSService/&gt;
	Order Allow,Deny
	Allow from all
    &lt;/Location&gt;

    # Grant everybody access to the XMLSigner
    &lt;Location /worker/XMLSigner&gt;
	Order Allow,Deny
	Allow from all
    &lt;/Location&gt;

    # Grant valid users access to the CMSSigner
    &lt;Location /worker/CMSSigner&gt;
	Order Allow,Deny
        Allow from all
        AuthType Basic
        AuthName &quot;Restricted CMSSigner access&quot;
    	AuthUserFile /home/markus/.htpasswd
    	Require valid-user
    &lt;/Location&gt;
    ...
                    </pre>
	            </div>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_commonconf"></a>
      Common configuration
    </h2>
      				  <p>
		Configuring workers are done by setting properties in the worker configuration.
		There is one set of configuration options that are handled by the framework, and that applies to all workers, then there are worker specific properties handled by the worker implementation.
		</p>
	      				  <p>Properties are usually defined in the module configuration file used to install a module, or configured manually using one of the <i>bin/signserver setproperty</i> variant.</p>
	      			          <div class="section">
    <h3>
      <a name="Setting Authorization Type"></a>
      Setting Authorization Type
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="SignServer"></a>
        SignServer
      </h4>
      				  <p>
By default (if the property is not set) is client-certificate authentication required for a signature request to be processed. This can be changed with the AUTHTYPE property.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="No authentication"></a>
        *** No authentication ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> =  NOAUTH
                        </p>
	      				  <p>
Sets the server to not require any authentication.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Client certificate authentication"></a>
        *** Client certificate authentication ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> =  CLIENTCERT
                        </p>
	      				  <p>
 (default) requires a certificate of all the clients. The certificates must be 
 in the application server's truststore. Authorized clients is configured
 manually using the CLI interface.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Username/password-based authentication"></a>
        *** Username/password-based authentication ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> = org.signserver.server.UsernamePasswordAuthorizer
                        </p>
	      				  <p>
<b>USER.[NAME]</b> = [PASSWORD]<br />
<b>USER.[NAME]</b> = [HASHED_PASSWORD]:[HASH_ALGORITHM]<br />
<b>USER.[NAME]</b> = [HASHED_PASSWORD]:[HASH_ALGORITHM]:[SALT]<br />
                        </p>
	      				  <p>
This authorizer requires a valid username and password. User accounts are
configured by setting properties of the form shown above, where
[NAME] is the username and [PASSWORD] is the clear-text password. In the second
form [HASHED_PASSWORD] should be replaced with the output of the digest algorithm 
specified in [HASH_ALGORITHM]. The third form uses a salt that is appended 
to the password before hashing it.
                        </p>
	      				  <p>
If a valid username and
password is not supplied the worker throws an AuthorizationRequiredException
which in case of the HTTP interfaces causes a HTTP Basic Authentication (RFC 2617).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Username-based authentication"></a>
        *** Username-based authentication ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> = org.signserver.server.UsernameAuthorizer
                        </p>
	      				  <p>
Form 1: ACCEPT_ALL_USERNAMES = false (default) and usernames are specified:<br />
<b>ACCEPT_ALL_USERNAMES</b> = false<br />
<b>ACCEPT_USERNAMES</b> = user1;user2;user3
                        </p>
	      				  <p>
Form 2, ACCEPT_ALL_USERNAMES = true and no usernames are specified:<br />
<b>ACCEPT_ALL_USERNAMES</b> = true
                        </p>
	      				  <p>
An Authorizer that can be used for instance if SignServer sits behind an Apache
front-end which uses HTTP basic authentication. With this Authorizer the username
is logged but the password is not checked as it is assumed to be checked by the
front-end.
                        </p>
	      				  <p>
The Authorizer can be configured to either accept all usernames or only accept
those usernames listed in one of its properties.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Remote address authentication"></a>
        *** Remote address authentication ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> = org.signserver.server.RemoteAddressAuthorizer
                        </p>
	      				  <p>
<b>ALLOW_FROM</b> = Comma separated list of IP addresses to allow requests from.
By default all other addresses are denied access.
                        </p>
	      				  <p>
If a worker is invoked directly using an EJB call and no REMOTE_IP is specified
in the RequestContext the IP-address is set to the String "null". In that case,
to allow requests using EJB calls, null can be added to the list of allowed
addresses.
                        </p>
	      				  <p>
<b>Note:</b> When adding "null" to ALLOW_FROM not only locally running clients
like the ClientCLI and AdminGUI is allowed access but also from workers that
invoke the other worker directly using an EJB call. This is for instance the
case for the XMLValidator which delegates the validation of the certificate to
a CertValidator. If the CertValidator had a RemoteAddressAuthorizer allowing
access from "null" then the XMLValidator would be able to use it. To restrict
users from using the CertValidator (indirectly through the XMLValidator) an
Autorizer could be configured for the XMLValidator.
                        </p>
	      				  <p>
<b>Logging:</b> This authorizer will add the remote IP address to the log field AUTHORIZED_ADDRESS.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="List-based Address Authorizer"></a>
        *** List-based Address Authorizer ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> = org.signserver.server.ListBasedAddressAuthorizer
                        </p>
	      				  <p>
An authorizer that supports white- and blacklisting direct and forwarded addresses (coming via a proxy).
                        </p>
	      				  <p>
<b>WHITELISTED_DIRECT_ADDRESSES</b> = A comma-separated list of IP addresses allowed direct access.
                        </p>
	      				  <p>
<b>BLACKLISTED_DIRECT_ADDRESSES</b> = A comma-separated list of IP addresses denied direct access.
                        </p>
	      				  <p>
<b>WHITELISTED_FORWARDED_ADDRESSES</b> = A comma-separated list of IP addresses allowed access as a forwarded address.
                        </p>
	      				  <p>
<b>BLACKLISTED_FORWARDED_ADDRESSES</b> = A comma-separated list of IP addresses denied access as a forwarded address.
                        </p>
	      				  <p>
<b>MAX_FORWARDED_ADDRESSES</b> = Number of IP addresses to inspect in the list of forwarded addresses. (Default: 1).                        
                        </p>
	      				  <p>
It is not possible to specify both a whitelist and a black list at the same time for each of direct and forwarded addresses.
One of each list (direct and forwarded) must be specified.
When specifying a whitelist for forwarded addresses, requests without an X-Forwarded-For header will always be denied.
When there are multiple addresses in the X-Forwarded-For header (in the case of using multiple proxies) the number of addresses specified in
MAX_FORWARDED_ADDRESSES counting from the end of the list (or the entire list if it is shorter than this) is considered for white- and blacklisting.
If specified, MAX_FORWARDED_ADDRESSES must have a value &gt;= 1. It is not allowed to set it 0 to disable checking forwarded addresses.
RemoteAddressAuthorizer should be used in this case.
                        </p>
	      				  <p>
Examples:
                        </p>
	      				  <p>
1. To accept requests from all direct addresses except for 10.0.0.5 and for all forwarded addresses except 13.170.18.12 and 13.170.18.13 use:<br />
BLACKLISTED_DIRECT_ADDRESSES=10.0.0.5<br />
BLACKLISTED_FORWARDED_ADDRESSES=13.170.18.12, 13.170.18.13
                        </p>
	      				  <p>
2. To only accept direct requests from 10.0.0.1 and 10.0.0.2 and from the forwarded address 216.34.181.97 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.0.1, 10.0.0.2<br />
WHITELISTED_FORWARDED_ADDRESS=216.34.181.97
                        </p>
	      				  <p>
3. To only allow direct access from the proxy servers 10.0.0.1 and 10.0.0.2 but allow them to forward from all address except the to banned addresses 13.170.18.12 and 13.170.18.13 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.0.1, 10.0.0.2<br />
BLACKLISTED_FORWARDED_ADDRESSES=13.170.18.12, 13.170.18.13
                        </p>
	      				  <p>
4. To accept direct requests from all addresses except 10.0.0.5 but only forwarded from 216.34.181.97 use:<br />
BLACKLISTED_DIRECT_ADDRESSES=10.0.0.5<br />
WHITELISTED_FORWARDED_ADDRESS=216.34.181.97
                        </p>
	      				  <p>
5. To accept direct request from a proxy server 10.0.1.1 allowing forwarding from another proxy 10.0.2.2 in turn proxying the request from the
client with address 192.0.43.10 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.1.1<br />
WHITELISTED_FORWARDED_ADDRESSES=10.0.2.2,192.0.43.10<br />
MAX_FORWARDED_ADDRESSES=2
                        </p>
	      				  <p>
6. To blacklist a set of IP addresses, set the MAX_FORWARDED_ADDRESSES value to a value gauranteed to be larger than the number of
proxies you have control over, like in the following example:
BLACKLISTED_FORWARDED_ADDRESSES=10.0.1.1,10.0.2.2,10.0.3.3
MAX_FORWARDED_ADDRESSES=10
                        </p>
	      				  <p>
<b>Logging:</b> This authorizer will add the remote IP address to the log field AUTHORIZED_ADDRESS and the proxied address
(if it's available in the request) in the log field AUTHORIZED_FORWARDED_ADDRESS.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="DispatchedAuthorizer"></a>
        *** DispatchedAuthorizer ***
      </h5>
      				  <p>
<b>AUTHTYPE</b> = org.signserver.server.DispatchedAuthorizer    
                        </p>
	      				  <p>
<b>AUTHORIZEALLDISPATCHERS</b> = True, if any Dispatcher should be authorized. (Required) (currently only true is supported)
                        </p>
	      				  <p>
Only accepts requests that has gone through a Dispatcher. This Authorizer only checks the present of the DISPATCHER_AUTHORIZED_CLIENT field in the request context to know that the request has passed a Dispatcher.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Custom"></a>
        *** Custom ***
      </h5>
      				  <p>
This authorization functionality doesn't work for all use cases. Then it's possible to create a customized authorizer and specify it's class path as value in the AUTHTYPE property. The Processable will then automatically instantiate and use it. How to develop such a plug-in is explained in the developers section.
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Archiving Responses"></a>
      Archiving Responses
    </h3>
      				  <p>
The archiving feature can be used to save all generated responses.    
                </p>
	      				  <p>
For the OldDatabaseArchiver and Base64DatabaseArchiver, in some extent, the Admin CLI can be used to query the archive. See 
the CLI section for more information.
                </p>
	      				  <p>
When a request has been process each Archiver is called one at the time to archive 
any results.
                </p>
	      				  <p>
<b>ARCHIVERS</b>: Used instead of the old ARCHIVE property to enable archiving 
by listing the class names of all the Archivers that should be used. Multiple 
Archivers can be specified separated by a "," (comma character). Exempel: 
                </p>
	      				  <pre class="code">
ARCHIVERS=org.signserver.server.archive.olddbarchiver.OldDatabaseArchiver,org.signserver.server.archive.otherarchiver.OtherArchiver123
</pre>
	      				  <p>
<b>ARCHIVE</b>: Previously the archiving was enabled by setting the property to 
"TRUE". This is the same as to set 
                </p>
	      				  <pre class="code">
ARCHIVERS=org.signserver.server.archive.olddbarchiver.OldDatabaseArchiver
</pre>
	      				  <p>
Default: FALSE.
                </p>
	      				  <p>
See also the section about all <a href="complete.en.html#Archivers">available Archivers</a>.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Accounter"></a>
      Accounter
    </h3>
      				  <p>
An Accounter is responsible for somehow charging a client for a successful 
request or to deny the requst if the client has insufficient funds.
                </p>
	      				  <p>
When a request has been processed, and if the worker marked the request as 
successfully fulfilled, the configured Accounter (if any) is called. The 
Accounter implementation could potentially query an external database and make a 
purchase for the service.
                </p>
	      				  <p>
The Accounter to use is configured using the ACCOUNTER worker property. By default no Accounter is used. Example:
                </p>
	      				  <pre class="code">
ACCOUNTER=org.signserver.server.GlobalConfigSampleAccounter
</pre>
	      				  <p>
See also the section about all <a href="complete.en.html#Accounters">available Accounters</a>.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Checking validity of signer certificates"></a>
      Checking validity of signer certificates
    </h3>
      				  <p>
By default the SignServer checks if the signer certificate of a signer is valid before letting the signer process a request. If the signers certificate is not valid an error message is returned.
There are two properties that can be set to disable this check:
                </p>
	      				  <p>
<b>CHECKCERTVALIDITY</b>: default value is true, meaning that the validity period of the certificate will be verified before processing. Set to false to ignore if the certificate is expired or not yet valid.
                </p>
	      				  <p>
<b>CHECKCERTPRIVATEKEYVALIDITY</b>: default value is true, meaning that the validity period in the PrivateKeyUsagePeriod of the certificate will be verified before processing. This is only done if this extension exists (it is optional in a certificate). Set to false to ignore the PrivateKeyUsagePeriod.
                </p>
	      				  <p>
<b>MINREMAININGCERTVALIDITY</b>: default value is 0. This property defines a minimum remaining validity time required of the signing certificate. If the signing certificate expires within the number of days specified an error occurs. Set to 0 (default) to disable this check.
				</p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Limiting the number of signatures"></a>
      Limiting the number of signatures
    </h3>
      				  <p>
By default SignServer keeps track of the number of signings performed with each key by holding counters in the database that are updated for each signing. The following worker properties controls the key usage counter:    
                </p>
	      				  <p>
<b>KEYUSAGELIMIT</b> = Sets how many signatures that are allowed to be created
with the same key by this worker (default is -1 = no limit). After the limit has
been reached the worker is considered offline.

Note that the counter is per key and not per worker so if multiple workers share
the same key they will all increment the counter. This also means that the worker
is active again after it has gotten a new certificate/key.
                </p>
	      				  <p>
<b>DISABLEKEYUSAGECOUNTER</b> = By default all key usages are counted but by specifying this as "TRUE" key usages performed by this worker will not be counted. Disabling the key usage counter can be a gain in performance as it will be less database transactions. However, if you have requirements on the number of allowed signings for one worker make sure to not use the same key with another worker for which the counter is disabled as those uses will then be missed.
                </p>
	      				  <p>
The key usage counter can not be disabled for a worker if KEYUSAGELIMIT is also specified.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Other properties"></a>
      Other properties
    </h3>
      				  <p>
<b>DISABLED</b> = Setting this to true disables a worker. A disabled worker can not perform any operations and any requests to it will fail. However, disabled workers are not included in the Health check report. 
                </p>
	      				  <p>
<b>EXPLICITECC</b> = Setting this to true uses explicit domain parameters instead of NamedCurves when generating
a certificate request using the RenewalWorker or through to admin GUI. (default: false)
                </p>
	      				  <p>
<b>NOCERTIFICATES</b> = Setting this to true tells SignServer to not warn if no signer certificate is configured for this worker. This could be useful for special types of workers not performing any signing operations.
                </p>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_plugins"></a>
      Plugins
    </h2>
      			          <div class="section">
    <h3>
      <a name="Configuring a plug-in"></a>
      Configuring a plug-in
    </h3>
      				  <p>
A worker component is configured by entering its class path (and optionally its crypto token class path) in a memory bank called the global configuration and then issuing the reload command. There exists sample configurations for most of the plug-ins in the 'doc/sample-configs' directory.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer Signers"></a>
      SignServer Signers
    </h3>
      				  <p>
There exists multiple signers. One is the time stamp signer generating RFC 3161 compliant timestamps using the Bouncycastle library.
An MRTD signer creating "Machine Reader Travel Document" signatures using the RSA algorithm from pre-padded data and
another is the MRTD SOD Signer which creates the complete Security Object (SOd) by signing the datagroups for the passport.
There are also signers for automatically signing of specific document-types 
such as PDF, XML, ODF and OOXML and there is a general purpose signer that
can sign any document-type and produces the output in Cryptographic Message Syntax (CMS).
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Common Properties"></a>
        Common Properties
      </h4>
      				  <p>
Properties that have common use among most signers:
                    </p>
	      				  <p>
<b>INCLUDE_CERTIFICATE_LEVELS</b> = Number of certificate levels to include. This property is supported for all signers except MRTDSODSigner, MRTDSigner, and MSAuthCodeTimeStampSigner. The property is optional and defaults to include all certificates in the chain, except for XAdESSigner, where the default is to only include one certificate (the signing certificate). Setting this to 0 (include no certificates) is not supported for TimeStampSigner. To include all certificates specify at least the same value as number of certificates in the certificate chain.
                    </p>
	      				  <p>
<b>REQUESTDN</b> = Subject DN to be included in a certificate signing request (CSR) by default. Used by interfaces such as the Admin GUI to have a default value already filled in.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Time-stamp Signer"></a>
        Time-stamp Signer
      </h4>
      				  <p>
The time-stamp signer has the class name: org.signserver.server.signers.TimeStampSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The time stamp server generates time stamp tokens and have the support for the following options:
                        </p>
	      				  <ul>
                            <li>Set of accepted policies</li>
                            <li>Set of accepted algorithms</li>
                            <li>Set of accepted extensions</li>
                            <li>Accuracy microseconds</li>
                            <li>Accuracy milliseconds</li>
                            <li>Accuracy seconds</li>
                            <li>Included certificate chain (currently doesn't include CRLs)</li>
                            <li>Ordering</li>
                            <li>TSA name</li>
                        </ul>
	      				  <p>
The time stamp signer currently don't support:
                        </p>
	      				  <ul>
                            <li>CRL inclusion</li>
                            <li>Signed attributes</li>
                            <li>Unsigned attributes </li>
                        </ul>
	      				  <p>
Timestamps requests are served through a http service at the URL:
                        </p>
	      				  <pre>
'http://&lt;host name&gt;/signserver/process?workerId=&lt;worker Id&gt;'
                        </pre>
	      				  <p>
If no 'worker Id' parameter is specified then will the id of 1 be used as default.
                        </p>
	      				  <p>
The time-stamp signer requires a time-stamp certificate with the extended key usage 'time-stamp' only. The extended key usage extension must be critical.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
The following properties can be configured with the signer:
                        </p>
	      				  <p>
<b>TIMESOURCE</b> = property containing the fully qualified name of the class implementing  the ITimeSource that should be used (OPTIONAL). Below are the built-in TimeSourceS available:
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
<b>org.signserver.server.LocalComputerTimeSource</b>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
This is the default TimeSource and uses the time from the local computer and
always returns the time.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
<b>org.signserver.server.StatusReadingLocalComputerTimeSource</b>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
This TimeSource returns the time from the local computer but only if the status property <i>TIMESOURCE0_INSYNC</i> is not expired and returned as <i>true</i> from the Status Repository.
                                    </p>
                                    <p>
Worker properties:
                                    </p>
                                    <ul>
                                        <li>
                                            <p>
                                                <b>LEAPSECOND_HANDLING</b>: NONE, PAUSE or STOP. Default is NONE.
                                            </p>
                                            <p>
<i>NONE</i>: Leap seconds are not considered and time-stamp tokens are issued as usual. 
                                            </p>
                                            <p>
<i>PAUSE</i>: The TimeSource will query the status property <i>LEAPSECOND</i> from the Status Repository.
If this property is not expired, and has the value <i>POSITIVE</i> or <i>NEGATIVE</i> and current time is in the interval surrounding a potential leap second (23:59:58,989 - 00:00:01,010) (at month shifts, in UTC time),
the TimeSource will make a pause to ensure the time value is not fetch on the leap second.
The value <i>NONE</i> is interpreted as there is no leap second and the time value will be returned immediately as usual.
If the value has expired, no valid time will be returned.
                                            </p>
                                            <p>
<i>STOP</i> The TimeSource will query the status property in the same way as for the PAUSE strategy. During the interval surrounding a potential leap second no time will be returned. This will cause the response to the clients to be timeSourceNotAvailable.
If the LEAPSECOND status property value has expired, no valid time will be returned.
                                            </p>
                                        </li>
                                    </ul>
                                
      </td>
      </tr>
        </table>
          				  <p>
<b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the timestamp (default: SHA1withRSA)
						</p>
	      				  <p>
<b>ACCEPTEDALGORITHMS</b> = A ';' separated string containing accepted algorithms, can be null if it shouldn't be used. (OPTIONAL, Strongly recommended)
Supported Algorithms are: GOST3411, MD5, SHA1, SHA224, SHA256, SHA384, SHA512, RIPEMD128, RIPEMD160, RIPEMD256
                        </p>
	      				  <p>
<b>ACCEPTEDPOLICIES</b> =  A ';' separated string containing accepted policies. Note that only policies listed in this property are allowed to be requested. If the property does not contain any policies then no policy can be requested. Requests not including any policy would use the default policy regardless of this property but requests explicitly requesting the default policy would still not be allowed unless it is listed in this property. (OPTIONAL, Recommended)
                        </p>
	      				  <p>
<b>ACCEPTEDEXTENSIONS</b> = A ';' separated string containing accepted extensions, can be null if it shouldn't be used. (OPTIONAL)
                        </p>
	      				  <p>
<b>DEFAULTTSAPOLICYOID</b> = The default policy ID of the time stamp authority (REQUIRED, if no policy OID is specified in the request then will this value be used.)
                        </p>
	      				  <p>
<b>ACCURACYMICROS</b> = Accuracy in micro seconds, Only decimal number format, only one of the accuracy properties should be set (OPTIONAL)
                        </p>
	      				  <p>
<b>ACCURACYMILLIS</b> = Accuracy in milliseconds, Only decimal number format, only one of the accuracy properties should be set (OPTIONAL)
                        </p>
	      				  <p>
<b>ACCURACYSECONDS</b> = Accuracy in seconds. Only decimal number format, only one of the accuracy properties should be set (OPTIONAL)
                        </p>
	      				  <p>
<b>ORDERING</b> = The ordering (OPTIONAL), default false. Only false is supported.
                        </p>
	      				  <p>
<b>INCLUDEORDERING</b> = If set to true, always include the ordering attribute, even when ORDERING is set to false. It is not allowed to set this to false when ORDERING is set to true. (OPTIONAL), default false.                       
                        </p>
	      				  <p>
<b>TSA</b> = General name of the Time Stamp Authority. (OPTIONAL)
                        </p>
	      				  <p>
<b>TSA_FROM_CERT</b> = Setting this property to true sets the general name of the Time Stamp Authority to the subject DN of the
signing certificate. This can not be set to true if the TSA property is set. (OPTIONAL) (the default is to not set the general name)
                        </p>
	      				  <p>
<b>REQUIREVALIDCHAIN</b> = Set to true to perform an extra check that the SIGNERCERTCHAIN only contains certificates in the chain of the signer certificate. (OPTIONAL), default false.
                        </p>
	      				  <p>
<b>MAXSERIALNUMBERLENGTH</b> = The maximum size (in bytes) used when generating serial numbers, must be between 8 and 20 (64 - 160 bits) (Default: 8)
The generated serial number will always be positive (so the sign bit is always a zero).
						</p>
	      				  <p>
<b>WORKERLOGGER</b> = As for other workers this property can be used to specify which worker logger to use. By default the <a href="complete.en.html#DefaultTimeStampLogger">DefaultTimeStampLogger</a> is used.
                        </p>
	      				  <p>
<b>INCLUDESTATUSSTRING</b> = Specifies if the status string is to be included in the response. Setting this to true triggers a bug in some
versions of OpenJDK's jarsigner utility. (OPTIONAL), default true.
                        </p>
	      				  <p>
<b>INCLUDESIGNINGTIMEATTRIBUTE</b> = Specifies if the signingTime signed CMS attribute should be included in the response. (OPTIONAL), default true.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="TimeStampSigner Certificates"></a>
        *** TimeStampSigner Certificates ***
      </h5>
      				  <p>
Specifying a signer certificate is required as information from that certificate will be used to indicate which signer signed the time-stamp token.
                        </p>
	      				  <p>
The signer certificate chain contains all certificates included in the token  if the client requests the certificates.
The signer certificate MUST be included in the configured certificate chain.
Other certificates might also be included in the chain (typically intermediate CA certificates).
However, if REQUIREVALIDCHAIN=true is specified only the signer certificate directly followed by its issuer and then the issuer's issuer and so on is allowed. All certificates will be verified if there is a certificate coming after it. No check is made that the last certificate is a root certificate as that certificate is usually not included.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="MS Authenticode Time Stamp Signer"></a>
        MS Authenticode Time Stamp Signer
      </h4>
      				  <p>

The class name is: org.signserver.server.signers.tsa.MSAuthCodeTimeStampSigner
					</p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
This time stamp signer is compatible with the Microsoft Authenticode time-stamping code signing.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>TIMESOURCE</b> = property containing the fully qualified name of the class implementing  the ITimeSource that should be used (OPTIONAL).
This property has the same values as for TimeStampSigner <a href="complete.en.html#Available%20Properties">above</a>.
                        </p>
	      				  <p>
<b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the timestamp (default: SHA1withRSA)
						</p>
	      				  <p>
<b>INCLUDE_SIGNING_CERTIFICATE_ATTRIBUTE</b> = Specifies if the signing certificate attribute (id-aa-signingCertificate) [RFC2634] should be included in the response (OPTIONAL, default: false).
					    </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Howto"></a>
        *** Howto ***
      </h5>
      				  <p>
There is a howto about testing Authenticode signing available in <code>doc/howtos/test_ms_authcode.txt</code>
						</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="MRTD Signer"></a>
        MRTD Signer
      </h4>
      				  <p>
The MRTD signer has the class name: org.signserver.module.mrtdsigner.MRTDSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The MRTD Signer performs a RSA signing operation on incoming data. The data should already be padded. This signer could be used to sign 'Machine Readable Travel Documents' i.e. electronic passports.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
No configuration properties exists.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="MRTD SOD Signer"></a>
        MRTD SOD Signer
      </h4>
      				  <p>
The MRTD SOD signer has the class name: org.signserver.module.mrtdsodsigner.MRTDSODSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The MRTD SOD Signer creates the complete security object (SOd) for a MRTD (Machine Readable Travel Document, i.e. electronic passports, residence permit etc) by signing the provided data groups (DGs).
                        </p>
	      				  <p>
Note 1: The Document Signer (DS) certificate is included in the SOd.<br />
Note 2: The SOd is verified (including certificate path) before it is returned so the certificate chain must contain the Country Signing CA (CSCA) certificate.<br />
Note 3: See also the integration guide for <a href="complete.en.html#SODProcessServlet">SODProcessServlet</a> or the <a href="complete.en.html#Client%20Web%20Service">ClientWS</a> interface.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>DODATAGROUPHASHING</b> = True if this signer first should hash the DG values. Otherwise the values are assumed to be hashes already. (Optional, default is false)<br />
<b>DIGESTALGORITHM</b> = Message digest algorithm that is applied or should be applied to the values. (Optional, default is SHA256)<br />
<b>SIGNATUREALGORITHM</b> = Signature algorithm for signing the SO(d). (Optional, default is SHA256withRSA all though SHA256withRSAandMGF1 is recommended by Doc9303)<br />
<b>LDSVERSION</b> = Version of Logical Data Structure (LDS). For LDS version 1.7 enter "0107" and for version 1.8 "0108". (Optional, default is 0107)<br />
<b>UNICODEVERSION</b> = Version of Unicode used in the datagroups. Required if LDS 1.8 is used. Example: "040000" for Unicode version 4.0.0.<br />
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="PDF Signer"></a>
        PDF Signer
      </h4>
      				  <p>
The PDF signer has the class name: org.signserver.module.PDFSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The main purpose of the PDF signer is to add digital signatures to PDF documents. 
                        </p>
	      				  <p>
The signer supports the addition of visible or invisible signatures. Both visible and invisible signatures serve the same purpose of signing document, and technically are equivalent in that sense. The difference is that when visible signature  is applied to a document, signature image (in shape of rectangle) is placed at the specified place in the document, clicking on which will allow seeing properties of the signature (Adobe Acrobat Reader). On the other hand when invisible signature is applied, signature properties are accessed through menu items. For visible signatures properties such as : custom signature image, signature rectangle, page at which signature rectangle to be drawn and others can be specified (see Available Properties below)
                        </p>
	      				  <p>
PDF Signer can also apply timestamp to a signature. If the signature is timestamped, it can be viewable through signature properties in Adobe Acrobat Reader. Timestamping is used to prove that  document was signed before the time specified by timestamp token. If the signature is not timestamped then the signature time specified in the signature properties is not considered to be trusted. It is strongly advised to apply timestamp to a signature, and the TSA module can be used for this purpose.
                        </p>
	      				  <p>
Also CRL or OCSP Response of the signer's certificate can be embedded inside the signature package. Embedding CRL or OCSP response with the package will help validate signature even after the signer's certificate is expired. (Though it will not totally guarantee the long term signature preservation. Topic of long term signature preservation for archival purposes is a large one and is discussed to be implemented in future versions of SignServer).
                        </p>
	      				  <p>
The PDF Signer can also be configured to enforce that certain PDF permissions are not available in the signed document and/or that certain permissions should be removed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="PDF passwords"></a>
        *** PDF passwords ***
      </h5>
      				  <p>
PDF documents can optionally be protected by a password.
                        </p>
	      				  <p>
There are two different types of passwords:
                            <ul>
                                <li>
                                    User password:<br />
                                    Also sometimes referred to as "open password" or "document password". It can be used for reading an encrypted document.
                                </li>
                                <li>
                                    Owner password:<br />
                                    Also sometimes referred to as "permission password" or "security restriction password". It can be used for reading an encrypted document and making changes to a document that has permissions.
                                </li>
                            </ul>
If a document is protected by an owner password it has to be supplied with the request for SignServer to sign the document. If the document is protected by a user password, either the user password or the owner password has to be supplied with the request for SignServer to sign the document.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="PDFSigner Requests"></a>
        *** PDFSigner Requests ***
      </h5>
      				  <p>
PDF signing requests can be served using either web services or the web server interface (HTTP). See <a href="integration.html">Integration</a> for general information about the different interfaces.    
                        </p>
	      				  <p>
For the web server interface the GenericProcessServlet can be used. The PDFSigner supports the extra request field "pdfPassword" letting the client supply a PDF password to be used for opening the PDF for signing (not required unless the PDF is already password protected).
                        </p>
	      				  <p>
For the old web services interface the request should contain an encoded GenericProcessesRequest and the response will be an GenericProcessResponse. It is possible to supply a PDF password by including it in the requestMetaData with the key "pdfPassword".
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p>
The following properties can be configured with the signer:
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>REASON</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
The reason included in the PDF signature and displayed by the PDF reader. 
                                    </p>
                                    <p>
Default: "Signed by SignServer".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>LOCATION</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
The location included in the PDF signature and displayed by the PDF reader. 
                                    </p>
                                    <p>
Default: "SignServer".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>ADD_VISIBLE_SIGNATURE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Setting that control whether signature to be added should be visible or invisible.
                                    </p>
                                    <p>
Possible values: True or False.
                                    </p>
                                    <p>
Default: "False"                                        
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>VISIBLE_SIGNATURE_PAGE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Specifies the page on which the visible signature will be drawn. This property is ignored if ADD_VISIBLE_SIGNATURE is set to False.
                                    </p>
                                    <p>
Possible values:<br />
"First" : signature drawn on first page of the document,<br />
"Last"  : signature drawn on last page of the document,<br />
page_number : signature is drawn on a page specified by numeric argument. If specified page number exceeds page count of the document ,signature is drawn on last page. If page_number specified is not numeric (or negative number) the signature will be drawn on first page
                                    </p>
                                    <p>
Default: "First".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>VISIBLE_SIGNATURE_RECTANGLE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Specifies the rectangle signature is going to be drawn in. 
                                    </p>
                                    <p>
This property is ignored if ADD_VISIBLE_SIGNATURE is set to False. Format is : (llx,lly,urx,ury).<br />
Here :<br />
llx =left lower x coordinate,<br />
lly=left lower y coordinate,<br />
urx =upper right x coordinate,<br />
ury = upper right y coordinate<br />
                                    </p>
                                    <p>
Default: "400,700,500,800".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>VISIBLE_SIGNATURE_CUSTOM_IMAGE_BASE64 &amp; VISIBLE_SIGNATURE_CUSTOM_IMAGE_PATH</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
	If we want the visible signature to contain custom image, specify image as base64 encoded byte array. Alternatively custom image can be specified by giving a path to image on file system.
                                    </p>
                                    <p>
Note: if specifying a path to an image "\" should be escaped (thus C:\photo.jpg =&gt; "C:\\photo.jpg")
                                    </p>
                                    <p>
Note: if specifying image as base64 encoded byte array "=" should be escaped (this "BBCXMI==" =&gt; "BBCXMI\=\=")
                                    </p>
                                    <p>
If both of these properties are set then VISIBLE_SIGNATURE_CUSTOM_IMAGE_BASE64 will take priority.
                                    </p>
                                    <p>
If we do not want this feature then do not set these properties.
                                    </p>
                                    <p>
Default: not set (no custom image).
                                    </p>
                                    <p>
These properties are ignored if ADD_VISIBLE_SIGNATURE is set to False.
                                    </p>
                                    <p>
NOTE: in clustered environment it is more manageable and advised to specify image as base64 string, since image data will be stored in central database. Otherwise each node should contain copy of the image, and each image managed separately (ex: on image updates, or insertion of new image for different worker)
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>VISIBLE_SIGNATURE_CUSTOM_IMAGE_SCALE_TO_RECTANGLE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
	If we want our custom image to be resized to specified rectangle (set by VISIBLE_SIGNATURE_RECTANGLE) then set to True. If set to True image might look different that original (as an effect of resizing). If set to False the rectangle drawn will be resized to specified image's sizes.
                                    </p>
                                    <p>
If set to False llx and lly coordinates specified by VISIBLE_SIGNATURE_RECTANGLE property will be used for drawing rectangle (urx and ury will be calculated from specified image's size).
                                    </p>
                                    <p>
This property is ignored if ADD_VISIBLE_SIGNATURE is set to False or if custom image to use is not specified.
                                    </p>
                                    <p>
Possible values: True, False.
                                    </p>
                                    <p>
Default: "True".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>CERTIFICATION_LEVEL</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Set this property to have the document certified with a certifying signature.
                                    </p>
                                    <p>
Possible values:<br />
NOT_CERTIFIED: The document is not certified.<br />
FORM_FILLING: The document is certified but the form can be filled in without invalidating the signature.<br />
FORM_FILLING_AND_ANNOTATIONS: The document is certified but the form can be filled in and annotations added without invalidating the signature.<br />
NO_CHANGES_ALLOWED: The document is certified and no changes can be made.<br />
                                    </p>
                                    <p>
Default: "NOT_CERTIFIED".
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>TSA_URL</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
If we want to timestamp document signature, specify timestamp authority URL.
                                    </p>
                                    <p>
This will cause time stamp requests to be issued via HTTP requests.
Under high load this can lead to thread deadlocks in the application server if using a localhost URL
(using a time stamp signer running in the same server).
In this case, use the internal mechanism described below).
                                    </p>
                                    <p>
If we do not want to timestamp document signature, do not set property.
                                    </p>
                                    <p>
Note: if path contains characters "\" or "=" , these characters should be escaped (thus "\" = "\\", "=" =&gt;"\=")
                                    </p>
                                    <p>
Note: this property can not be set at the same time as TSA_WORKER (see below).
                                    </p>
                                    <p>
Default: not set (no timestamping).
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>TSA_WORKER</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Specify a worker ID or worker name for a time stamp signer
                                    </p>
                                    <p>
This will use internal calls and can only be used for a time stamp authority running in the same SignServer instance.
                                    </p>
                                    <p>
Note: use this option instead of TSA_URL when using a time stamp signer running in the same SignServer instance
to avoid thread deadlocks under high load.
                                    </p>
                                    <p>
Note: this property can not be set at the same time as TSA_URL (see above).
                                    </p>
                                    <p>
Default: not set (no timestamping).
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>TSA_USERNAME &amp; TSA_PASSWORD</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
If the TSA requires authentication for timestamping, specify username and password. If the TSA does not require authentication, do not set these properties. These properties are ignored if TSA_URL is not set (no timestamping).
                                        </p>
                                        <p>
Default: not set (tsa does not require authentication).
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>EMBED_CRL</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
If we want to embed the CRL for signer certificate inside the signature package set to True, otherwise set to False.
                                        <p>
Default: "False".
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>EMBED_OCSP_RESPONSE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
If we want to embed the OCSP response for the signer certificate inside the signature package set to True, otherwise set to False.
                                        </p>
                                        <p>
Note: issuer certificate (of signing certificate) should be in certificate chain.
                                        </p>
                                        <p>
Note: OCSP responses must contain a nextUpdate field in order for off-line validation to work with Adobe Reader. For EJBCA OCSP Responder see configuration of ocsp.untilNextUpdate in ocsp.properties.
                                        </p>
                                        <p>
Default: "False".
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>ARCHIVETODISK</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
If we want the produced signed document to be stored in the local file system set this property to true and add the ARCHIVETODISK_PATH_BASE property explained below.
                                        </p>
                                        <p>
Default: "False".
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>ARCHIVETODISK_PATH_BASE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
The file path to the folder to store the signed documents in.
                                        </p>
                                        <p>
Required if ARCHIVETODISK is True.
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>ARCHIVETODISK_PATH_PATTERN</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Pattern used for creating sub-folders under the ARCHIVETODISK_PATH_BASE folder. 
                                        </p>
                                        <p>
Current date can be put in by adding ${DATE:yyyy} where yyyy can be replaced be the same syntax as defined in the class java.text.SimpleDateFormat. Other fields are:
                                        <ul>
                                            <li>${WORKERID}</li>
                                            <li>${WORKERNAME}</li>
                                            <li>${REMOTEIP}</li>
                                            <li>${REQUESTID}</li>
                                            <li>${TRANSACTIONID}</li>
                                            <li>${USERNAME}</li>
                                        </ul>
                                        </p>
                                        <p>
Default: "${DATE:yyyy/MM/dd}".
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>ARCHIVETODISK_FILENAME_PATTERN</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Pattern used for creating the filename. The same fields and syntax as for the ARCHIVETODISK_PATH_PATTERN property can be used.
                                        </p>
                                        <p>
Default: "${WORKERID}-${REQUESTID}-${DATE:HHmmssSSS}.pdf".
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>REFUSE_DOUBLE_INDIRECT_OBJECTS</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
True if PDF documents containing multiple indirect objects with the same name should be refused. Used to mitigate a collision signature  vulnerability described in <a href="http://pdfsig-collision.florz.de/">http://pdfsig-collision.florz.de/</a>.
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>REJECT_PERMISSIONS</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Reject signing of the document if any of the permissions in the comma separated list would be in the document.
                                        </p>
                                        <p>
Available permissions (from the PDF reference, version 1.6, page 99, TABLE 3.20):
											<table cellspacing="1" cellpadding="4" class="ForrestTable">
												<tr>
													<td>ALLOW_PRINTING</td>
													<td>
Print the document to a representation
from which a faithful digital copy of the
PDF content could be generated. When
this is not set (and ALLOW_DEGRADED_PRINTING is set), printing
is limited to a low-level representation
of the appearance, possibly of
degraded quality.
													</td>
												</tr>
												<tr>
													<td>ALLOW_MODIFY_CONTENTS</td>
													<td>
Modify the contents of the document by
operations other than those controlled
by ALLOW_MODIFY_ANNOTATIONS, ALLOW_FILL_IN, and ALLOW_SCREENREADERS.
													
													</td>
												</tr>
												<tr>
													<td>ALLOW_COPY</td>
													<td>
Copy or otherwise extract text and
graphics from the document, including
extracting text and graphics (in support
of accessibility to users with disabilities
or for other purposes).
													</td>
												</tr>
												<tr>
													<td>ALLOW_MODIFY_ANNOTATIONS</td>
													<td>
Add or modify text annotations, fill in
interactive form fields, and, if ALLOW_MODIFY_CONTENTS is
also set, create or modify interactive
form fields (including signature fields).
													</td>
												</tr>
												<tr>
													<td>ALLOW_FILL_IN</td>
													<td>
Fill in existing interactive form fields
(including signature fields), even if ALLOW_MODIFY_ANNOTATIONS
is not set.
													</td>
												</tr>
												<tr>
													<td>ALLOW_SCREENREADERS</td>
													<td>
Extract text and graphics (in support of
accessibility to users with disabilities or
for other purposes).
													</td>
												</tr>
												<tr>
													<td>ALLOW_ASSEMBLY</td>
													<td>
Assemble the document (insert, rotate,
or delete pages and create bookmarks
or thumbnail images), even if ALLOW_MODIFY_CONTENTS is
not set.

													</td>
												</tr>
												<tr>
													<td>ALLOW_DEGRADED_PRINTING</td>
													<td>
Print the document (possibly not at the
high-est quality level, depending on
whether ALLOW_PRINTING is also set).
													</td>
												</tr>
											</table>
                                        </p>
                                        <p>
Default: unset/empty (no permissions are rejected)
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SET_PERMISSIONS</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Replace the current permissions (if any) with the permissions specified in this comma separated list of permissions.
                                        </p>
                                        <p>
Available permissions: The same permission names as for the property REJECT_PERMISSIONS.    
                                        </p>
                                        <p>
This property can not be specified if REMOVE_PERMISSIONS is used.    
                                        </p>
                                        <p>
Notice 1: This property and the REMOVE_PERMISSIONS property only sets the permissions setting in the document. All permissions might not be enforced by the PDF reader and some permissions even though specified by this property to be allowed might not be allowed when opening the final document (i.e. if that would invalidate the signature and/or certification).
                                        </p>
                                        <p>
Notice 2: If the document is not already protected by an owner password and the SET_OWNERPASSWORD is not specified a random password will be used as owner password.    
                                        </p>
                                        <p>
Default: unset (permissions are not set by this property)
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>REMOVE_PERMISSIONS</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Remove all permissions specified in this comma separated list from the document.
                                        </p>
                                        <p>
Available permissions: The same permission names as for the property REJECT_PERMISSIONS.    
                                        </p>
                                        <p>
This property can not be specified if SET_PERMISSIONS is used.    
                                        </p>
                                        <p>
Notice: This property only removes the permissions listed even if some permissions (i.e. ALLOW_PRINTING) by the standard gives more permissions (i.e. also ALLOW_DEGRADED_PRINTING). To remove all permissions to print remove both ALLOW_PRINTING and ALLOW_DEGRADED_PRINTING. To still have ALLOW_DEGRADED_PRINTING it is possible to specify to only remove ALLOW_PRINTING.
                                        </p>
                                        <p>
See also Notice 1 and Notice 2 for REMOVE_PERMISSIONS which also applies to this setting.
                                        </p>
                                        <p>
Removing only ALLOW_DEGRADED_PRINTING has no effect as degraded printing is implicitly allowed if printing is allowed.    
                                        </p>
                                        <p>
Default: unset/empty (no permissions are removed)
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SET_OWNERPASSWORD</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                        <p>
Sets the specified password as owner password in the document.
                                        </p>
                                        <p>
The same permissions as before will be used (unless other properties will change them). The same encryption algorithm as the original document will be used. If the original document did not use any encryption then the default encryption algorithm will be used.    
                                        </p>
                                        <p>
Default: unset (if the permissions are changed, the existing owner password will be used or if no such password is used in the document a semi-random password will be created)
                                        </p>
                                    
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>DIGESTALGORITHM</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Sets the hash algorithm used for the message digest and signature hash.
                                    </p>
                                    <p>
Setting this property will also imply a minimum PDF version depending on the hash used.
The resulting PDF will be upgraded to this version if it's higher than the version used
in the original PDF.
Since upgrading the version requires re-creating the file (i.e. not appending the new signature)
this is not supported on already signed document (i.e. using a hash algorithm requiring a higher version than the original document).
Attempting to sign such a document will result in a failure.
                                    </p>
                                    <p>
Supported hash algorithms.
                                    </p>
                                    <p>
                                        <table>
                                            <tr>
                                                <th>Algorithm</th>
                                                <th>PDF version</th>
                                            </tr>
                                            <tr>
                                                <td>SHA1</td>
                                                <td>1.3</td>
                                            </tr>
                                            <tr>
                                                <td>SHA256</td>
                                                <td>1.6</td>
                                            </tr>
                                            <tr>
                                                <td>SHA384</td>
                                                <td>1.7</td>
                                            </tr>
                                            <tr>
                                                <td>SHA512</td>
                                                <td>1.7</td>
                                            </tr>
                                            <tr>
                                                <td>RIPEMD160</td>
                                                <td>1.7</td>
                                            </tr>
                                        </table>
                                    </p>
 
                                    <p>
Default SHA1.
                                    </p>
                                
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="ODF Signer"></a>
        ODF Signer
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.odfsigner.ODFSigner
                        </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
ODF Signer, which stands for Open Document Format Signer is a plug-in to SignServer that applies server side signature to documents in ODF format. It has been tested with OpenOffice.org 3.1.
                        </p>
	      				  <p>
	   ODF Signer supports only "invisible" signatures, that is unlike PDF signer there's no pictorial representation of the digital signature. When you open signed document in OpenOffice.org you can verify signature using toolbars, or the notifier in status bar (red mark), which notifies user that the document is digitally signed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
	  Other than standard worker properties, ODF Signer does not have any other custom ODF signer specific properties.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="XML Signer"></a>
        XML Signer
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.xmlsigner.XMLSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The XML Signer creates enveloped XML signatures using XMLDSig.
                        </p>
	      				  <p>
The signed XML document can be validated using the XML Validator.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
				<b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the data (default: depending on the signer's private key: SHA1withDSA for DSA keys, SHA1withRSA for RSA keys, and SHA1withECDSA for ECDSA keys.)
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Supported Signature Algorithms"></a>
        *** Supported Signature Algorithms ***
      </h5>
      				  <ul>
                            <li>SHA1withDSA</li>
                            <li>SHA1withRSA</li>
                            <li>SHA256withRSA</li>
                            <li>SHA384withRSA</li>
                            <li>SHA512withRSA</li>
                            <li>SHA1withECDSA</li>
                            <li>SHA256withECDSA</li>
                            <li>SHA384withECDSA</li>
                            <li>SHA512withECDSA</li>
                        </ul>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="XAdES Signer"></a>
        XAdES Signer
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.xades.signer.XAdESSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The XAdES Signer creates XML signatures according to the specified profile of XAdES.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
                            <b>XADESFORM</b> = Which profile of XAdES to use. Currently BES and T is supported. Default: BES<br />
                            <b>COMMITMENT_TYPES</b> = List of commitment types to be indicated in the signature. Multiple values can be given separated by ",". See list below for valid values. Optionally the constant NONE can be used to explicitly state that no commitment types should be included (this constant can only be used alone). Optional. Default: no commitment types are included.<br /> 
                            <b>SIGNATUREALGORITHM</b> = The algorithm used to sign the data. The same set of algorithms as for the same property in XMLSigner is supported. Optional. Default: depending on the signer's private key: SHA1withDSA for DSA keys, SHA256withRSA for RSA keys, and SHA1withECDSA for EC keys.<br />
                            <b>CLAIMED_ROLE</b> = Claimed role to include in the signature. If the CLAIMED_ROLE_FROM_USERNAME property is also set, this value is used as a fallback when there is no user name provided in the request. Optional. Default: no default claimed role defined.<br />
                            <b>CLAIMED_ROLE_FROM_USERNAME</b> = If this is set to true, use the user name from the request (provided by an authorizer) as the value for claimed role. If there is no user name provided fall back to the value set by CLAIMED_USER. If this is set to true and CLAIMED_ROLE is not set and the request doesn't contain a user name, the request will result in an error. Optional. Default: false.<br />
                            <b>INCLUDE_CERTIFICATE_LEVELS</b> = Number of certificate levels to include in the document's KeyInfo (also see the common properties above). Minimum and default value is 1 which includes only the signer certificate. The value 2 includes the signer certificate and its issuer. To include all certificates specify at least the same value as number of certificates in the certificate chain.

                            <b>TSA_URL</b> = URL of timestamp authority. Required if XADESFORM=T and TSA_WORKER not specified.<br />
                            Note: this property can not be set at the same time as TSA_WORKER (see below).<br />

                            <b>TSA_WORKER</b> = Specify a worker ID or worker name for a time stamp signer. Required if XADESFORM=T and TSA_URL not specified.<br />
                            This will use internal calls and can only be used for a time stamp authority running in the same SignServer instance.<br />
                            Note: Use this option instead of TSA_URL when using a time stamp signer running in the same SignServer instance to avoid thread deadlocks under high load.<br />
                            Note: This property can not be set at the same time as TSA_URL (see above).<br />

                            <b>TSA_USERNAME</b> = Login username used if the TSA uses HTTP Basic Auth.<br />
                            <b>TSA_PASSWORD</b> = Login password used if the TSA uses HTTP Basic Auth.<br />
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Commitment Types"></a>
        *** Commitment Types ***
      </h5>
      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="1" rowspan="1"
      valign="top" align="left">
          Value
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Description
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          NONE
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Don't include any commitment type. This can not be used in conjunction with the other constants below
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_APPROVAL
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that the signer has approved the content of the signed data object
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_CREATION
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that the signer has created the signed data object (but not necessarily approved, nor sent it)
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_DELIVERY
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that the TSP providing that indication has delivered a signed data object in a local store accessible to the recipient of the signed data object
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_ORIGIN
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that the signer recognizes to have created, approved and sent the signed data object
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_RECEIPT
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that signer recognizes to have received the content of the signed data object
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          PROOF_OF_SENDER
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Indicates that the entity providing that indication has sent the signed data object (but not necessarily created it)
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="OOXML Signer"></a>
        OOXML Signer
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.ooxmlsigner.OOXMLSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
OOXML Signer, which stands for Office Open XML Signer is a plug-in to SignServer that applies server side signature to documents in OOXML format. It has been tested with MS Office 2007.
                        </p>
	      				  <p>
	   Currently OOXML Signer supports only "invisible" signatures , that is unlike PDF signer there's no pictorial representation of the digital signature. When you open signed document in MS Office you can verify signature using toolbars, or the notifier in status bar (red mark), which notifies user that the document is digitally signed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
	  Other than standard worker properties, OOXML Signer does not have any other custom OOXML signer specific properties.
                        </p>
	      				  <p>
NOTE : In later versions of OOXML Signer it is planned to add support for visible signatures and custom signature image.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="CMS Signer"></a>
        CMS Signer
      </h4>
      				  <p>
The CMS signer has the fully qualified class name: org.signserver.module.cmssigner.CMSSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The CMS signer can sign arbitrary data and produces a CMS (RFC 3852) SignedData
structure in binary format with or without the content encapsulated.
                        </p>
	      				  <p>
Currently the signer certificate is always included.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
                            <b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the data (default: depending on the signing key: SHA1withDSA for DSA keys,
                                                        SHA1withECDSA for ECDSA keys, otherwise SHA1withRSA)
                        </p>
	      				  <p>
                            <b>DETACHEDSIGNATURE</b> = property specifying if a detached signature (a.k.a. "external signature") should be used. That is a signature where the content is not included/encapsulated. Default is false.
                        </p>
	      				  <p>
                            <b>ALLOW_DETACHEDSIGNATURE_OVERRIDE</b> = property specifying if the requestor can request an other value for DETACHEDIGSNATURE than what is configured. Default is false.<br />
                            If set to true a request could include a metadata property with an other value for DETACHEDSIGNATURE.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="MS Authenticode Signer"></a>
        MS Authenticode Signer
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This is a SignServer Enterprise Edition (EE) feature.
                    </div>
</div>
	      				  <p>
The signer has the fully qualified class name: org.signserver.module.msauthcode.signer.MSAuthCodeSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The signer signs portablable executable files such as Windows executables and shared libraries (.exe, .dll and .ocx etc) according to the Windows Authenticode Portable Executable Signature Format.
The signature can optionally include a timestamp response from a TSA using the Authenticode format.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
                            <b>PROGRAM_NAME</b> = Program name to embed in the signature (Optional, default: none)
                        </p>
	      				  <p>
                            <b>ALLOW_PROGRAM_NAME_OVERRIDE</b> = If the requestor should be able to override the program name by supplying it as a request metadata property (Optional, default: false)
                        </p>
	      				  <p>
                            <b>PROGRAM_URL</b> = Program URL to embed in the signature (Optional, default: none)
                        </p>
	      				  <p>
                            <b>ALLOW_PROGRAM_URL_OVERRIDE</b> = If the requestor should be able to override the program URL by supplying it as a request metadata property (Optional, default: false)
                        </p>
	      				  <p>
                            <b>SIGNATUREALGORITHM</b> = Signature algorithm (Optional, default: depending on the signing key, SHA1withRSA, SHA1withDSA or SHA1withECDSA)
                        </p>
	      				  <p>
                            <b>DIGESTALGORITHM</b> = Algorithm for the digest of the binary (Optional, default: SHA-1)
                        </p>
	      				  <p>
                            <b>TSA_WORKER</b> = Worker ID or name of internal (authenticode) timestamp signer in the same SignServer (Optional, default: none). This property can not be combined with TSA_URL.
                        </p>
	      				  <p>
                            <b>TSA_URL</b> = URL of external (authenticode) timestamp authority (Optional, default: none). This property can not be combined with TSA_WORKER.
                        </p>
	      				  <p>
                            <b>TSA_USERNAME</b> = Login username used if the TSA uses HTTP Basic Auth (Optional, default: none).
                        </p>
	      				  <p>
                            <b>TSA_PASSWORD</b> = Login password used if the TSA uses HTTP Basic Auth (Required if TSA_USERNAME specified, default: none).
                        </p>
	      				  <p>
                            <b>DO_LOGREQUEST_DIGEST</b> = If a digest of the request should be computed and logged (Optional, default: true).
                        </p>
	      				  <p>
                            <b>LOGREQUEST_DIGESTALGORITHM</b> = Algorithm used to create the message digest (hash) of the request document to put in the log (default: SHA256).
                        </p>
	      				  <p>
                            <b>DO_LOGRESPONSE_DIGEST</b> = If a digest of the response should be computed and logged (Optional, default: true).
                        </p>
	      				  <p>
                            <b>LOGRESPONSE_DIGESTALGORITHM</b> = Algorithm used to create the message digest (hash) of the response document to put in the log (default: SHA256).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Request Properties"></a>
        *** Request Properties ***
      </h5>
      				  <p>
                            This worker can accept the following request metdata properties, given that they are configured to be allowed:
                        </p>
	      				  <p><b>PROGRAM_NAME</b> = Program name text to use instead of the configured one (if any).
                                                 Specifying an empty value removes the configured program name.
                                                 Without ALLOW_PROGRAM_NAME_OVERRIDE configured in the worker request including this request property will not be allowed.</p>
	      				  <p><b>PROGRAM_URL</b> = Program URL to use instead of the configured one (if any).
                                                 Specifying an empty value removes the configured program URL.
                                                 Without ALLOW_PROGRAM_URL_OVERRIDE configured in the worker request including this request property will not be allowed.</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Log Fields"></a>
        *** Worker Log Fields ***
      </h5>
      				  <p>
                            <b>REQUEST_DIGEST</b> = A message digest (hash) for the request document in hex encoding.
                        </p>
	      				  <p>
                            <b>REQUEST_DIGEST_ALGORITHM</b> = The name of the message digest (hash) algorithm used for the request digest in the log.
                        </p>
	      				  <p>
                            <b>RESPONSE_DIGEST</b> = A message digest (hash) for the response document in hex encoding.
                        </p>
	      				  <p>
                            <b>RESPONSE_DIGEST_ALGORITHM</b> = The name of the message digest (hash) algorithm used for the response digest in the log.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Master List Signer"></a>
        Master List Signer
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This is a SignServer Enterprise Edition (EE) feature.
                    </div>
</div>
	      				  <p>
The Master List signer has the fully qualified class name: org.signserver.module.masterlist.signer.MasterListSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Produces a signed list of CSCA certificates according to the ICAO specification MRTD TR CSCA countersigning and Master List issuance, version 1.0.
                        </p>
	      				  <p>
As mandated by the specification, both the signer certificate and the CSCA certificates are included in the signature. The INCLUDE_CERTIFICATE_LEVELS property is thus not allowed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
                            <b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the data (default: depending on the signing key: SHA1withDSA for DSA keys,
                                                        SHA1withECDSA for ECDSA keys, otherwise SHA1withRSA)
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Plain Signer"></a>
        Plain Signer
      </h4>
      				  <p>
The Plain signer has the fully qualified class name: org.signserver.module.cmssigner.PlainSigner
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The Plain signer can sign arbitrary data and simply produces a signature in the
format determined by the configured signature algorithm.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
                            <b>SIGNATUREALGORITHM</b> = property specifying the algorithm used to sign the data (default: depending on the signing key: SHA1withDSA for DSA keys,
                                                        SHA1withECDSA for ECDSA keys, otherwise SHA1withRSA)
                        </p>
	      				  <p>
                            <b>LOGREQUEST_DIGESTALGORITHM</b> = property specifying the algorithm used to create the message digest (hash) of the request document to put in the log (default: SHA256).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Log Fields"></a>
        *** Worker Log Fields ***
      </h5>
      				  <p>
                            <b>REQUEST_DIGEST</b> = A message digest (hash) for the request document in hex encoding.
                        </p>
	      				  <p>
                            <b>REQUEST_DIGEST_ALGORITHM</b> = The name of the message digest (hash) algorithm used for the request digest in the log.
                        </p>
	      				  <p>
                            <b>RESPONSE_ENCODED</b> = The response document (plain signature) in base64 encoding.
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer Document Validators"></a>
      SignServer Document Validators
    </h3>
      				  <p>
Document Validators checks the signature and the certificate(s) in documents.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="XML Validator"></a>
        XML Validator
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The XML validator validates the signature of XML documents. The certificate is checked by the configured certificate validation service.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>VALIDATIONSERVICEWORKER</b> = Name or id of validation service worker for handling certificate validation</p>
	      				  <p><b>RETURNDOCUMENT</b> = True if the response should contain the validated document</p>
	      				  <p><b>STRIPSIGNATURE</b> = True if the signature should be removed from the document if it is returned</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="XAdES Validator"></a>
        XAdES Validator
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The XAdES validator validates the signature of XAdES documents and validatates the certificate chain. The validator will also validate embedded timestamp tokens in XAdES form T-signed documents.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>TRUSTANCHORS</b> = Trusted certificates. In PEM format. When validating a XAdES form T-signed document, must include the trusted certificate for the time stamp authory as well. Required.</p>
	      				  <p><b>CERTIFICATES</b> = Intermediate CA certificates that might be needed to build a trust path from the signer certificates to any of the trusted certifivcates. In PEM format.</p>
	      				  <p><b>REVOCATION_CHECKING</b> = True if revocation checking should be performed. The intermediate CA certificates (if any) and the signer certificate needs to have an Authority Information Access URL to an online OCSP responder or an CRL Distribution Point from where a CRL can be downloaded. If both are available the OCSP responder will be consulted first and then the CRL if the reseponder were unavailable. Default: true</p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer Dispatchers"></a>
      SignServer Dispatchers
    </h3>
      				  <p>
Dispatchers are workers that forwards the request to other workers.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="FirstActiveDispatcher"></a>
        FirstActiveDispatcher
      </h4>
      				  <p>
Fully qualified class name: org.signserver.server.dispatchers.FirstActiveDispatcher
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Dispatches the request to the first of the configured workers that has an active
cryptotoken. This dispatcher can be useful if you want to have one worker to call
that forwards the request to any of the configured workers that has a valid
certificate etc.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>WORKERS</b> = Comma separated list of workerNameS to try to forward requests to.</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="RequestedPolicyDispatcher"></a>
        RequestedPolicyDispatcher
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.tsa.RequestedPolicyDispatcher
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Dispatches the Time-stamp request to an other signer based on the requested TSA Policy according to an configured mapping table.

This dispatcher can be useful if you want to have multiple signers (Time Stamp Units) signing with different TSA policies but don't want the client to have to call different workers.
                        </p>
	      				  <p>
See also the DispatchedAuthorizer which if configured by a signer can allow all requests that has gone through a Dispatcher.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>DEFAULTWORKER</b> = Worker name or ID to dispatch to in case no policy was requested.</p>
	      				  <p><b>USEDEFAULTIFMISMATCH</b> = If true dispatches to DEFAULTWORKER in case no mapping existed for the requested policy OID (default: false)</p>
	      				  <p><b>MAPPINGS</b> = Mapping from requested policy OID to a worker name.
                        <br />The property is of the form:
                        <br />POLICYOID1:WORKERNAMEORID1; POLICYOID2:WORKERNAMEORID2; POLICYOID3:WORKERNAMEORID3;</p>
	      				  <p>
<b>INCLUDESTATUSSTRING</b> = Specifies if the status string is to be included in the response. 
This setting only affects the behavior when USEDEFAULTIFMISMATCH is false, and there is no mapping for the requested policy.
In case there is a mapping (or no mapping and USEDEFAULTIFMISMATCH is true, the state of INCLUDESTATUSSTRING of the used signer is used
to determine if the status string is included.
Setting this to true triggers a bug in some versions of OpenJDK's jarsigner utility. (OPTIONAL), default true.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="UserMappedDispatcher"></a>
        UserMappedDispatcher
      </h4>
      				  <p>
Fully qualified class name: org.signserver.server.dispatchers.UserMappedDispatcher
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Dispatches the request to a worker based on a mapping from username and workername.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>USERNAME_MAPPING</b> = Comma separated list of mappings from user name to worker name.
                        <br />The property is of the form:
                        <br />username1:workername1, username2:workername2
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer Validation Service Framework"></a>
      SignServer Validation Service Framework
    </h3>
      				  <p>
The validation service framework is used to validate certificates from one or more issuers. It can be used to  have one central point of performing revokation statuses to simplify the integration of external PKIs within an enterprise.
                </p>
	      				  <p>
The validation service framework also provides a validation cache that can be used to increase performance for those cases a application does multiple lookups of the same certificate within a short period of time.
                </p>
	      				  <p>
Out-of-the-Box there exists a DefaultValidationService that should satisfy most use cases but it's possible to develop a custom ValidationService if necessary. See the developer section for more details.
                </p>
	      				  <p>
All Validation Services is configured by specifying the org.signserver.validationservice.server.ValidationServiceWorker in the global configuration, then is the actual ValidationService configured in the worker configuration setting the class path in the property TYPE (Not necessary for the DefaultValidationService).
                </p>
	      				  <p>
The validation service framework is mostly used with X509v3 certificates but other kinds of certificates is supported as well by design.
                </p>
	      				  <p>
Another concept in the Validation Service Framework is that the client also can ask the service to check the type of certificate that the certificate might be used for. A certificate type could be IDENTIFICATION or ELECTRONIC SIGNATURE.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="DefaultValidationService"></a>
        DefaultValidationService
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The default validation service have a set of Validators. A validator is responsible to checking the validity against one or more issuers using for example CRL check or OCSP/XKMS lookup or just by checking some database. Currently there are no ready to use validators, these remain to be developed in future versions of the SignServer.
                        </p>
	      				  <p>
The Default Validation Service supports validations to be cached for some or all issuers for a specified amount of time.
                        </p>
	      				  <p>
If not configured otherwise will the validation service use the DefaultX509CertTypeChecker that determines the certificate type from the key usage in the certificate.  Key Encipherment and Digital Signature indicates a IDENTIFICATION type and Non-reputation and/or Digital Signature indicates ELECTRONIC_SIGNATURE.
                        </p>
	      				  <p>
There exists a validation specific WebService that can be used for platform independent client calls.
The WebService must be enabled during the build and isn't by default. The WebService WSDL file is located at the URL http://&lt;hostname&gt;:8080/signserver/validationws/validationws?wsdl and it contains two calls one is 'isValid' that performs the validation check and the other is a getStatus call that checks the health of the node and its underlying systems. The last calls can be used by clients for monitoring or implementing redundancy.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
The following properties can be configured with the default validation service:
                        </p>
	      				  <p>
The validation service have three types of properties, general properties (that applies for the service and all configured validators), validator properties (that only applies for a specific validator) and issuer properties (that only applies for an issuer configured in a specific validator).
                        </p>
	      				  <p>
<i>General Properties:</i><br />
                        </p>
	      				  <p>
<b>CACHEDISSUERS</b> = A ';' separated list of issuer names (usually issuer DNs)  (Optional, no validation is cached if unset.)
                        </p>
	      				  <p>
<b>CERTTYPECHECKER</b> = Certificate type checker that should be used to determine the type of certificate (Optional, default is org.signserver.validationservice.server.DefaultX509CertTypeChecker)
                        </p>
	      				  <p>
<b>TIMEINCACHE</b> = Time in seconds a certificates validation should be cached (Optional, default is 10 seconds)
                        </p>
	      				  <p>
<i>Validator properties:</i><br />
Validator properties is specified with the prefix of 'validator&lt;validatorId&gt;.' or 'val&lt;validatorId&gt;.' were validator Id should be an integer between 1 and 255. For instance, to specify the type of a validator with an id of 1 then specify 'val1.classpath=some.classpath.SomeClass'. This validator will be initialized with all its validator specific properties (with 'val&lt;id&gt;.' prefix removed) as well as the general ones.
                        </p>
	      				  <p>
<b>CLASSPATH</b> = Fully qualified class name of the validator that should be used. (Required for each configured validator)
                        </p>
	      				  <p>
<i>Issuer properties:</i>  Issuer properties are specified as 'val&lt;val id&gt;.issuer&lt;issuer id&gt;.&lt;property&gt;' were issuer id is a positive integer between 1 and 255. All generic and validator specific properties (with the given validator id) will also be propagated to the specific issuer configuration.
                        </p>
	      				  <p>
<b>CERTCHAIN</b> = The certificate path of the CA certificates used to verify the certificate. Should be a appended BASE64 string. (Required for each configured issuer).
                        </p>
	      				  <p>
Here is an example configuration of a validation service to clarify things even further
                        </p>
	      				  <pre>
# Set up the worker -&gt; validation service wrapper
GLOB.WORKER1.CLASSPATH= org.signserver.validationservice .server.ValidationServiceWorker
#Uncomment and set class path to custom validation service, othervise is default #used.
#WORKER1.TYPE=

# Name of Service (Optional)
WORKER1.NAME=ValidationService1

# Define TestCA2 and TestCA3 as a cached for 15 seconds, TestCA1 is Not cached.
WORKER1.CACHEDISSUERS=CN=TestCA2;CN=TestCA3
WORKER1.TIMEINCACHE=15

# Define a validator in charge of issuer TestCA1 and TestCA2
WORKER1.VAL1.CLASSPATH=&lt;Class path to some validator&gt;
WORKER1.VAL1.ISSUER1.CERTCHAIN=EFWAASDFADFASDFKASDKFW1231.....
WORKER1.VAL1.ISSUER2.CERTCHAIN=EFWAASDFADFASDFKASDKFW1231.....

# Define a validator in charge of issuer TestCA3
WORKER1.VAL2.CLASSPATH=&lt;Class path to some validator&gt;
WORKER1.VAL2.ISSUER1.CERTCHAIN=EFWAASDFADFASDFKASDKFW1231.....
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Certificate Validators"></a>
        Certificate Validators
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="CRLValidator"></a>
        *** CRLValidator ***
      </h5>
      				  <p>
Class name: <b>org.signserver.validationservice.server.CRLValidator</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="OCSPValidator"></a>
        *** OCSPValidator ***
      </h5>
      				  <p>
Class name: <b>org.signserver.validationservice.server.OCSPValidator</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="OCSPCRLValidator"></a>
        *** OCSPCRLValidator ***
      </h5>
      				  <p>
Class name: <b>org.signserver.validationservice.server.OCSPCRLValidator</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="NoRevocationCheckingValidator"></a>
        *** NoRevocationCheckingValidator ***
      </h5>
      				  <p>
Class name: <b>org.signserver.validationservice.server.NoRevocationCheckingValidator</b>
                        </p>
	      				  <p>
Certificate Validator that validates the certificate chain but does not perform any revocation checking. This can be useful for demonstation purposes or when revocation checking should not be performed.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="DummyValidator"></a>
        *** DummyValidator ***
      </h5>
      				  <p>
Class name: <b>org.signserver.validationservice.server.DummyValidator</b>
                        </p>
	      				  <p>
Certificate Validator that only works for specific issuers and certificates and is only available for testing and demonstration purposes as no real certificate validation is performed. The keystores under res/test/dss10/ with certificates issued by "DSS Root CA 10" can for instance be used together with this validator.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="The Validation CLI interface."></a>
        The Validation CLI interface.
      </h4>
      				  <p>
There exists a Java CLI tool that can be used to check the validity of a certificate from scripts. It supports a clustered SignServer installation by using the "Use first host that response OK" policy.
                    </p>
	      				  <p>
When compiling, make sure that setting validationclient.enabled is set to "true" in the build properties. The client is lib/SignServer-Client-ValidationCLI.jar.
                    </p>
	      				  <p>
Use the client with 'java -jar lib/SignServer-Client-ValidationCLI.jar &lt;options&gt;'.
                    </p>
	      				  <pre>
Here is a list of available options:

-cert &lt;cert-file&gt; 			: Path to certificate file (DER or PEM) (Required).
-certpurposes &lt;certpurposes&gt;  	: A ',' separated string containing requested certificate purposes.
-der                           			: Certificate is in DER format.
-help                          			: Display this info
-hosts &lt;hosts&gt;                 		: A ',' separated string containing the hostnames of the validation service nodes. Ex 'host1.someorg.org,host2.someorg.org' (Required)
-pem                    	       		: Certificate is in PEM format (Default).
-port &lt;port&gt;                   		: Remote port of service (Default is 8080 or 8442 for SSL).
-service &lt;service-name&gt;        	: The name or id of the validation service to process request. (Required)
-silent                        			: Don't produce any output, only return value.
-truststore &lt;jks-file&gt;         		: Path to JKS truststore containing trusted CA for SSL Server certificates.(for HTTPS connections)
-truststorepwd &lt;password&gt;      	: Password to unlock the truststore.


The following return values is used:

-2   : Error happened during execution
-1   : Bad arguments
0   : Certificate is valid
1   : Certificate is revoked
2   : Certificate is not yet valid
3   : Certificate have expired
4   : Certificate doesn't verify
5   : CA Certificate have been revoked
6   : CA Certificate is not yet valid
7   : CA Certificate have expired.
8   : Certificate have no valid certificate purpose.
                   </pre>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Timed Services"></a>
      Timed Services
    </h3>
      				  <p>
A Timed Service (formerly called just service) is a task that is run on a timely basis, performing maintenance tasks like changing active key, or it could generate a report.
                </p>
	      				  <p>
A Timed Service framework supports a couple basic properties that is used to calculate when and how a timed service should run. These properties are:
                </p>
	      				  <p>
<b>ACTIVE</b> =  "TRUE" if the service should be run, otherwise it is disabled.
                </p>
	      				  <p>
<b>SINGLETON</b> =  "TRUE" if the service only should be run on one of the nodes in the cluster at the time. If it's not set or set to FALSE is the service run simultaneously on all nodes in the cluster. If the node running a singleton service fails will another node sense this and start up the service.
                </p>
	      				  <p>
<b>INTERVAL</b> = Property defining the interval in seconds the service should run.
                </p>
	      				  <p>
<b>INTERVALMS</b> = Property defining the interval in milliseconds the service
should run. Notice that the platform and application server might put a lower
bound on the value. The lower limit for GlassFish is by default 7000 milliseconds
but can be changed by editing minimum-delivery-interval-in-millis in domain.xml.
                </p>
	      				  <p>
<b>CRON</b> = Property that should define a CRON expression of how often the service should run.  It should conform to Unix CRON standard. (One and only one of INTERVAL, INTERVALMS or CRON is required)
                </p>
	      				  <p>
<b>WORK_LOG_TYPES</b> = Property specifying a comma-separated list of log types that should be used for logging invocations of the service.<br />
The following values can be used:

<table>
    <tr>
        <td>INFO_LOGGING</td>
        <td>Use Log4J info logging</td>
    </tr>
    <tr>
        <td>SECURE_AUDITLOGGING</td>
        <td>Use CESeCore secure audit logging</td>
    </tr>
</table>

By default, if this property is not set, INFO_LOGGING is used.
It is possible to turn off logging by setting this property to an empty value.
Errors during service invocations will always be logged at error level using Log4J.
If the property contains SECURE_AUDITLOGGING, the error will additionally be logged
to the audit log.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="SignerStatusReportTimedService"></a>
        SignerStatusReportTimedService
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.signerstatusreport.SignerStatusReportTimedService
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The SignerStatusReportTimedService is a timed service that outputs status for a
set of workers to a file. The information includes each workers crypto token status
ACTIVE/OFFLINE and if available also the numbers of signatures that has been
performed with the key currently associated with the worker. If the worker has
a configured limit of number of signatures, this value is also included. See 
also the <a href="#SignerStatusReportWorker">SignerStatusReportWorker</a> which 
is an alternative way of offering this reports.
                        </p>
	      				  <p>
<b>Format:</b>
                        </p>
	      				  <pre>
workerName=WORKERNAME1, status=STATUS1, KEY3=VALUE3, KEY4=VALUE4, ...
workerName=WORKERNAME2, status=STATUS2, KEY3=VALUE3, KEY4=VALUE4, ...
workerName=WORKERNAME3, status=STATUS3, KEY3=VALUE3, KEY4=VALUE4, ...
...
                        </pre>
	      				  <p>
<b>Rules:</b>
<ul>
    <li>Each line contains a set of properties for one worker.</li>
    <li>Lines are separated by a system dependent newline character (CR,
LF or CRLF).</li>
    <li>Properties are of form KEY=VALUE and are separated by a comma and a
space (", ").</li>
    <li>The properties "workerName" and "status" are the only ones that must be
present.</li>
    <li>The property "workerName" is always the first property.</li>
</ul>
                        </p>
	      				  <p>
<b>Properties:</b>
<ul>
    <li><b>workerName</b>: name of the worker. Example: "sod71" or "sod72"</li>
    <li><b>status</b>: status of the worker's crypto token and key. Either
"ACTIVE" or "OFFLINE".</li>
    <li><b>validityNotBefore</b>: the first date the signer is allowed to sign.
Format is java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss z").</li>
    <li><b>validityNotAfter</b>: the last date the signer is allowed to sign.</li>
    <li><b>signings</b>: the number of signatures that has been performed with the key
used by this worker.</li>
    <li><b>signLimit</b>: the maximum number of signatures this worker is allowed
to perfom or -1 if there is no limit.</li>
</ul>
                        </p>
	      				  <p>
<b>Examples:</b>
                        </p>
	      				  <pre>
workerName=Sod71, status=ACTIVE, validityNotBefore=2010-07-05 17:32:36 CEST, validityNotAfter=2010-09-08 17:32:36 EEST, signings=132, signLimit=100000,
workerName=Sod72, status=OFFLINE, validityNotBefore=2010-07-05 17:32:33 CEST, validityNotAfter=2010-09-08 17:32:33 EEST, signings=100000, signLimit=100000,
workerName=Sod73, status=OFFLINE, validityNotBefore=2010-07-05 17:32:33 CEST, validityNotAfter=2010-09-08 17:32:33 EEST, signings=0, signLimit=100000,
workerName=Sod74, status=OFFLINE,
                        </pre>
	      				  <p>
<b>Examples explained:</b>
                        </p>
	      				  <p>
Sod71 has done 132 signings and is ACTIVE and validityNotAfter indicates
that it can continue to sign until 8th September if not the sign limit
is reached before
                        </p>
	      				  <p>
Sod72 has performed all of its 100000 signings and can not sign until it
gets a new key and certificate.
                        </p>
	      				  <p>
Sod73 has not reached its limit and is still in validity time but is
OFFLINE for some other reason.
                        </p>
	      				  <p>
Sod74 is OFFLINE and has no certificate configured.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>WORKERS</b> = Comma separated list of worker names (signers) that should
be monitored.</p>
	      				  <p><b>OUTPUTFILE</b> = File that the information will be written to. If the file
exists the content will be overwritten. The application server needs to have write
access to this file when the service is executed.

                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="HSMKeepAliveTimedService"></a>
        HSMKeepAliveTimedService
      </h4>
      				  <p>
Fully qualified class name: org.signserver.server.timedservices.hsmkeepalive.HSMKeepAliveTimedService
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The HSMKeepAliveTimedService is a timed service that can be used to periodically
run the test key operation on selected crypto workers. This is intended as a
measure to prevent HSM connections timing out.
The service will use the key alias TESTKEY for the workers when set, otherwise
it will fall back on DEFAULTKEY.
Notice that the service will not fallback on DEFAULTKEY if TESTKEY is set, but
didn't succeed when testing the key.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p><b>CRYPTOTOKENS</b> = Comma-separated list of worker names or worker IDs of
workers whos keys should be tested. This would typically be crypto workers i.e.
corresponding to different slots in an HSM, but could also be regular workers
with crypto tokens configured directly). This property is required,
but can be set to an empty value if only audit logging is needed (see below).</p>
	      				  <p><b>NOTE:</b> if secure audit logging is used and a separate crypto token
is used for logging, the service logging described above using the WORK_LOG_TYPES
property and the SECURE_AUDITLOGGING value can be used to write to the audit log
at the same time as testing crypto worker keys, to keep the auditlog crypto token
from timing-out.
</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Installing a service"></a>
        Installing a service
      </h4>
      				  <p>To install a service you use the same commands as for installing a worker:</p>
	      				  <pre class="code">
$ bin/signserver setproperties configuration.properties
                    </pre>
	      				  <p>Example:</p>
	      				  <pre class="code">
$ bin/signserver setproperties doc/sample-configs/qs_signerstatusreport_configuration.properties
===========================================
  Executing Command on host : localhost
===========================================
Configuring properties as defined in the file : doc/sample-configs/qs_signerstatusreport_configuration.properties
Setting the property ACTIVE to TRUE for worker 2
Setting the property INTERVAL to 10 for worker 2
Setting the global property WORKER2.CLASSPATH to org.signserver.server.timedservices.SignerStatusReportTimedService with scope GLOB.
Setting the property WORKERS to PDFSigner1 for worker 2
Setting the property NAME to SignerStatusReporter for worker 2
Setting the property OUTPUTFILE to /tmp/statusreport for worker 2

$ bin/signserver reload 2
===========================================
Executing Command on host : localhost
===========================================
SignServer reloaded successfully
Current configuration is now activated.
                    </pre>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Other workers"></a>
      Other workers
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="CryptoWorker"></a>
        CryptoWorker
      </h4>
      				  <p>
The Crypto Worker is a worker not performing any operations on its own and instead only hosts a Crypto Token that can be referenced by other workers.
                    </p>
	      				  <p>
Fully qualified class name: <b>org.signserver.server.signers.CryptoWorker</b>
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker properties"></a>
        *** Worker properties ***
      </h5>
      				  <p>
See the <a href="complete.en.html#Available%20CryptoTokens">Available CryptoTokens</a> for the required properties of the configured crypto token.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="RenewalWorker"></a>
        RenewalWorker
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The RenewalWorker can be used for generation a new key-pair and renewing a worker's certificate from EJBCA using web services (WS). The RenewalWorker should be configured with its own CryptoToken and an SSL client authentication certificate with permissions set up in EJBCA to issue certificates. Some properties are configured for the RenewalWorker such as the EJBCA WS endpoint URL and truststore details, other properties should be set on the worker that should be renewed (the renewee) and some arguments are provided when the worker is invoked.
                    </p>
	      				  <p>
Known limitation: It might not be possible to have multiple renewal workers using different crypto tokens because the keys and certificates used by the TLS connection for the web service is setup globally.
                    </p>
	      				  <p>
Fully qualified class name: <b>org.signserver.module.renewal.worker.RenewalWorker</b>
                    </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Requesting the worker"></a>
        *** Requesting the worker ***
      </h5>
      				  <p>
After setting up an RenewalWorker and installing its certificate signers (and other workers), can easily be renewed using the SignServer AdminGUI. See <a href="complete.en.html#Renew%20signer%20dialog">Renew Signer dialog</a>. As the RenewalWorker is a worker it can also be invoked using the normal client APIs. Using the demo web pages: <a href="http://localhost:8080/signserver/demo/genericsign.jsp">Generic Signing Demo</a>:
                    </p>
	      				  <p>
Sign by Direct Input<br />
Worker name: MyRenewalWorker<br />
Data:<br />
                    </p>
	      				  <pre class="code">
WORKER=MySigner
AUTHCODE=foo123</pre>
	      				  <p>
 Using the Client CLI:
                    </p>
	      				  <pre class="code">
bin/signclient signdocument -workername MyRenewalWorker -data &quot;WORKER=MySigner
AUTHCODE=foo123&quot;</pre>
	      				  <p>

(Notice that the command is on two lines)
                    </p>
	      				  <p>
The renewal can also be initiated from the <a href="complete.en.html#Administration%20CLI">Admin CLI</a>:
                    </p>
	      				  <pre class="code">
bin/signserver renewsigner MySigner -renewalworker MyRenewalWorker -authcode foo123
                    </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="RenewalWorker operations"></a>
        *** RenewalWorker operations ***
      </h5>
      				  <p>
The RenewalWorker starts by generating a new key-pair (unless an NEXTCERTSIGNKEY is already set for the renewee or the request property FORDEFAULTKEY=true is set in the request). The HSM/keystore password needs to be submitted as part of the request (AUTHCODE request property) to generate a new key-pair. After the key-pair has been generated and tested successfully the key alias is set as the NEXTCERTSIGNKEY property. A certificate signing request is created for the key and the worker sends the request to EJBCA to issue a certificate for the configured end entity. After receiving the certificate and certificate chain they are installed for the worker and the DEFAULTKEY property is updated with the value from NEXTCERTSIGNKEY and that property is removed.
                    </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p><b>EJBCAWSURL</b> = URL to the EJBCA. Must be specified. Example: https://ca-server:8443/ejbca</p>
	      				  <p><b>TRUSTSTOREPATH</b> = Path to the keystore containing the CA's SSL server certificate as a trusted entry. Used instead of TRUSTSTOREVALUE. If this property is not specified, TRUSTSTOREVALUE must be set.</p>
	      				  <p><b>TRUSTSTOREVALUE</b> = Keystore containing the CA's SSL server certificate as a trusted entry. Used instead of TRUSTSTOREPATH. If this property is not specified, TRUSTSTOREPATH must be set. If TRUSTSTORETYPE is not PEM the keystore is stored in the property in base64 encoding.</p>
	      				  <p><b>TRUSTSTORETYPE</b> = Type of keystore. JKS and PEM is supported. This property must be set.</p>
	      				  <p><b>TRUSTSTOREPASSWORD</b> = Password protecting the truststore keystore. This property must be set if TRUSTSTORETYPE is not PEM.</p>
	      				  <p><b>KEYSTOREPASSWORD</b> = The password that locks the key-store. Required for JKS.</p>
	      				  <p><b>DEFAULTKEY</b> = Key alias to use from the crypto token. This property must be set.</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Properties of renewee"></a>
        *** Properties of renewee ***
      </h5>
      				  <p><b>RENEWENDENTITY</b> = Name of the existing end entity in EJBCA</p>
	      				  <p><b>REQUESTDN</b> = Subject DN to set in the certificate signing request (PKCS#10).</p>
	      				  <p><b>SIGNATUREALGORITHM</b> = Signature algorithm to use when signing the certificate signing request (PKCS#10)</p>
	      				  <p><b>KEYALG</b> = Algorithm for the key generation. Examples: RSA, DSA or ECDSA</p>
	      				  <p><b>KEYSPEC</b> = Key length (for RSA or DSA) or curve name (for ECDSA). Examples: 2048, 4096, secp256r1</p>
	      				  <p><b>EXPLICITECC</b> = True if explicit domain parameters should be used instead of NamedCurves. Default: false</p>
	      				  <p><b>RENEWWORKER</b> = Name of the default RenewalWorker to use (Optional). Specify this to have the current RenewalWorker already selected in the AdminGUI when renewing signers.</p>
	      				  <p><b>DEFAULTKEY</b> = Key alias for the current existing key. The worker will update this property.</p>
	      				  <p><b>NEXTCERTSIGNKEY</b> = Key alias for the next existing key. If this property exists a new key-pair will not be generated. The worker will update/remove this property.</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Request Properties"></a>
        *** Request Properties ***
      </h5>
      				  <p><b>WORKER</b> = Name of the worker that should be renewed.</p>
	      				  <p><b>AUTHCODE</b> = HSM/keystore password for activation.</p>
	      				  <p><b>FORDEFAULTKEY</b> = If the current key should be used instead of the next key or a new key. (Optional, default: false)</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Response Properties"></a>
        *** Response Properties ***
      </h5>
      				  <p><b>RESULT</b> = "OK" if the renewal succeeded otherwise "FAILURE".</p>
	      				  <p><b>MESSAGE</b> = Error message if any.</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Renewal modes"></a>
        *** Renewal modes ***
      </h5>
      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          Renewee
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Request
      </th>
                          <th colspan="2" rowspan="1"
      valign="top" align="left">
          Result
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>DEFAULTKEY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>NEXTCERTSIGNKEY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>FORDEFAULTKEY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>DEFAULTKEY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>NEXTCERTSIGNKEY</b>
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          New key and alias
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Removed
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          New key and alias
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Removed
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Alias from nextcertsignkey
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Removed
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Alias from nextcertsignkey
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Removed
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          -
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          TRUE
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Same alias
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Same alias
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          present
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          TRUE
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Same alias
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Same alias
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="StatusPropertiesWorker"></a>
        StatusPropertiesWorker
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.statusproperties.StatusPropertiesWorker
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The StatusPropertiesWorker can be used to query and setting status properties in the status repository.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p>(none)</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Request Properties"></a>
        *** Request Properties ***
      </h5>
      				  <p><b>GET</b> - Comma-separated list of status properties to query</p>
	      				  <p><b>x.VALUE</b> - Where x is a status property: Sets the value of the property</p>
	      				  <p><b>x.EXPIRATION</b> - Where x is a status property: Sets the expiration time 
                            for x (x.VALUE must also be specified)</p>
	      				  <p>If no property is specified all valid status properties are returned</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Response Properties"></a>
        *** Response Properties ***
      </h5>
      				  <p><b>x.VALUE</b> = See Request Properties</p>
	      				  <p><b>x.EXPIRATION</b> = See Request Properties</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="TimeMonitorManager"></a>
        TimeMonitorManager
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
The TimeMonitorManager is an Enterprise Edition feature.
                    </div>
</div>
	      				  <p>
Fully qualified class name: org.signserver.module.timemonitormanager.TimeMonitorManager
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Similar to the StatusPropertiesWorker, the TimeMonitorManager also supports setting status properties in the status repository. In addition the TimeMonitorManager also supports dynamic configuration of the TimeMonitor as well as gives a complete view of the state of the TimeMonitor.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p>All worker properties starting with either "TIMEMONITOR." or "TIMESERVER." are sent to the TimeMonitor if it asks for it.</p>
	      				  <p>See the <a href="complete.en.html#SignServer%20TimeMonitor">SignServer TimeMonitor</a> manual for the list of available properties.</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Request Properties"></a>
        *** Request Properties ***
      </h5>
      				  <p><b>x.VALUE</b> - Where x is a status property: Sets the value of the property</p>
	      				  <p><b>x.EXPIRATION</b> - Where x is a status property: Sets the expiration time 
                            for x (x.VALUE must also be specified)</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Response Properties"></a>
        *** Response Properties ***
      </h5>
      				  <p><b>x.UPDATE</b> = The time when the property was written</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Status output"></a>
        *** Status output ***
      </h5>
      				  <p>
Much information about the state of the TimeMonitor is available in the getstatus output of the TimeMonitorManager:
                        </p>
	      				  <ul>
                            <li>
                                <b>Time monitor</b>: Indicates if the application is detected to be 'Running', 'Disabled', 'Not running?' or 'Unavailabe'. The state is determined by if the manager has seen an update from the TimeMonitor before the status properties are starting to expire.
                            </li>
                            <li>
                                <b>Last update</b>: The last time the TimeMonitor contacted the manager.
                            </li>
                            <li>
                                <b>Current time</b>: Current time of the server.
                            </li>
                            <li>
                                <b>Time state</b>: The last time state from the TimeMonitor.
                            </li>
                            <li>
                                <b>Report state</b>: The last report state from the TimeMonitor.
                            </li>
                            <li>
                                <b>Leap state</b>: The last leap state from the TimeMonitor.
                            </li>
                            <li>
                                <b>Configuration</b>: Either 'out of sync' or 'up to date' depending on if the current configuration has been read by the TimeMonitor or not. After changing a property in the TimeMonitorManager it is normal that the cofiguration is marked as 'out of sync' until the TimeMonitor fetches it.
                            </li>
                            <li>
                                <b>Status properties values</b>: Prints the current value and possibly the expiration time for the TIMESOURCE0_INSYNC and LEAPSECOND status properties.
                            </li>
                            <li>
                                <b>Timings</b>: Prints the current time values from the TimeMonitor.
                            </li>
                            <li>
                                <b>Configuration</b>: Prints the configuration values in the manager (not necesarly read by the TimeMonitor yet).
                            </li>
                            <li>
                                <b>Last TimeMonitor log entries</b>: Prints the last log entries obtained from the last update from the TimeMonitor.
                            </li>
                        </ul>
	      				  <p>
                            Sample output:
                        </p>
	      				  <pre class="code">
Status of Worker with id 300 (TimeMonitorManager) is:
   Worker status : Active
   Time monitor  : Running
   Last update   : 2014-08-26 11:43:39,176
   Current time  : 2014-08-26 11:43:39,580
   Time state    : INSYNC
   Report state  : REPORTED
   Leap state    : NONE
   Configuration : Up to date

   Status Repository values:
      TIMESOURCE0_INSYNC:        true
      LEAPSECOND:                NONE

   Timings:
      NTP server time offset:           0 ms
      NTP server query time:          507 ms
      NTP leap status query time:       8 ms
      Report time:                      7 ms
      Total required run time:        522 ms

   Configuration:
      NTP server hosts:            192.168.30.25
      NTP query samples:                2
      NTP query timeout:              200 ms
      Max accepted offset:            997 ms
      Warn offset:                    500 ms
      Status expire time:             900 ms
      Leap status expire time:      60000 ms
      Warn run time:                  800 ms
      Minimum run time:               550 ms

   Last TimeMonitor log entries:
      2014-08-26 11:36:29,253 INFO  Started
      2014-08-26 11:36:29,287 INFO  State changed to: UNKNOWN,REPORTED,UNKNOWN
      2014-08-26 11:36:44,255 INFO  Config changed to: 1ccdf46b
      2014-08-26 11:36:44,782 INFO  Time back in calibration: offset abs(0)  max accepted offset 997
      2014-08-26 11:36:44,793 INFO  State changed to: INSYNC,REPORTED,NONE
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="TimeMonitorStatusReportWorker"></a>
        TimeMonitorStatusReportWorker
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
The TimeMonitorStatusReportWorker is an Enterprise Edition feature.
                    </div>
</div>
	      				  <p>
Fully qualified class name: org.signserver.module.timemonitormanager.TimeMonitorStatusReportWorker
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Worker that outputs the TimeMonitor state line as described in the <a href="complete.en.html#SignServer%20TimeMonitor">SignServer TimeMonitor</a> manual.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Response"></a>
        *** Response ***
      </h5>
      				  <p>
                            Sample output:
                        </p>
	      				  <pre class="code">
1409055102120,INSYNC,REPORTED,NONE,1ccdf46b,0,507,7,6
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="SignerStatusReportWorker"></a>
        SignerStatusReportWorker
      </h4>
      				  <p>
Fully qualified class name: org.signserver.module.signerstatusreport.SignerStatusReportWorker
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The SignerStatusReportWorker is a worker that returns a status report for a configured 
set of workers. The information includes each workers crypto token status
ACTIVE/OFFLINE and if available also the numbers of signatures that has been
performed with the key currently associated with the worker. If the worker has
a configured limit of number of signatures, this value is also included. This 
worker returns the report in the same format as defined for the 
<a href="#SignerStatusReportTimedService">SignerStatusReportTimedService</a>.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p><b>WORKERS</b> = Comma separated list of worker names (signers) that should
be monitored.</p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Available CryptoTokens"></a>
      Available CryptoTokens
    </h3>
      				  <p>
                    There exists four types of crypto tokens (Formerly known as sign tokens), two for storing the keys in software, one general for communicating with cryptographic hardware through the PKCS11 interface and one for SmartCards. See the developer section for information about developing support for other HSMs.
                </p>
	      				  <p>
Which CryptoToken a worker is using is determined by the its SIGNERTOKEN.CLASSPATH
property which should contain the fully qualified class name of the CryptoToken
implementation. In addition to that property one must also make sure that the
other properties needed by the particular crypto token are available.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="General properties"></a>
        General properties
      </h4>
      				  <p>
<b>SIGNERTOKEN.CLASSPATH</b>: Global configuration property for the fully qualified class name of the crypto token
implementation to use. See below for available crypto tokens.
                    </p>
	      				  <p>
<b>KEYALG</b>: Key algorithm to use when generating new keys (Only for
    cryptotokens supporting key generation).
                    </p>
	      				  <p>
<b>KEYSPEC</b>: Key specification to use when generating new keys (Only for
    cryptotokens supporting key generation).
                    </p>
	      				  <p>
<b>KEYGENERATIONLIMIT</b>: Limit for the maximum number of keys allowed to be generated. If set and set to 0 or a positive value, key generation is not allowed if the current number of keys equals to or is larger than this value (Default: "" = no limit).
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="P12CryptoToken"></a>
        P12CryptoToken
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
A CryptoToken using a PKCS#12 (.p12/.pfx) key-store in the local file-system. 
                        </p>
	      				  <p>
In a clustered environment the key store must placed at the same location at all nodes.
                        </p>
	      				  <p>
The P12CryptoToken, doesn't support the destroyKey() method
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.P12CryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>KEYSTOREPATH</b>: The full path to the key-store file to load. (required)
                        </p>
	      				  <p>
<b>KEYSTOREPASSWORD</b>: The password that locks the key-store. Used for automatic activation.
                        </p>
	      				  <p>
<b>DEFAULTKEY</b>: The key to use. If a key is not derived from each signing request
(using an implementation of the AliasSelector interface), this needs to be defined. (optional)
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="JKSCryptoToken"></a>
        JKSCryptoToken
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
A CryptoToken using a Java Key Store (.jks) in the file-system.
                        </p>
	      				  <p>
In a clustered environment must the key store be at the same location at all nodes.
                        </p>
	      				  <p>
The JKSCryptoToken, doesn't support the destroyKey() method
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.JKSCryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>KEYSTOREPATH</b>: The full path to the key-store to load. (required)
                        </p>
	      				  <p>
<b>KEYSTOREPASSWORD</b>: The password that locks the key-store. Used for automatic activation.
                        </p>
	      				  <p>
<b>DEFAULTKEY</b>: The key to use. If a key is not derived from each signing request
(using an implementation of the AliasSelector interface), this needs to be defined. (optional)
                        </p>
	      				  <p>
<b>NEXTCERTSIGNKEY</b>: The next key to use. See PKCS11CryptoToken. (optional)
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="KeystoreInConfigCryptoToken"></a>
        KeystoreInConfigCryptoToken
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
A CryptoToken using a PKCS#12 keystore stored in the configuration (in the
database).
                        </p>
	      				  <p>
The content of the keystore is not part of the regular worker properties.
Thus, it is not included when running the <source>dumpproperties</source>
command. It is also removed when removing the crypto worker (or regular worker
when using the legacy method to set-up crypto tokens).
To backup the content of the crypto token, a database backup should be made.
                        </p>
	      				  <p>
The password supplied when activating the token the first time will be used
as the keystore password.
                        </p>
	      				  <p>
This crypto token is not compatible with running under GlassFish version 2.    
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.KeystoreInConfigCryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>KEYSTOREPASSWORD</b>: The password that locks the key-store. Used for automatic activation.
                        </p>
	      				  <p>
<b>DEFAULTKEY</b>: The key to use. If not specified the first found key is used. (optional)
                        </p>
	      				  <p>
<b>NEXTCERTSIGNKEY</b>: The next key to use. See PKCS11CryptoToken. (optional)
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="PrimeCardHSMCryptoToken"></a>
        PrimeCardHSMCryptoToken
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This crypto token will be removed in a future version.
                    </div>
</div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Using PrimeCardHSM it's possible to use a SmartCard to generate 2048-bit RSA signatures. The SmartCard can perform about one signature a second. PrimeCardHSM is proprietary software by PrimeKey Solutions AB.
                        </p>
	      				  <p>
PrimeCardHSM requires PCSCD software and SmartCard drivers. See separate documentation about installing PrimeCardHSM.
                        </p>
	      				  <p>
The PrimeCardHSMCryptoToken, doesn't support the destroyKey() method.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.PrimeCardHSMCryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>DEFAULTKEY</b> =   Hash value of the signing key on the card. See PrimeCardHSM documentation for more information.(Required)
                        </p>
	      				  <p>
<b>NEXTCERTSIGNKEY</b>: The next key to use. See PKCS11CryptoToken. (optional)
                        </p>
	      				  <p>
<b>AUTHCODE</b> = Authentication code for automatic activation (Optional).
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="PKCS11CryptoToken"></a>
        PKCS11CryptoToken
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
Using PKCS11 it's possible to use a HSM that has a PKCS11 module, such as Utimaco, nCipher, SafeNet or AEP KeyPer. SignServer uses the same underlying implementation of
PKCS11 crypto tokens as EJBCA. To find out more about supported devices and get information how to configure them you can visit the HSM documentation at <a href="http://ejbca.org/docs/adminguide.html#Hardware%20Security%20Modules%20%28HSM%29">EJBCA.org</a>. 
The only thing that differs are the token labels strings, which you should use from below for SignServer. A very useful tool from EJBCA is the <a href="http://ejbca.org/docs/userguide.html#EJBCA%20client%20toolbox">ClientToolBox</a>. 
If you can generate anbd test PKCS11 keys using the clientToolBox, you can use them with SignServer.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.PKCS11CryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>DEFAULTKEY</b> =   The key alias. (Required)
                        </p>
	      				  <p>
<b>NEXTCERTSIGNKEY</b> = The next key to use. This property can be used to hold
the name of the next key to use. Certificate signing requests (CSR) can be made
for this key can while to the current key (DEFAULTKEY) is still in production.
After uploading the new certificate the value of NEXTCERTSIGNKEY can be moved to
DEFAULTKEY. (optional)
                        </p>
	      				  <p>
<b>PIN</b> =   Authentication code for activation. (Only required for auth-activation, otherwise the activatecryptotoken CLI command can be used)
                        </p>
	      				  <p>
<b>SHAREDLIBRARYNAME</b> = Name of pre-defined PKCS11 library to be used. The available libraries can be configured in signserver_deploy.properties.
If the legacy SHAREDLIBRARY property is also defined, it must point to the same library on the file system. (Required, unless the old SHAREDLIBRARY is set)
                        </p>
	      				  <p>
<b>SHAREDLIBRARY</b> = Full path to the library containing the PKCS11 interface. From version 3.7.0 this must point to a file declared
in signserver_deploy.properties (or using the built-in values). If this property is defined at the same time as SHAREDLIBRARYNAME
they must point to the same library on the file system. NOTE: This property is deprecated.
                        </p>
	      				  <p>
<b>SLOTLABELTYPE</b> = Indicates how the slot should be identified. Supported values are SLOT_NUMBER, SLOT_INDEX or SLOT_LABEL. (Required)
                        </p>
	      				  <p>
<b>SLOTLABELVALUE</b> = The slot to use, identified with the type specified in SLOTLABELTYPE: (Required)
                        </p>
	      				  <ul>
                            <li>SLOT_NUMBER is the number (ID) of the slot</li>
                            <li>SLOT_INDEX is the zero-base index of the slot in the list of available slots as returned by the PKCS#11 provider</li>
                            <li>SLOT_LABEL this is the label of the slot</li>
                        </ul>
	      				  <p>
This properites are not allowed if the legacy properties below are specified.
                        </p>
	      				  <p>
<b>SLOT</b> or <b>SLOTLISTINDEX</b> = Legacy properties for indicating which slot to use. Only available for backwards compatibility. Instead use the SLOTLABELTYPE and SLOTLABELVALUE properties.
                        </p>
	      				  <p>
<b>ATTRIBUTESFILE</b> = Path to file with PKCS#11 attributes used for key generation. (Optional, not allowed if ATTRIBUTES specified)
                        </p>
	      				  <p>
<b>ATTRIBUTES</b> = PKCS#11 attributes used for key generation specified directly in the property value. (Optional, not allowed if ATTRIBUTESFILE specified)
                        </p>
	      				  <p>
Sample p11attributes.cfg:
                        </p>
	      				  <pre>
attributes(generate,CKO_PUBLIC_KEY,*) = {
        CKA_TOKEN = false
	CKA_ENCRYPT = true
	CKA_VERIFY = true
	CKA_WRAP = true
}
attributes(generate, CKO_PRIVATE_KEY,*) = {
        CKA_TOKEN = true
        CKA_PRIVATE = true
        CKA_SENSITIVE = true
	CKA_EXTRACTABLE = false
	CKA_DECRYPT = true
	CKA_SIGN = true
	CKA_UNWRAP = true
}

# Work-around for performance issue in the Apache XMLSec library
disabledMechanisms = {
    CKM_SHA1_RSA_PKCS
    CKM_SHA256_RSA_PKCS
    CKM_SHA384_RSA_PKCS
    CKM_SHA512_RSA_PKCS
    CKM_MD2_RSA_PKCS
    CKM_MD5_RSA_PKCS
    CKM_DSA_SHA1
    CKM_ECDSA_SHA1
}
                        </pre>
	      				  <p>
<b>Notice:</b> The PKCS#11 attributes configuration is global per shared library. If specified in multiple workers only the configuration from the first worker loaded will be used. Changing the property might not take effect without restarting the application server.
                        </p>
	      				  <p>
<b>Notice:</b> For a Thales nCipher 'module protected' slot (slot index 0), CKA_PRIVATE must be false for the CKO_PRIVATEKEY so the key can be used without a login otherwise the key generation will fail with a CKR_USER_NOT_LOGGED_IN PKCS#11 error.
                        </p>
	      				  <p>
<b>CACHE_PRIVATEKEY</b> = If set to true the private key reference is cached in the worker so that it is not queried for each signature. This could potentially improve performance in some environments. (Default: false)
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Default global properties"></a>
        *** Default global properties ***
      </h5>
      				  <p>
Some worker properties can instead by specified as default values in the global configuration so they does not have to be repeated in every worker. Individual workers can override the default global values (if any) by specifying the property as usual.
                        </p>
	      				  <p>
Global default values are specified as global values in the global configuration with the name prefixed with "DEFAULT.".
The following properties can currently be specified in the global configuration:
                        </p>
	      				  <ul>
                            <li>SHAREDLIBRARYNAME</li>
                            <li>SHAREDLIBRARY</li>
                            <li>SLOTLABELTYPE</li>
                            <li>SLOTLABELVALUE</li>
                            <li>SLOT</li>
                            <li>SLOTLISTINDEX</li>
                            <li>ATTRIBUTES</li>
                            <li>ATTRIBUTESFILE</li>
                            <li>PIN</li>
                        </ul>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Example usage"></a>
        *** Example usage ***
      </h5>
      				  <p>
Edit (preferably a copy of) pkcs11-crypto-configuration.properties to match your PKCS#11 token. Run the following command to set up the token:
                        </p>
	      				  <code>bin/signserver setproperties pkcs11-crypto-configuragtion.properties</code>
	      				  <p>
Reload the configuration using the ID that was printed (in this example 8):
                        </p>
	      				  <code>
bin/signserver reload 8
                        </code>
	      				  <p>
Activate the crypto token by specifying the PIN code:
                        </p>
	      				  <code>
bin/signserver activatecryptotoken 8
                        </code>
	      				  <p>
Unless your DEFAULTKEY worker property points to an existing key in the HSM the activation will look like it failed. Don't worry and instead continue creating a key that can be used for testing slot activation:
                        </p>
	      				  <p>
Generate a keypair in the token to be used as test key:
                        </p>
	      				  <code>
bin/signserver generatekey 8 -alias testkey1 -keyalg RSA -keyspec 2048
                        </code>
	      				  <p>
Set the key as test key:
                        </p>
	      				  <code>
bin/signserver setproperty 8 DEFAULTKEY testkey1<br />
bin/signserver reload 8<br />
bin/signserver activatecryptotoken 8
                        </code>
	      				  <p>
Test the keypair:
bin/signserver testkey 8
                        </p>
	      				  <p>
You also need a certificate for the signer. Generate a certificate request with the command:
bin/signserver generatecertreq 8 "CN=PKCS11 Signer token" SHA1WithRSA /tmp/certreq.pem
                        </p>
	      				  <p>
Add a user in EJBCA with a certificate profile suitable for signing, and enroll for a "Server Certificate" using the public web pages.
                        </p>
	      				  <p>
Create the certificate chain file with the command:
cat /tmp/cert.pem /tmp/AdminCA1.pem &gt; /tmp/certchain.pem
                        </p>
	      				  <p>
The signer certificate must be first, and the root CA certificate last.
                        </p>
	      				  <p>
The signer certificate should then be uploaded to the worker wich should use it.
Upload the signing certificate chain to the signer using the command:
bin/signserver uploadsignercertificatechain 9 GLOB /tmp/certchain.pem
bin/signserver reload 9
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="OldPKCS11CryptoToken"></a>
        OldPKCS11CryptoToken
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This crypto token will be removed in a future version. Use PKCS11CryptoToken instead.
                    </div>
</div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The OldPKCS11CryptoToken implementation (before the use of CESeCore) is only available as a fallback for a limited time. This implementation is deprecated. The PKCS11CryptoToken should be used instead.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.OldPKCS11CryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
Currently most properties from the PKCS11CryptoToken can be used.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="SoftCryptoToken"></a>
        SoftCryptoToken
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This crypto token will be removed in a future version. Use KeystoreCryptoToken or KeystoreInConfigCryptoToken instead.
                    </div>
</div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Overview"></a>
        *** Overview ***
      </h5>
      				  <p>
The SoftCryptoToken is a simple token managing it's own soft keys instead of using a PKCS12 file. It can be used for test and demonstration purposes. The keys are stored in the worker's properties and is generated when genCertificateRequest is called. One key is used for all purposes and a new key is generated for every certificate request.
                        </p>
	      				  <p>
The method destroyKey is not supported.
                        </p>
	      				  <p>
There is also a tool available for constructing the properties from a PKCS12 file
in CryptoTokenUtils.java. To run the tool outside the IDE first build SignServer
by running "ant". After that the tool can be executed with something similar
to:
                        </p>
	      				  <pre>
java -cp lib/signserver-ejb.jar:lib/ext/1.6/bcprov-jdk.jar:lib/SignServer-Common.jar:lib/ext/ejbca-util.jar org.signserver.server.cryptotokens.CryptoTokenUtils createsoft src/test/dss10/dss10_signer1.p12 "signer 1" foo123
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNERTOKEN.CLASSPATH"></a>
        *** SIGNERTOKEN.CLASSPATH ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.cryptotokens.SoftCryptoToken</b>
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available Properties"></a>
        *** Available Properties ***
      </h5>
      				  <p>
<b>KEYDATA</b> =   The serialized KeyPair generated by genCertificateRequest, usually is this setting configured by the SoftCryptoToken itself.
                        </p>
	      				  <p>
<b>KEYALG</b> = The algorithm used when generating new keys. (Optional, default is "RSA")
                        </p>
	      				  <p>
<b>KEYSPEC</b> =   The key specification used when generating new keys. (Optional, default is "2048")
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Example usage"></a>
        *** Example usage ***
      </h5>
      				  <p>
First change the global property of WORKER&lt;ID&gt;.CRYPTOTOKEN.CLASSPATH of the worker you want to use the SoftCryptoToken with. After reload will an empty and inactive SoftCryptoToken be created.
                        </p>
	      				  <p>
Then generate a certificate request with the command, in this step will new keys be generated
                        </p>
	      				  <pre>
bin/signserver generatecertreq &lt;id&gt; "CN=Soft Signer token" SHA1WithRSA /tmp/certreq.pem
                        </pre>
	      				  <p>
Then upload the signing certificate  to the worker using the command:
                        </p>
	      				  <pre>
bin/signserver uploadsignercertificatechain &lt;id&gt; GLOB /tmp/cert.pem
                        </pre>
	      				  <p>
After the certificate chain has been uploaded to the server, the configuration must be reloaded and the SoftCryptoToken will be active and ready to use.
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Alias Selectors"></a>
      Alias Selectors
    </h3>
      				  <p>
By using an alias selector it is possible to control how the key used for signing
are selected at run-time based the signing request. For example it is possible
to have keys selected based on the authenticated user for a signing request.
                </p>
	      				  <p>
The default, if no alias selector is explicitly configured is to use a default selector
behaving in a backwards-compatible way, using the DEFAULTKEY property of the
crypto worker being used.
                </p>
	      				  <p>
To configure an alternative alias selector, set the <source>ALIASSELECTOR</source>
worker property of the worker pointing to the class name of an
implementation for an alias selector to use.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Available implementations"></a>
        Available implementations
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="DefaultAliasSelector"></a>
        *** DefaultAliasSelector ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.aliasselectors.DefaultAliasSelector</b>
                        </p>
	      				  <p>
This alias selector chooses DEFAULTKEY or NEXTCERTSIGNKEY as specified for
the crypto worker depending on the purpose of the request.
This alias selector would be used if none has been explicitly set.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="AuthorizedUsernameAliasSelector"></a>
        *** AuthorizedUsernameAliasSelector ***
      </h5>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.aliasselectors.AuthorizedUsernameAliasSelector</b>
                        </p>
	      				  <p>
This alias selector chooses keys based on the authorized username in the request.
                        </p>
	      				  <p>
An optional prefix can be specified using the <source>ALIAS_PREFIX</source>
worker property. If this is not specified, the plain username will be used as
the key alias.
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Archivers"></a>
      Archivers
    </h3>
      				  <p>
See also the section about the <a href="complete.en.html#Archiving%20Responses">ARCHIVERS</a> worker property that can be set to one or more of the available Archiver implementations described below.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="OldDatabaseArchiver"></a>
        OldDatabaseArchiver
      </h4>
      				  <p>
The default archiver used if the the property ARCHIVE=true is set. Or if the ARCHIVERS property contains its class name. This Archiver archives to the database table "ArchiveData" using the same datasource as SignServer uses for accessing the database for its configuration etc.
                    </p>
	      				  <p>
The data is stored in an XML encoded Base64PutHashMap. In the "dataEncoding" column this format is indicated as DATA_ENCODING_XML.
                    </p>
	      				  <p>
The fully qualified class name is: <b>org.signserver.server.archive.olddbarchiver.OldDatabaseArchiver</b>
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p>
<b>ARCHIVERx.ARCHIVE_OF_TYPE</b> = Where "x" is the index of the Archiver in the ARCHIVERS property. Determines what this Archiver should archive. Alternatives are: "REQUEST", "RESPONSE" or "REQUEST_AND_RESPONSE". Default is "RESPONSE".<br />
Example: ARCHIVER0.ARCHIVE_OF_TYPE=REQUEST_AND_RESPONSE
                        </p>
	      				  <p>
Currently archiving of requests is only supported by TimeStampSigner and MSAuthCodeTimeStampSigner.
                        </p>
	      				  <p>
<b>ARCHIVERx.USE_FORWARDED_ADDRESS</b> = Where "x" is the index of the archiver in the ARCHIVERS property.
If this property is set to "true", IP addresses in the comma-separated list given in the X-Forwarded-For header is used as the remote IP stored
in the archive in case this header is set, by default the last forwarded address is used. If the header is not included, the IP address the request comes from is used (the same behavior as when
this property isn't set, or set to "false"). This is useful when running a proxy in front of SignServer, to record the orginal IP address of the client,
instead of the proxy's IP address. Defaults to "false".
                        </p>
	      				  <p>
<b>ARCHIVERx.MAX_FORWARDED_ADDRESSES</b> = Where "x" is the index of the archiver in the ARCHIVERS property.
Sets the maximum number of forwarded addresses to add the remote IP in the archive, counted from the end.
The addresses is listed in the order they appear in the header. The default value is 1 (only include the last address).
This property is only used when USE_FORWARDED_ADDRESS is set to "true".
                        </p>
	      				  <p>
<b>ARCHIVERx.INCLUDE_DIRECT_ADDRESS</b> = Where "x" is the index of the archiver in the ARCHIVERS property.
If this property is set to "true", and USE_FORWARDED_ADDRESS is also set to "true", the host IP address
(direct address) is added to the end of the list of forwarded addresses. This address is not taken into
account for the number of forwarded addresses by MAX_FORWARDED_ADDRESSES above.
The default is "false" (not included).
This property is only used when USE_FORWARDED_ADDRESS is set to "true".
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="ArchiveData table"></a>
        *** ArchiveData table ***
      </h5>
      				  <p>
The exact database table structure is described in the SQL scripts available under doc/sql-scripts/.                            
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          uniqueId
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          Primary key of the archive row.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          archiveData
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          The actual data encoded in an Base64PutHashMap.
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          archiveId
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Some identifier for the produced item.<br />
For the TimeStampSigner this would be the Time stamp token serial number (in hex encoding). Other signers might use a hash of the request document and the transaction ID.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          requestCertSerialnumber
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Serial number (in hex encoding) of the client certificate (if any) used by the client.<br />
Notice: This only indicates that the client certificate where used when establishing the connection to the web server and not wither the worker required a client certificate or not or if it did any additional checks if the authenticated client was authorized.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          requestIP
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
By default IP address of the host connecting.
When USE_FORWARDED_ADDRESS is set to "true" this contains a list of forwarded IP addresses from X-Forwarded-For optionally ending with the host address (when setting INCLUDE_DIRECT_ADDRESS to "true").<br />
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          requestIssuerDN
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Issuer DN (in string representation) of the issuer of the client certificate (if any) used by the client.<br />
See also note about requestCertSerialnumber.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          signerId
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
ID of the worker handling the request.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          time
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Timestamp (number of milliseconds since January 1 1970 00:00:00) on the SignServer host when the item where archived.
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          type
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
The type of archivable item. Currently this could be:
                                    <ul>
                                        <li>0 - TYPE_RESPONSE</li>
                                        <li>1 - TYPE_REQUEST</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          dataEncoding
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
Type of encoding used for the archiveData. Currently this could be:
                                    <ul>
                                        <li>NULL - DATA_ENCODING_XML</li>
                                        <li>0 - DATA_ENCODING_XML</li>
                                        <li>1 - DATA_ENCODING_BASE64</li>
                                    </ul>
Where DATA_ENCODING_XML uses the Base64PutHashMap and DATA_ENCODING_BASE64 uses a plain Base64 encoding of the binary data.
                                
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Base64DatabaseArchiver"></a>
        Base64DatabaseArchiver
      </h4>
      				  <p>
This Archiver archives to the database table "ArchiveData" using the same datasource as SignServer uses for accessing the database for its configuration etc. It is similar to the OldDatabaseArchiver but does not use an XML structure for storing the data. Instead the data is simply base64 encoded.
                    </p>
	      				  <p>
In the "dataEncoding" column this format is indicated as DATA_ENCODING_BASE64.    
                    </p>
	      				  <p>
The fully qualified class name is: <b>org.signserver.server.archive.base64dbarchiver.Base64DatabaseArchiver</b>
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Worker Properties"></a>
        *** Worker Properties ***
      </h5>
      				  <p>
<b>ARCHIVERx.ARCHIVE_OF_TYPE</b> = Same as for OldDatabaseArchiver above.
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Accounters"></a>
      Accounters
    </h3>
      				  <p>
See also the section about the <a href="complete.en.html#Accounter">ACCOUNTER</a> worker property that can be set to one of the available Accounter implementations described below.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="NoAccounter"></a>
        NoAccounter
      </h4>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.NoAccounter</b>
                    </p>
	      				  <p>
Accounter not doing anything. Sets purchased to true.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="GlobalConfigSampleAccounter"></a>
        GlobalConfigSampleAccounter
      </h4>
      				  <p>
The fully qualified class name is: <b>org.signserver.server.GlobalConfigSampleAccounter</b>
                    </p>
	      				  <p>
Accounter holding the clients balances internally in the global configuration.<br />
Note: This Accounter is only for demonstration purposes and will not work under load. A production Accounter should use an implementation using a proper database.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Global Configuration Properties"></a>
        *** Global Configuration Properties ***
      </h5>
      				  <p>
<b>GLOBALCONFIGSAMPLEACCOUNTER_USERS</b> = Mapping from credential to account name<br />
<b>GLOBALCONFIGSAMPLEACCOUNTER_ACCOUNTS</b> = Mapping from account name to a balance
                        </p>
	      				  <p>
Example:
                        </p>
	      				  <pre class="code">
GLOBALCONFIGSAMPLEACCOUNTER_USERS = user1,password:account1; user2,password2:account2
GLOBALCONFIGSAMPLEACCOUNTER_ACCOUNTS = account1:14375; account2:12
                        </pre>
	            </div>
	            </div>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_development"></a>
      Development
    </h2>
      				  <p>
This section describes the details of how to develop your own plug-ins for the SignServer API. It goes through most of the necessary interfaces to get going.
            </p>
	      				  <p>
See also doc/DEVELOP.txt.                
            </p>
	      			          <div class="section">
    <h3>
      <a name="Custom modules"></a>
      Custom modules
    </h3>
      				  <p>
Custom code can be included in the SignServer build process by placing the projects under the modules directory and adhere to the modules contract.    
                </p>
	      				  <p>
First, the property modules.build.includes in res/modules-project.properties defines which projects that should be included in the build process. All projects with a folder name starting with SignServer-Module-*, SignServer-ejb* or SignServer-war are included. Other patterns can be included by setting a property extra.modules.build.includes.
                </p>
	      				  <p>
Second, in the project folder there should be an Ant script called build.xml.    
                </p>
	      				  <p>
Third, if the project should be called it should define the properties:
                    <ul>
                        <li><b>modulename</b>: The name of the module. Will be used as prefix to the enable-property. Example: module.pdfsigner (the enable property will then be module.pdfsigner.enabled)</li>
                        <li><b>clean.available</b>: True if the "clean" target should be called when the rest of SignServer is getting cleaned.</li>
                        <li><b>dist-module.available</b>: True if the "dist-module" target should be called when SignServer is getting built</li>
                    </ul>
                    Example:
                </p>
	      				  <pre>
&lt;property name="modulename" value="module.pdfsigner"/&gt;
&lt;property name="clean.available" value="true"/&gt;
&lt;property name="dist-module.available" value="true"/&gt;    
                </pre>
	      				  <p>
Forth, the dist-module target should take care of moving all distributables to the ../../lib directory and if the module should be deployed as part of the signserver.ear file a module descriptor should be placed in ../../mods-available. The name of the descriptor file should be priority_modulename.properties where priority is the order in which the module should be built and modulename is the name as defined by the property with the same name.
                </p>
	      				  <p>
The priorities are basically like this:
                    <ul>
                        <li>10: Essential core modules (like signserverejb and signservercommon)</li>
                        <li>20: Other core modules (like web services)</li>
                        <li>30: Other core modules (like web components etc)</li>
                        <li>40: Other modules (like signers/validators etc)</li>
                    </ul>
                </p>
	      				  <p>
The module descriptor can contain:
                    <ul>
                        <li>module.name: Same as the modulename property</li>
                        <li>module.type: The type of the module. "lib" if the module should be put in signserver.ear/lib, "ejb" if it is an EJB module or "war" if it is and WAR module.</li>
                        <li>to.root: Comma separated list of files to move to the root of signserver.ear. Basedir is SIGNSERVER_HOME and all files should be taken from lib/ (not modules/ as it is not available in the binary distribution).</li>
                        <li>to.lib: Same as to.root but for jar files to be moved to signserver.ear/lib/.</li>
                        <li>module.ejb: Only if module.type is "ear" or "war". The name of the enterprise module file (example: signserver.war).</li>
                        <li>module.web.web-uri: Only if module.type is "war". The name to put in the web-uri part of the application.xml for this enterprise module.</li>
                        <li>module.web.context-root: Only if module.type is "war". The name to put in the context-root part of the application.xml for this enterprise module.</li>
                        <li>postprocess.files: Optionally. Comma separated list of property name prefixes for each file to postprocess (example: postprocess.file1)</li>
                        <li>postprocess.file1.src: Only if postprocess.files specified. Path of file to postprocess (relative to SIGNSERVER_HOME/lib/, example: SignServer-ejb-SignServerWS.jar)</li>
                        <li>postprocess.file1.includes: Only if postprocess.files. Ant includes pattern with files in the jar to postprocess (example: META-INF/ejb-jar.xml)</li>
                        <li>postprocess.file1.dest: Only if postprocess.files specified. Location to put the resulting JAR in the final EAR. Default "" (the root) but should be set to "lib/" for library JARs.</li>
                    </ul>
                    Example (mods-available/40_module.pdfsigner.properties):
                </p>
	      				  <pre>
module.name=module.pdfsigner
module.type=lib
to.root=
to.lib=lib/ext/1.6/bcprov-jdk.jar,lib/ext/1.6/bctsp-jdk.jar,lib/ext/cert-cvc.jar,lib/ext/commons-collections-3.2.jar,lib/ext/commons-io-1.4.jar,lib/ext/commons-lang-2.5.jar,lib/ext/commons-logging-1.1.1.jar,lib/ext/ejbca-util.jar,lib/ext/log4j-1.2.14.jar,lib/ext/module/pdfsigner/itext/itext.jar,lib/SignServer-Common.jar,lib/SignServer-ejb-interfaces.jar,lib/SignServer-Module-PDFSigner.jar
                </pre>
	      				  <p>
                Example (mods-available/20_signserverws.properties):    
                </p>
	      				  <pre>
module.name=signserverws
module.type=ejb
module.ejb=SignServer-ejb-SignServerWS.jar
to.root=lib/SignServer-ejb-SignServerWS.jar
to.lib=lib/ext/1.6/bcprov-jdk.jar,lib/ext/1.6/bctsp-jdk.jar,lib/ext/cert-cvc.jar,lib/ext/commons-collections-3.2.jar,lib/ext/commons-io-1.4.jar,lib/ext/commons-lang-2.5.jar,lib/ext/commons-logging-1.1.1.jar,lib/ext/ejbca-util.jar,lib/ext/log4j-1.2.14.jar,lib/SignServer-Common.jar,lib/SignServer-ejb-interfaces.jar
postprocess.files=postprocess.file1
postprocess.file1.src=SignServer-ejb-SignServerWS.jar
postprocess.file1.includes=META-INF/ejb-jar.xml
                </pre>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Custom sub modules"></a>
      Custom sub modules
    </h3>
      				  <p>
In the same way as described in the previous chapter about custom modules, it is also possible to have custom sub modules.
This is done by creating a folder under 'modules' with a name starting with 'mod-' and include a build.xml as in the example below.
It would then be possible to include any number of additional modules in this folder.
                </p>
	      				  <p>
Sample modules/mod-mysigners/build.xml:
                </p>
	      				  <pre class="code">
&lt;project name=&quot;MySigner Modules&quot; default=&quot;dist-module&quot; basedir=&quot;.&quot;&gt;
    &lt;description&gt;Builds sub modules in mysigner&lt;/description&gt;
    &lt;property name=&quot;platform.project.dir&quot; location=&quot;../../&quot;/&gt;
    &lt;property name=&quot;signserver.home&quot; location=&quot;../../&quot;/&gt;
    &lt;property file=&quot;build.properties&quot;/&gt;
    &lt;property file=&quot;${platform.project.dir}/conf/signserver_deploy.properties&quot;/&gt;
    &lt;property file=&quot;${platform.project.dir}/signserver_deploy.properties&quot;/&gt;
    
    &lt;!-- Clean selected modules in this sub module --&gt;
    &lt;target name=&quot;-do-clean-module&quot;&gt;
        &lt;echo&gt;Cleaning ${ant.project.name}&lt;/echo&gt;
        &lt;subant target=&quot;-do-clean-module&quot; failonerror=&quot;true&quot;&gt;
            &lt;fileset dir=&quot;.&quot; includes=&quot;${modules.clean.includes}&quot;/&gt;
         &lt;/subant&gt;
    &lt;/target&gt;
    &lt;target name=&quot;clean&quot; depends=&quot;-do-clean-module&quot;/&gt;
    
    &lt;!-- Build selected modules in this sub module --&gt;
    &lt;target name=&quot;-do-module&quot;&gt;
        &lt;echo&gt;Building ${ant.project.name}&lt;/echo&gt;
        &lt;subant target=&quot;-do-module&quot; verbose=&quot;false&quot;&gt;
            &lt;fileset dir=&quot;.&quot; includes=&quot;${modules.build.includes}&quot;/&gt;
        &lt;/subant&gt;
    &lt;/target&gt;
    &lt;target name=&quot;dist-module&quot; depends=&quot;-do-module&quot;/&gt;
    
    &lt;!-- Build selected systemtests in this sub module --&gt;
    &lt;target name=&quot;-do-test-module&quot;&gt;    
        &lt;echo&gt;Building systemtests for ${ant.project.name}&lt;/echo&gt;
        &lt;subant target=&quot;-do-test-module&quot; verbose=&quot;false&quot;&gt;
            &lt;fileset dir=&quot;.&quot; includes=&quot;${build.systemtest.includes}&quot; excludes=&quot;${build.systemtest.excludes}&quot;/&gt;
        &lt;/subant&gt;
    &lt;/target&gt;
    &lt;target name=&quot;build-systemtests&quot; depends=&quot;-do-test-module&quot;/&gt;
    
    &lt;!-- Run tests in this sub module --&gt;
    &lt;target name=&quot;test&quot;&gt;
        &lt;echo&gt;Running tests for ${ant.project.name}&lt;/echo&gt;
        &lt;subant target=&quot;test&quot;&gt;
            &lt;fileset dir=&quot;.&quot; includes=&quot;${tests.modules.includes}&quot;/&gt;
        &lt;/subant&gt;
    &lt;/target&gt;
&lt;/project&gt;</pre>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Custom CLI"></a>
      Custom CLI
    </h3>
      				  <p>
The SignServer AdminCLI or ClientCLI can be extended by putting additional JAR files with custom implementations of the ClientCommandFactory or AdminCommandFactory interfaces on the classpath. The implementation classes should be listed in the JAR files under META-INF/services in a file with the full class name of the interface. See SignServer-Client-ValidationCLI as an example. 
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Plugin development"></a>
      Plugin development
    </h3>
      				  <p>
The main component in the SignServer is the Worker from which most other components inherits. To get a better overview of how the different component types relate to one and another see illustration 1 in the Overview section.
                </p>
	      				  <p>
Most workers work in the same way but with different interfaces to implement but for all of them should the following steps be performed.
                </p>
	      				  <ul>
                    <li>
Create a custom  class implementing the specified interface. There usually exists a base class implementing the most basic function to simply the implementation even further. If it exists it's recommended to inherit it.
                    </li>
                    <li>
You can define your own properties that the worker can use for its configuration.
                    </li>
                    <li>
Make sure the custom class is available to the application server
                    </li>
                    <li>
Redeploy the SignServer.
                    </li>
                    <li>
Register the worker in the application by setting a property WORKER&lt;id&gt;.CLASSPATH with a global scope in the global configuration. (Also make sure to set it's crypto tokens class-path, see separate section).
                    </li>
                    <li>
Reload the service with the CLI reload command.
                    </li>
                </ul>
	      			      	  <div class="subsection">
      <h4>
        <a name="Implementing Workers"></a>
        Implementing Workers
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="The ISigner Interface"></a>
        *** The ISigner Interface ***
      </h5>
      				  <p>
A Signer is a component used to perform some form of cryptographic processing of requested data and to create a custom signer class it should  implement the org.signserver.server.signers.ISigner interface. There exists a BaseSigner that can be inherited taking care of some of the functionality. If the BaseSigner is inherited the only method that needs to be implemented is 'processData() '.
                        </p>
	      				  <p>
There exists a DummySigner implementation that is used for demonstration purposes.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="The ITimedService Interface"></a>
        *** The ITimedService Interface ***
      </h5>
      				  <p>
There are two kinds of timed services, singleton or non-singleton. A singleton service is only run at one of the nodes at the time while non-singleton services are run at all nodes simultaneously. If a singleton service fails to run on one of the nodes will one of the other nodes take over the service
automatically.
                        </p>
	      				  <p>
If a service should be singleton or not is determined by a standard property SINGLETON defined
in the ServiceConfig class.
                        </p>
	      				  <p>
Other basic properties used to configure all services are:
ACTIVE when set to "TRUE" means that the service is active and should be run.
INTERVAL defining the interval in seconds of how often the service should be run.
INTERVALMS defining the interval in milliseconds of how often the service should be run.
CRON used instead of INTERVAL or INTERVALMS to specify on a calendar basis.
                        </p>
	      				  <p>
To create a custom timed service class it should implement the org.signserver.server.timedservices.ITimedService interface. There exists a BaseTimedService that can be inherited taking care of most of the basic functionality. If the BaseTimedService is inherited the the only method that needs to be implemented is the 'work()' method.
                        </p>
	      				  <p>
The work method that needs to be implemented is described here:
                        </p>
	      				  <pre>
/**
 * Method that should do the actual work and should
 * be implemented by all services. The method is run
 * at a periodical interval defined in getNextInterval.
 *
 * @throws ServiceExecutionFailedException if execution of a service failed
 */
public void work() throws ServiceExecutionFailedException;
                        </pre>
	      				  <p>
There exists a DummyTimedService implementation that is used for demonstration purposes.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="IValidationService Interface"></a>
        *** IValidationService Interface ***
      </h5>
      				  <p>
Just as the other worker plug-ins have the validator service a base class taking care of most of the common methods and the only method that needs to be implemented is the 'validate' method below. But for most applications should the DefaultValidationService work. What is probably more interesting is to develop a custom IValidator used to integrate the default validation service against different certificate status repositories. See section called 'Other Customizations' for details of how to implement a Validator.
                        </p>
	      				  <pre>
/**
 * Method used to check the validation of a certificate
 *
 * @param validationRequest
 * @return a ValidateResponse
 * @throws IllegalRequestException if data in the request didn't conform with the specification.
 * @throws CryptoTokenOfflineException if the crypto token isn't online.
 * @throws SignServerException for general failure exception during validation
 * @see org.signserver.validationservice.common.ValidateRequest
 * @see org.signserver.validationservice.common.ValidateResponse
 */
ValidateResponse validate(ValidateRequest validationRequest) throws IllegalRequestException, CryptoTokenOfflineException, SignServerException;
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Implementing Crypto Tokens"></a>
        Implementing Crypto Tokens
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="The ICryptoToken Interface"></a>
        *** The ICryptoToken Interface ***
      </h5>
      				  <ul>
                            <li>
A custom crypto token needs to implement the interface org.signserver.server.cryptotokens.ICryptoToken.  See P12CryptoToken for an example implementation.
                            </li>
                            <li>
You can define own properties for a crypto token in the same way as for workers. The properties are sent to the crypto token upon initialization.
                            </li>
                            <li>
Make sure the custom class is available to the application server
                            </li>
                            <li>
Redeploy the SignServer.
                            </li>
                            <li>
Register the crypto token to a worker in the application by setting a property WORKER&lt;id&gt;.CRYPTOTOKEN.CLASSPATH with a global scope in the global configuration. (Also make sure to set it's crypto tokens class-path, see next section).
                            </li>
                            <li>
Reload the service with the CLI reload command.
                            </li>
                        </ul>
	      				  <p>
The ICryptoToken interface have the following methods that needs to be implemented:
                        </p>
	      				  <pre>
public interface ICryptoToken {
	public static final int PURPOSE_SIGN = 1;
	public static final int PURPOSE_DECRYPT = 2;

	public static final int PROVIDERUSAGE_SIGN    = 1;
	public static final int PROVIDERUSAGE_DECRYPT = 2;

   /**
    * Method called after creation of instance.
    *
    */
	public abstract void init(Properties props) throws CryptoTokenInitializationFailureException;

	/**
	 *  Method that returns the current status of the crypto token.
	 *
	 *  Should return one of the SignerStatus.STATUS_.. values
	 */
	public abstract int getCryptoTokenStatus();

    /**
     * Method used to activate SignTokens when connected after being off-line.
     *
     * @param authenticationcode used to unlock crypto token, i.e PIN for smartcard HSMs
     * @throws CryptoTokenOfflineException if SignToken is not available or connected.
     * @throws CryptoTokenAuthenticationFailureException with error message if authentication to crypto token fail.
     */
    public abstract void activate(String authenticationcode) throws CryptoTokenAuthenticationFailureException, CryptoTokenOfflineException;

    /**
     * Method used to deactivate crypto tokens.
     * Used to set a crypto token too off-line status and to reset the HSMs authorization code.
     *
     * @return true if deactivation was successful.
     */
    public abstract boolean deactivate();

    /** Returns the private key (if possible) of token.
    *
    * @param purpose should one of the PURPOSE_... constants
    * @throws CryptoTokenOfflineException if CryptoToken is not available or connected.
    * @return PrivateKey object
    */
    public abstract PrivateKey getPrivateKey(int purpose) throws CryptoTokenOfflineException;

    /** Returns the public key (if possible) of token.
    *
    * @param purpose should one of the PURPOSE_... constants
    * @throws CryptoTokenOfflineException if CryptoToken is not available or connected.
    * @return PublicKey object
    */
    public abstract PublicKey getPublicKey(int purpose) throws CryptoTokenOfflineException;


    /** Returns the signature Provider that should be used to sign things with
     *  the PrivateKey object returned by this crypto device implementation.
     *  @param providerUsage should be one if the ICryptoToken.PROVIDERUSAGE_ constants
     *  specifying the usage of the private key.
     * @return String the name of the Provider
     */
    public abstract String getProvider(int providerUsage);

    /**
     * Method returning the crypto tokens certificate if it's included in the token.
     * This method should only be implemented by soft crypto tokens which have the certificate
     * included in the key store.
     *
     * All other crypto tokens should return 'null' and let the signer fetch the certificate from database.
     *
     */

    public abstract Certificate getCertificate(int purpose) throws CryptoTokenOfflineException;


    /**
     * Method returning the crypto tokens certificate chain if it's included in the token.
     * This method should only be implemented by soft crypto tokens which have the certificates
     * included in the key store.
     *
     * All other crypto tokens should return 'null' and let the signer fetch the certificate from database.
     *
     */

    public abstract Collection&lt;Certificate&gt; getCertificateChain(int purpose) throws CryptoTokenOfflineException;

	/**
	 * Method used to tell the crypto token to create a certificate request using its crypto token.
	 */
	public ICertReqData genCertificateRequest(ISignerCertReqInfo info) throws CryptoTokenOfflineException;

	/**
	 * Method used to remove a key in the signer that shouldn't be used any more
	 * @param purpose on of ICryptoToken.PURPOSE_ constants
	 * @return true if removal was successful.
	 */
	public boolean destroyKey(int purpose);
}
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="The Extended Crypto Token Interface"></a>
        *** The Extended Crypto Token Interface ***
      </h5>
      				  <p>
The default group key service need support for symmetric keys in addition the the functionality provided in the basic crypto token which mainly focuses on asymmetric key functionality.
                        </p>
	      				  <p>
The extended crypto token adds four more methods that need implementation used to generate exportable keys (symmetric or asymmetric) and to encrypt/decrypt data using symmetric keys.
                        </p>
	      				  <pre>
public interface IExtendedCryptoToken extends ICryptoToken {

	/**
	 * Method instructing the crypto token to generate a key that is returned
	 *
	 * @param keyAlg the key algorithm to generate, it's up to the caller to check that the crypto token
	 * used supports the given value.
	 * @param keySpec specification of the key, it's up to the caller to check that the crypto token
	 * used supports the given value.
	 * @return either a java.security.Key or a java.security.KeyPair depending on type of keyAlg sent to the the crypto token.
	 * @throws IllegalRequestException if the token doesn't support the given key alg or key spec.
	 * @throws CryptoTokenOfflineException if the token isn't online.
	 */
	Serializable genExportableKey(String keyAlg, String keySpec) throws IllegalRequestException, CryptoTokenOfflineException;

	/**
	 * Instructs the crypto token to generate a key stored in the device returning only
	 * a alias reference to the key.
	 *
	 * @param keyAlg the key algorithm to generate, it's up to the caller to check that the crypto token
	 * @param keySpec keySpec specification of the key, it's up to the caller to check that the crypto token
	 * used supports the given value.
	 * @return a reference to the key in that can be used later for encryption/decryption.
	 *
	 * @throws IllegalRequestException if the token doesn't support the given key alg or key spec.
	 * @throws CryptoTokenOfflineException if the token isn't online.
	 */
	String genNonExportableKey(String keyAlg, String keySpec) throws IllegalRequestException,  CryptoTokenOfflineException;

	/**
	 * Method used to encrypt data using a key stored in the crypto token. This
	 * method should mainly be used for symmetric encryption.
	 * @param keyRef a alias reference to the key that should be used.
	 * @param data the data to encrypt.
	 * @return the encrypted data.
	 * @throws CryptoTokenOfflineException if the token isn't online.
	 */
	byte[] encryptData(String keyRef, byte[] data) throws CryptoTokenOfflineException;

	/**
	 * Method used to decrypt data using a key stored in the crypto token. This
	 * method should mainly be used for symmetric encryption.
	 * @param keyRef a alias reference to the key that should be used.
	 * @param data the data to decrypt.
	 * @return the encrypted data.
	 * @throws CryptoTokenOfflineException if the token isn't online.
	 */
	byte[] decryptData(String keyRef, byte[] data) throws CryptoTokenOfflineException;


}
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Sample Workers and Components"></a>
        Sample Workers and Components
      </h4>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This is a SignServer Enterprise Edition (EE) feature.
                    </div>
</div>
	      				  <p>
There is a module containing sample and skeleton implementation of almost all
the different kinds of workers as well as different components. 
                    </p>
	      				  <p>
The source of the module is located in SIGNSERVER_HOME/modules/mod-enterprise/SignServer-Module-Sample/.
                    </p>
	      				  <p>
The following implementations are available:
                    </p>
	      				  <ul>
                        <li>SkeletonTimedService, HelloTimedService</li>
                        <li>SkeletonWorker, HelloWorker</li>
                        <li>SkeletonDispatcher, StatisticalDispatcher</li>
                        <li>SkeletonSigner, TextSigner</li>
                        <li>SkeletonValidator, TextValidator</li>
                        <li>SkeletonArchiver, FileArchiver</li>
                        <li>SkeletonAccounter, GlobalConfigAccounter</li>
                        <li>SkeletonAuthorizer, ReversedNameAuthorizer</li>
                    </ul>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Other Customizations"></a>
      Other Customizations
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="The IValidator Interface"></a>
        The IValidator Interface
      </h4>
      				  <p>
A Validator is used in the DefaultValidationService to connect to different kinds of certificate status repositories, such as CRL, OCSP, XKMS, database etc. It contains two methods 'validate' used for the actual certificate validation and 'testConnection' used by health check related functionality to check that the connection to the underlying validator resource is alright.
                    </p>
	      				  <pre>
/**
 * Main method of a Validation Service responsible for validating certificates.
 *
 * Important a validator also have to support to check the revocation status of the
 * involved CA certificates and should only return Validation object with status REVOKED or VALID
 * If the validator doesn't support the given issuer it must return null.
 *
 *
 * @param cert the certificate to validate.
 * @return a Validation object or null if the certificate couldn't be looked up in this validator.
 * @throws IllegalRequestException if data in the request didn't conform with the specification.
 * @throws CryptoTokenOfflineException if the crypto token isn't online.
 * @throws SignServerException for general failure exception during validation.
 */
Validation validate(ICertificate cert) throws IllegalRequestException, CryptoTokenOfflineException, SignServerException;






/**
 * Optional method used to test the connection to a specific underlying validator implementation.
 *
 * @throws ConnectException if connection to underlying validator implementation failed.
 * @throws SignServerException for general failure exception during validation.
 */
void testConnection() throws ConnectException, SignServerException;
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="The IAuthorizer Interface"></a>
        The IAuthorizer Interface
      </h4>
      				  <p>
It's possible to integrate the authorization of processable requests with external authorizations applications. All that is needed is a class implementing the IAuthorizer interface containing two methods, 'init' and 'isAuthorized'.
                    </p>
	      				  <p>
To register that the customized authorizer should be used by a worker, all that's needed to be done is to set the property AUTHTYPE to the class path of the authorizer implementation.
                    </p>
	      				  <pre>
public interface IAuthorizer {

	/**
	 * Method called by the worker upon first call to the authenticator after instantiation.
	 *
	 * @param workerId id of worker.
	 * @param config active worker configuration of worker
	 * @param em the SignServer EntityManager
	 * @throws SignServerException if unexpected error occurred during initialization.
	 */
	void init(int workerId, WorkerConfig config, EntityManager em) throws SignServerException;

	/**
	 *
	 * Main method determining if the requester is authorized to process the data in the request.
	 *
	 * @param request the request data sent to the worker to process.
	 * @param requestContext containing the optional clientCert client certificate or remote IP of the user, may also contain customly defined data.
	 * @throws SignServerException if unexpected error occurred during authorization.
	 * @throws IllegalRequestException if the requester isn't authorized or couldn't be authenticated for some other reason.
	 */
	void isAuthorized(ProcessRequest request, RequestContext requestContext) throws IllegalRequestException, SignServerException;
}
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="The Archiving API"></a>
        The Archiving API
      </h4>
      				  <p>
Custom ArchiverS can be implemented by implementing the Archiver interface. See 
org.signserver.server.archive.Archiver.
                    </p>
	      				  <p>
                        <a href="../images/archivingapi.png"><img src="../images/archivingapi.png" align="middle" border="1" width="603" height="323" alt="Archiving API" /></a>
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Using the Global Configuration Store"></a>
        Using the Global Configuration Store
      </h4>
      				  <p>
The global configuration store is a memory bank that workers can use to store data used
in ongoing operations. The data can be either node (i.e. only read by the current node) or global
scoped.
                    </p>
	      				  <p>
To access the global configuration store use the getGlobalConfigurationSession() method
from the BaseWorker (inherited by most of the base component implementations). The returned
GlobalConfigurationSession have the following methods that can be used (the other ones should be
avoided)
                    </p>
	      				  <pre>
/**
* Method setting a global configuration property. For node. prefix will the
node id be appended.
* @param scope, one of the GlobalConfiguration.SCOPE_ constants
* @param key of the property should not have any scope prefix, never null
* @param value the value, never null.
*/
public void setProperty( java.lang.String scope,java.lang.String
key,java.lang.String value ) ;
/**
* Method used to remove a property from the global configuration.
* @param scope, one of the GlobalConfiguration.SCOPE_ constants
* @param key of the property should start with either glob. or node., never
null
* @return true if removal was successful, othervise false.
*/
public boolean removeProperty( java.lang.String scope,java.lang.String key )
;
/**
* Method that returns all the global properties with Global Scope and Node
scopes properties for this node.
* @return A GlobalConfiguration Object, nevel null
*/
public org.signserver.common.GlobalConfiguration getGlobalConfiguration( ) ;
                    </pre>
	      				  <p>
The getGlobalConfiguration returns a GlobalConfiguration and have a method
String getProperty(String scope, String property) that can be used.

The value of the property can be user-defined as long as it is guaranteed to be unique over the entire
application.

Reserved values are all property keys starting with "WORKER".
                    </p>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Testing"></a>
      Testing
    </h3>
      				  <p>
                    There exists some test scripts used to test that the SignServer functions correctly. They are described here.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Automatic JUnit Tests"></a>
        Automatic JUnit Tests
      </h4>
      				  <p>
Automatic JUnit tests are in the different projects and system tests in SignServer-Test-System.
                    </p>
	      				  <p>
Important: For the SignServer test suite to run successful the following 
properties should be set in signserver_deploy.properties:
                    <ul>
                        <li>signserverws.enabled=true</li>
                        <li>genericws.enabled=true</li>
                        <li>validationws.enabled=true</li>
                        <li>adminws.enabled=true</li>
                        <li>timestampclient.enabled=true</li>
                        <li>validationclient.enabled=true</li>
                        <li>signingandvalidationapi.enabled=true</li>
                        <li>clientcli.enabled=true</li>
                        <li>includemodulesinbuild=true</li>
                        <li>useclusterclassloader=true</li>
                        <li>clusterclassloader.useclassversions=true</li>
                        <li>healthcheck.maintenancefile=/path/to/signserver/maintenance.properties (where /path/to/signserver is the path where SignServer is located)</li>
                    </ul>
                    </p>
	      				  <p>
For the Database CLI tests to run successfully you will need to put the JDBC 
driver for your database as lib/ext/jdbc/jdbc.jar.
                    </p>
	      				  <p>
To run the test suite do the following:
                    </p>
	      				  <ul>
<li>Set the environment variable SIGNSERVER_HOME</li>
<li>Make sure SignServer is deployed and the application server is running</li>
<li>Do 'ant test:run'</li>
<li>A protocol is generated in the directory 'bin/junit'</li>
                    </ul>
	      				  <p>
A single system test can be run with "ant test:runone -Dtest.runone=ClassName" 
where ClassName is replaced with the test class to run.
                    </p>
	      				  <p>
A single test can also be run the same way from any of the other projects that 
has tests by executing the command from their project directory.
                    </p>
	      				  <p>
If SignServer is configured to run without database some tests needs to be excluded by running like this:    
                    </p>
	      				  <pre class="code">
bin/ant test:run -Dexcludes=&quot;**/ArchivingCLITest*,**/Base64DatabaseArchiverTest*,**/OldDatabaseArchiverTest*,**/ArchiveTest*,**/AuditLogCLITest*,**/DatabaseCLITest*,**/VerifyLogCommandTest*&quot;
                    </pre>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="System tests with HSM"></a>
        *** System tests with HSM ***
      </h5>
      				  <p>
To run system tests with an HSM create an properties file in SIGNSERVER_HOME called test-config.properties containing the PKCS#11 configuration including the key alias for an existing RSA key-pair:                            
                        </p>
	      				  <pre class="code">
test.p11.sharedlibrary=/opt/ETcpsdk/lib/linux-x86_64/libcryptoki.so
test.p11.slot=1
test.p11.pin=foo123
test.p11.existingkey1=mykey001
                        </pre>
	      				  <p>
The tests can be run with:
                        </p>
	      				  <pre class="code">
ant test:p11:run test:report
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Random testing"></a>
        Random testing
      </h4>
      				  <p>
SignServer-Test-Random is a tool for random testing of SignServer. Each test suite
has different requirements configured workers in the different worker groups and 
how many threads that can be used etc. See the source code for further details.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Building and running"></a>
        *** Building and running ***
      </h5>
      				  <p>
Build from modules/SignServer-Test-Random/ using:
                        </p>
	      				  <pre class="code">ant jar</pre>
	      				  <p>
It can then be run from SIGNSERVER_HOME using:
                        </p>
	      				  <pre class="code">bin/randomtest</pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Usage"></a>
        *** Usage ***
      </h5>
      				  <pre class="code">
usage: randomtest &lt;options&gt;
Random testing tool
 -randomseed &lt;arg&gt;     Optional. Seed to initialize the pseudo random
                       generator with.
 -testsuite &lt;arg&gt;      Test suite to run. Any of [signWhileUpdatingConfig,
                       signAndCountSignings, signWhileRenewing].
 -threadgroup1 &lt;arg&gt;   Number of threads in group 1.
 -threadgroup2 &lt;arg&gt;   Number of threads in group 2.
 -timelimit &lt;arg&gt;      Optional. Only run for the specified time (in
                       milliseconds).
 -workergroup1 &lt;arg&gt;   First group of workers. Comma separated list of
                       workerId/workerType.
 -workergroup2 &lt;arg&gt;   Second group of workers. Comma separated list of
                       workerId/workerType
 -workergroup3 &lt;arg&gt;   Third group of workers. Comma separated list of
                       workerId/workerType

Sample usages:
a) randomtest -testsuite signWhileUpdatingConfig -workergroup1
5678/xml,5679/tsa,5680/xml -threadgroup1 4 -workergroup2
5677/xml,5678/xml,5679/tsa -threadgroup2 3 -timelimit 30000

b) randomtest -testsuite signAndCountSignings -workergroup1
5678/xml,5679/tsa,5680/xml -threadgroup1 10 -timelimit 30000

c) randomtest -testsuite signWhileRenewing -workergroup1 300/xml
-workergroup2 301/xml,302/xml -threadgroup1 5 -workergroup3 309/renew
-timelimit 20000

Available worker types:
- workerType can be any of [xml, tsa, renew]

Test suite: signAndCountSignings
- Signs documents with the workers from group 1 with the number of threads
defined for group 1
- Pauses signings and counts performed signings a compares to the key
usage counter value
- Notice that it is assumed that all workers use the same key-pair

Test suite: signWhileUpdatingConfig
- Signs documents with the workers from group 1 with the number of threads
defined for group 1
- Increases a counter in the configuration of group 2
- Notice that the size of thread group 2 must be equal to the number of
workers in group 2

Test suite: signWhileRenewing
- Signs documents with the workers from group 1 with the number of threads
defined for group 1
- Renews signers from group 2 using the one renewal worker in group 3
- Notice that group 3 should only include one renewal worker
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Stress testing"></a>
        Stress testing
      </h4>
      				  <p>
SignServer-Test-Performance is a tool for performance testing of SignServer. Currently it contains only one
test suite for testing time stamping. See the source code for further details.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Building and running"></a>
        *** Building and running ***
      </h5>
      				  <p>
Build from modules/SignServer-Test-Performance/ using:
                        </p>
	      				  <pre class="code">ant jar</pre>
	      				  <p>
It can then be run from SIGNSERVER_HOME using:
                        </p>
	      				  <pre class="code">bin/stresstest</pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Usage"></a>
        *** Usage ***
      </h5>
      				  <pre class="code">
usage: stresstest &lt;options&gt;
Performance testing tool
 -maxwaittime &lt;arg&gt;     Maximum number of milliseconds for a thread to
                        wait until issuing the next time stamp.
                        Default=100
 -processurl &lt;arg&gt;      URL to process servlet (for the DocumentSigner1
                        testsuite).
 -statoutputdir &lt;arg&gt;   Optional. Directory to output statistics to. If
                        set, each threads creates a file in this directory
                        to output its response times to. The directory
                        must exist.
 -testsuite&lt;arg&gt;       Test suite to run. Any of [TimeStamp1, DocumentSigner1].
 -threads &lt;arg&gt;         Number of threads requesting time stamps.
 -timelimit &lt;arg&gt;       Optional. Only run for the specified time (in
                        milliseconds).
 -tsaurl &lt;arg&gt;          URL to timestamp worker to use.
 -warmuptime &lt;arg&gt;      Don't count number of signings and response times
                        until after this time (in milliseconds). Default=0
                        (no warmup time).
 -worker &lt;arg&gt;    Worker name or ID to use (with the DocumentSigner1 test suite).
 -workerurl &lt;arg&gt; URL to worker servlet (for the DocumentSigner1
                        test suite).

Sample usages:
a) stresstest -testsuite TimeStamp1 -threads 4 -tsaurl
http://localhost:8080/signserver/tsa?workerId=1
b) stresstest -testsuite TimeStamp1 -threads 4 -maxwaittime 100
-statoutputdir ./statistics/ -tsaurl
http://localhost:8080/signserver/tsa?workerId=1
c) stresstest -testsuite DocumentSigner1 -threads 4 -processurl
http://localhost:8080/signserver/process -worker PDFSigner -infile
test.pdf
d) stresstest -testsuite DocumentSigner1 -threads 4 -processurl
http://localhost:8080/signserver/process -worker XMLSigner -data &quot;&lt;root/&gt;&quot;
e) stresstest -testsuite DocumentSigner1 -threads 4 -workerurl
http://localhost:8080/signserver/worker -worker 1 -data &quot;&lt;root/&gt;&quot;
              			</pre>
	      				  <p>
              				When finished (after time limit expires, or process is stopped using control+c) a statistic
              				overview is printed containing number of signings, and statistics (average,
              				minimum, and maximum) for response times.
                                </p>
	            </div>
	            </div>
	            </div>
                </div>
          <div class="chapter">
    <h2>
      <a name="ch_misc"></a>
      Miscellaneous
    </h2>
      			          <div class="section">
    <h3>
      <a name="The Global Configuration Store"></a>
      The Global Configuration Store
    </h3>
      				  <p>
The available workers and its crypto tokens and services is configured in something called the global configuration store that is slightly different from a worker configuration.
                </p>
	      				  <p>
Is is dynamically configured and activated immediately. I can contain any type of data (in string representation) and can be of two types, either with global scope or node scope. A Global scoped property can be accessed by  all nodes in the cluster while a Node scoped property in only used within a node and cannot be accessed by the other nodes.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="SignServer specific"></a>
        SignServer specific
      </h4>
      				  <p>
Database failure is handled differently. If a node looses connection to the database it put itself in a state called 'unsynchronised' and will continue its operation without storing the data to database by using a cached global configuration. It is possible to later resynchronise one nodes cached global configuration data  with the database with a CLI command called 'resync'. But it is only possible to sync one of the nodes global configuration to the database.
                    </p>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Status Repository"></a>
      Status Repository
    </h3>
      				  <p>
The status repository holds non-persistent local (per JVM) status information (properties) with optional expiration times. After the expiration time the property is not returned. The value is also not preserved among server restarts. 
                </p>
	      				  <p>
This could be used by having workers read the status from the repository while an external (or internal) service periodically updates it. The (optional) expiration time on the values makes it possible to detect if an periodic service has failed to update the value within the specified time.
                </p>
	      				  <p>
From the Admin CLI the status repository can be controlled using the <i>getstatusproperties</i>, <i>getstatusproperty</i> and <i>setstatusproperty</i> commands.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Logging"></a>
      Logging
    </h3>
      				  <p>
SignServer uses Log4j for debug logging and the security events logger from CESeCore 
for system/audit logging. In addition the worker logger (transaction log) can be configured 
to use Log4j and/or the security events logger.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Worker Log"></a>
        Worker Log
      </h4>
      				  <p>
The purpose of the Worker Loggers are to log each transaction handled by the
worker. Each worker can choose to have its own configuration for the logger. By
default the AllFieldsWorkerLogger is used which used logs all the available
fields one after each other separated by semi colons.
                    </p>
	      				  <p>
Which Worker Logger configuration to use is configured by setting the
<b>WORKERLOGGER</b> property to the full class name of the IWorkerLogger
implementation in the worker's configuration.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="AllFieldsWorkerLogger"></a>
        *** AllFieldsWorkerLogger ***
      </h5>
      				  <p>
The default worker logger for most workers. Can be used during testing to find 
which fields a worker logs and then changed to the PatternWorkerLogger with only 
does fields that are of interest chosen.<br />
LOGLEVEL_DEFAULT sets the level at which
the logger will do log output. These are specified as standard Log4J levels
(FATAL, ERROR, WARNING, INFO, DEBUG, and TRACE), if not set, it defaults to INFO.
                        </p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.server.log.AllFieldsWorkerLogger
LOGLEVEL_DEFAULT=INFO
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SecurityEventsWorkerLogger"></a>
        *** SecurityEventsWorkerLogger ***
      </h5>
      				  <p>
Worker logger using the CESeCore security events logger.
This logger included all fields in the additionalDetails fields in the audit log, except the worker ID, which is mapped to searchDetail2. 
                        </p>
	      				  <p>
The properties LOGINCLUDEFIELDS and LOGEXCLUDEFIELDS can be used to restrict the fields included in additionalDetails by explicitly setting a
comma-separated list of field names. Only one of these options can be set at a time.
                        </p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.server.log.SecurityEventsWorkerLogger
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="PatternWorkerLogger"></a>
        *** PatternWorkerLogger ***
      </h5>
      				  <p>
The LOGLEVEL_DEFAULT property has the same behavior as for the AllFieldsWorkerLogger.
                    	</p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.server.log.PatternWorkerLogger
LOGTIMEZONE=GMT
LOGDATEFORMAT=yyyy-MM-dd:HH:mm:ss:z
LOGPATTERN=\$\{(.+?)\}
LOGORDER=AUDIT; LOG_ID: ${LOG_ID}; CLIENT_IP: ${CLIENT_IP}; REQUEST_FULLURL: ${REQUEST_FULLURL}; RequestTime: ${LOG_TIME}; ResponseTime: ${REPLY_TIME}; EXCEPTION: ${EXCEPTION};
LOGLEVEL_DEFAULT=INFO
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="DefaultTimeStampLogger"></a>
        *** DefaultTimeStampLogger ***
      </h5>
      				  <p>
Pattern logger with a default log order suitable for logging time-stamp requests. This logger is the default logger used by the <a href="complete.en.html#Time-stamp%20Signer">TimeStampSigner</a>.
                        </p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.module.tsa.DefaultTimeStampLogger
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="NullWorkerLogger"></a>
        *** NullWorkerLogger ***
      </h5>
      				  <p>
Worker logger that does not log anything.    
                        </p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.server.log.NullWorkerLogger                            
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="CustomTimeStampLogger1"></a>
        *** CustomTimeStampLogger1 ***
      </h5>
      				  <pre class="code">
WORKERLOGGER=org.signserver.module.tsa.CustomTimeStampLogger1
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="FileWorkerLogger"></a>
        *** FileWorkerLogger ***
      </h5>
      				  <p>
Worker logger that writes the log values to a worker-specific log file (the logger logs all fields, similar to
AllFieldsWorkerLogger.<br />
This logger is mainly intended for use by unit tests, and is not thread safe.
						</p>
	      				  <pre class="code">
WORKERLOGGER=org.signserver.server.log.FileWorkerLogger
LOG_FILE_PATH=/path/to/logfile
						</pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="System Log"></a>
        System Log
      </h4>
      				  <p>
The purpose of the system log is to log events concerning the SignServer application but not necessarily related to any signing transaction (that is covered by the Worker Log). The audit log covers key and certificate management events, status properties updates (for instance for the status of the time source) and to some extent also configuration changes. For details see the table of events below.<br />
From version 3.4.0 SignServer uses the CESeCore library to perform audit logging.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Available log events"></a>
        *** Available log events ***
      </h5>
      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Services</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SIGNSERVER_STARTUP</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged at startup of the SignServer application.
                                    </p>
                                    <p>
<b>VERSION:</b> The version of SignServer.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: SIGNSERVER_STARTUP; MODULE: SERVICE; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; VERSION: SignServer 3.3.0alpha12; REPLY_TIME:1350562045545</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SIGNSERVER_SHUTDOWN</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged at shutdown of the SignServer application.
                                    </p>
                                    <p>
<b>VERSION:</b> The version of SignServer.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: SIGNSERVER_SHUTDOWN; MODULE: SERVICE; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; VERSION: SignServer 3.3.0alpha12; REPLY_TIME:1350562045545</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Global configuration</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SET_GLOBAL_PROPERTY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a global configuration property was updated.
                                    </p>
                                    <p>
<b>GLOBALCONFIG_PROPERTY:</b> The property that was updated.<br />
<b>GLOBALCONFIG_VALUE:</b> The new value of the property.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: SET_GLOBAL_PROPERTY; MODULE: GLOBAL_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; GLOBALCONFIG_VALUE: TESTVALUE47; GLOBALCONFIG_PROPERTY: GLOB.TESTPROPERTY47; REPLY_TIME:1350657202153</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>REMOVE_GLOBAL_PROPERTY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a global configuration property was removed.
                                    </p>
                                    <p>
<b>GLOBALCONFIG_PROPERTY:</b> The property that was removed.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: REMOVE_GLOBAL_PROPERTY; MODULE: GLOBAL_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; GLOBALCONFIG_PROPERTY: GLOB.TESTPROPERTY47; REPLY_TIME:1350657202444</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>GLOBAL_CONFIG_RELOAD</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when the global configuration was reloaded from the database.
                                    </p>
                                    <p>
Example:
<pre class="code">EVENT: GLOBAL_CONFIG_RELOAD; MODULE: GLOBAL_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; REPLY_TIME:1350657202593</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>GLOBAL_CONFIG_RESYNC</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when the resync command was executed.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: GLOBAL_CONFIG_RESYNC; MODULE: GLOBAL_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; REPLY_TIME:1350894343902</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Worker configuration</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SET_WORKER_CONFIG</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a worker's configuration was updated by adding and/or removing and/or changing any values.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.
                                    </p>
                                    <p>
Changes in worker properties are logged with prefixes <b>added/changed/removed</b> followed by a colon and the property name a colon and the property value.<br />
Several property changes can occur in one log line (see examples below).<br />
Authorized clients are shown as a property with the name <b>authorized_client</b>.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: SET_WORKER_CONFIG; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; added:FOO: bar; REPLY_TIME:1350657202773</pre>
                                    </p>
                                    <p>
<pre class="code">EVENT: SET_WORKER_CONFIG; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; changed:FOO: newvalue; REPLY_TIME:1350657202873</pre>
                                    </p>
                                    <p>
<pre class="code">EVENT: SET_WORKER_CONFIG; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; removed:FOO: newvalue; REPLY_TIME:1350657202873</pre>
                                    </p>
                                    <p>
<pre class="code">EVENT: SET_WORKER_CONFIG; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; added:FOO: bar; changed:BAR: newvalue; REPLY_TIME:1350657202873</pre>                                    
                                    </p>
                                    <p>
<pre class="code">EVENT: SET_WORKER_CONFIG; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; added:authorized_client: SN: 1234567890, issuer DN: CN=Test; REPLY_TIME:1350657202873</pre>
                                    </p>
                                    
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>CERTINSTALLED</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a certificate was uploaded to the worker configuration.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>CERTIFICATE:</b> The certificate in PEM format.<br />
<b>SCOPE: </b> If the setting was at GLOBAL or NODE scope.<br />
<b>NODE: </b> The ID of the node if the setting was at NODE scope, otherwise not available.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: CERTINSTALLED; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; CERTIFICATE: Subject: CN=Anyone
Issuer: CN=Anyone
-----BEGIN CERTIFICATE-----
MIIBnTCCAQagAwIBAgIIWWNYSOeuN+swDQYJKoZIhvcNAQEFBQAwETEPMA0GA1UE
AwwGQW55b25lMB4XDTEyMTAxOTE0MzMyM1oXDTEzMTAxOTE0MzMyM1owETEPMA0G
A1UEAwwGQW55b25lMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCDE9GElbJd
e74WmIpPSsIF9r5vv0oH6WWo7n31goR1zMIHJPC9V1mpwQZ6C0uCHCV2ZvqQIIAE
ZQM7mgbPfxjCF74RqKzScZlOSaHnvdf7zCWpYraVrIDt9Wg3HMxye0/L3cCImmkY
FkFtabtoa5UuPZObdIt154Yg+GpGB8aPBwIDAQABMA0GCSqGSIb3DQEBBQUAA4GB
AHm3oAUHwM0KwMcEUwWouE0f4+UK6ZvYvxLAgiCVZQnPImcqX1oBl+iFV59FlsXj
rqoQYJROxIeV0ByGeyBYXqvgTw1YtdqoR+wKmiymjn/lynmTh1fQMcFoUouGfubX
EK4rfPBXEl33gKbsO5aeMHd5iF2jtx7RfYMsOuHKoDSe
-----END CERTIFICATE-----
; SCOPE: GLOBAL; REPLY_TIME:1350657204367</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>CERTCHAININSTALLED</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a certificate chain was uploaded to the worker configuration or imported to a crypto token.
                                    </p>
                                    <p>
With MODULE: WORKER_CONFIG the certificate chain was installed in the configuration:
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>CERTIFICATECHAIN:</b> The certificates in PEM format.<br />
<b>SCOPE: </b> If the setting was at GLOBAL or NODE scope.<br />
<b>NODE: </b> The ID of the node if the setting was at NODE scope, otherwise not available.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: CERTCHAININSTALLED; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; CERTIFICATECHAIN: Subject: CN=Signer,C=SE
Issuer: CN=Issuer,C=SE
-----BEGIN CERTIFICATE-----
MIIBdjCCASCgAwIBAgIIE+fXOs/SAwMwDQYJKoZIhvcNAQEFBQAwHjEPMA0GA1UE
AwwGSXNzdWVyMQswCQYDVQQGEwJTRTAeFw0xMjEwMjIwNzQ1MDZaFw0xMzEwMjIw
NzQ1MDZaMB4xDzANBgNVBAMMBlNpZ25lcjELMAkGA1UEBhMCU0UwgZ8wDQYJKoZI
hvcNAQEBBQADgY0AMIGJAoGBAKpX5psdaL5CHAKSxoOvB12Ie8iUb/mX6ikF8jfu
zrbwVgf6bX0RCUnD+v+t9vY7byz+nN32KnmGluNGdBFdM1Ug9Oc+64ZNBbgZi9mi
cHnKMDLLSECBY2Nux62PZejp5SwtzpjFymt3TMCtRr4UHGu3zkuqLLCHFlGRdvdo
MPQ9AgMBAAEwDQYJKoZIhvcNAQEFBQADQQADlInGm9AujZfL+1kM7ehaKyKKencF
fp6YGElOpGEplxxIwgmVc0iYKv4rCkfUAysYL6l3AC+VLK1asxkpEJc1
-----END CERTIFICATE-----
Subject: CN=Issuer,C=SE
Issuer: CN=Issuer,C=SE
-----BEGIN CERTIFICATE-----
MIIBMTCB3KADAgECAggbfKZHs8ttKDANBgkqhkiG9w0BAQUFADAeMQ8wDQYDVQQD
DAZJc3N1ZXIxCzAJBgNVBAYTAlNFMB4XDTEyMTAyMjA3NDUwNloXDTEzMTAyMjA3
NDUwNlowHjEPMA0GA1UEAwwGSXNzdWVyMQswCQYDVQQGEwJTRTBcMA0GCSqGSIb3
DQEBAQUAA0sAMEgCQQCpgzxJ6r6D1cP8v1AB88pJsCwi0SJdeRSGYydYYBOafJk0
fpqxJCwaiFS3tt9OkWUAXzcixv5+sItkEuEOpmp7AgMBAAEwDQYJKoZIhvcNAQEF
BQADQQCC5NG3eWx/mXXKZmePOvZEIwyqWHOwzsBB174gkzlyhOdiOr3YwVihyebI
VAfkEktRrO04Hi5eLR+AxW7EVz6l
-----END CERTIFICATE-----
; SCOPE: GLOBAL; REPLY_TIME:1350891906417
</pre>
                                    </p>
                                    <p>
With MODULE: KEY_MANAGEMENT the certificate chain was imported to the token:
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>CERTIFICATECHAIN:</b> The certificates in PEM format.<br />
<b>KEYALIAS:</b> The alias of the entry in the token.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: CERTCHAININSTALLED; MODULE: KEY_MANAGEMENT; ADMINISTRATOR: CLI user; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 5801; KEYALIAS: testkeyalias10; CRYPTOTOKEN: HSMCryptoToken1; CERTIFICATECHAIN: Subject: CN=testkeyalias10,C=SE
Issuer: CN=Issuer,C=SE
-----BEGIN CERTIFICATE-----
MIIBMjCB3aADAgECAgEBMA0GCSqGSIb3DQEBCwUAMB4xDzANBgNVBAMMBklzc3Vl
cjELMAkGA1UEBhMCU0UwHhcNMTUwNTI5MTEzMTAyWhcNMTYwNTI4MTEzMTAyWjAm
MRcwFQYDVQQDDA50ZXN0a2V5YWxpYXMxMDELMAkGA1UEBhMCU0UwXDANBgkqhkiG
9w0BAQEFAANLADBIAkEAggmuPO78M3hhwh4MrxYzt0LM6vLmI4IWjLxO8EK8R0FV
cDu5Rruxc/a51LCt8J8dOxm34h0RakqzObbFYZxwZwIDAQABMA0GCSqGSIb3DQEB
CwUAA0EAYR/N98UTyjnkFMnRmd1dQfsD6cih7Dt6NTi+qxFeMbbuzVA9HhRcXwQn
NChSJMtvJ9sKslfhlfqwZGPChSFg3g==
-----END CERTIFICATE-----
Subject: CN=Issuer,C=SE
Issuer: CN=Issuer,C=SE
-----BEGIN CERTIFICATE-----
MIIBMTCB3KADAgECAghQdZlXUcZalTANBgkqhkiG9w0BAQUFADAeMQ8wDQYDVQQD
DAZJc3N1ZXIxCzAJBgNVBAYTAlNFMB4XDTE1MDUyOTExMzEwMloXDTE2MDUyODEx
MzEwMlowHjEPMA0GA1UEAwwGSXNzdWVyMQswCQYDVQQGEwJTRTBcMA0GCSqGSIb3
DQEBAQUAA0sAMEgCQQCa35ZZru5A2DigDNyOdsZL789dVVlUTXch/Fa0e82X+FLc
kuMoRqAuxrEw/5+uG1Xi7EkysdgyRPbdYHmv3hBlAgMBAAEwDQYJKoZIhvcNAQEF
BQADQQAS3us4jsjHRSooeNuaaAdWjrA7b/nVnkhRjEmHUCORJXGwnHykUGB2idj6
d3UejoxEJ78E+EAYWO2JvKbhV0ku
-----END CERTIFICATE-----
; REPLY_TIME:1432899062650

</pre>
                                    </p>                                    
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>KEYSELECTED</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when the key-pair to use was selected by changing the value of the DEFAULTKEY worker property.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>KEYALIAS:</b> The new key alias.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.<br />
<b>SCOPE: </b> If the setting was at GLOBAL or NODE scope.<br />
<b>NODE: </b> The ID of the node if the setting was at NODE scope, otherwise not available.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: KEYSELECTED; MODULE: WORKER_CONFIG; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 100; KEYALIAS: ts_key00002; CRYPTOTOKEN: TestSigner6000; SCOPE: GLOBAL; REPLY_TIME:1350891907048</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Key management</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>KEYGEN</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a new key-pair was generated using the built-in key generation command.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>KEYALIAS:</b> The new key alias.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.<br />
<b>KEYSPEC:</b> The key specification (ie. RSA/DSA bit length or EC curve).<br />
<b>KEYALG:</b> The key algorithm.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: KEYGEN; MODULE: KEY_MANAGEMENT; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 5676; KEYALIAS: ts_key00004; CRYPTOTOKEN: HSMCryptoToken0; KEYSPEC: 2048; KEYALG: RSA; REPLY_TIME:135089190791</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>KEYTEST</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when the key test command was executed and a test signing with either the specified key or all keys in the slot if that was specified.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>KEYALIAS:</b> Alias of the the key to test or "all" to test all available keys in the slot.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.<br />
<b>TESTRESULTS:</b> The test report with an entry for each tested key.
                                    </p>
                                    <p>
Example:<br />            
<pre class="code">EVENT: KEYTEST; MODULE: KEY_MANAGEMENT; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 47; KEYALIAS: all; CRYPTOTOKEN: HSMCryptoToken1; TESTRESULTS: KeyTestResult{alias=tsu47_key00005, success=true, status=, publicKeyHash=979359e5261112b11fac341962bec1e7e6052d9e}
KeyTestResult{alias=key5, success=true, status=, publicKeyHash=46b264e4892ef2e4fd9616e4927534ca3597fd9c}
KeyTestResult{alias=key3, success=true, status=, publicKeyHash=ae64792f1f50e23eb54bf79d46d819bc07db2d79}
KeyTestResult{alias=key2, success=true, status=, publicKeyHash=b1317f363e6124a8e15bba8c1adb9f20b2f4ef59}
KeyTestResult{alias=TS Signer 1, success=true, status=, publicKeyHash=8f6dfccdcea931d4deee9466f43c0eb0e7f4d8b1}
; REPLY_TIME:1350564289165</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>GENCSR</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a certificate signing request (CSR) was generated.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>KEYALIAS:</b> The key alias of the key used to generate the CSR.<br />
<b>FOR_DEFAULTKEY: </b> True if the "default key" was requested.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.<br />
<b>CSR:</b> Base64 encoded CSR (typically in PKCS#10 format).
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: GENCSR; MODULE: KEY_MANAGEMENT; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 5676; KEYALIAS: ts_key00004; CRYPTOTOKEN: HSMCryptoToken0; CSR: MIIBYDCBygIBADAjMRQwEgYDVQQDDAtUUyBTaWduZXIgMTELMAkGA1UEBhMCU0Uw
gZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAJt8F51wD+QcX+WLyIxjWu3at3q+
IiJrL5jIenmggUhjOLHGHOStoNOiYEQAaiiTZ623m9y7O3zhqFdAdWZg+JrfsHQJ
pjKV9RgvJznl6yk/K54BWOBgqjvbloAUGtn8y8Hf+5DYJUJNFqrzvRLcmCQ9JU0H
mgSmEIqgOIwBL3oBAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEAer5hr/cUYx4jy0XO
N4U8sP/2gSFppytx9dn5BamVBLjDkcML8B3c9u9omDPebd+LEsCU+HCmYN9xHkSS
Ei8lcAqyVv+SDLEmvE8gnrPFR/J7uADCRayLVQumW6/YpVO/sFEGuM6rgnn8ZJmW
X2lhvJ4V1UhlkEAeyIQ861U3IgE=; REPLY_TIME:1350891907981</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>KEYREMOVE</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a key was removed or an removal attempt was performed.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker.<br />
<b>KEYALIAS:</b> The key alias of the key removed.<br />
<b>CRYPTOTOKEN:</b> Name of the configured crypto worker or the name or ID of the current worker if no separate crypto worker is used.<br />
<b>SUCCESS:</b> True if the key was removed or false if the removal failed or if removal was not supported by the token.<br />
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: KEYREMOVE; MODULE: KEY_MANAGEMENT; ADMINISTRATOR: CLI user; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: 20003; KEYALIAS: signKey000002; CRYPTOTOKEN: HSMCryptoToken1; SUCCESS: true; REPLY_TIME:1391008847962</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Status Repository</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>SET_STATUS_PROPERTY</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged when a status property was updated.
                                    </p>
                                    <p>
<b>STATUSREPO_PROPERTY:</b> The updated property.<br />
<b>STATUSREPO_VALUE:</b> The new property value.<br />
<b>STATUSREPO_EXPIRATION:</b> Expiration time for the status property (timestamp), if any.
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: SET_STATUS_PROPERTY; MODULE: STATUS_REPOSITORY; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; STATUSREPO_EXPIRATION: 1350891909366; STATUSREPO_PROPERTY: TEST_PROPERTY1; STATUSREPO_VALUE: TESTVALUE47; REPLY_TIME:1350891908372</pre>
                                    </p>
                                
      </td>
      </tr>
                  <tr>
                      <th colspan="2" rowspan="1"
      valign="top" align="left">
          <i>Worker processing</i>
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          <b>PROCESS</b>
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Logged for events regarding worker processing but when a worker logger can not be used because the requested worker does not exist etc.
                                    </p>
                                    <p>
<b>WORKER_ID:</b> The ID of the worker or empty in case of non existing worker.<br />
<b>Worker logger fields:</b> All fields available to the worker logger.<br />
                                    </p>
                                    <p>
Example:<br />
<pre class="code">EVENT: PROCESS; MODULE: WORKER; ADMINISTRATOR: null; ISSUER: null; SERIAL_NUMBER: null; WORKER_ID: null; LOG_ID: db517726-ff0d-40dd-8f2b-2297925cb4d3; CLIENT_IP: 127.0.0.1; PROCESS_SUCCESS: false; REQUEST_LENGTH: 0; XFORWARDEDFOR: null; FILENAME: noname.dat; 
REQUEST_FULLURL: http://localhost:8080/signserver/process?null; LOG_TIME: 1350628977410; WORKER_ID: 0; EXCEPTION: No such worker: 0; REPLY_TIME:1350628977411
</pre>
                                    </p>
                                
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="CESeCore Security Events Logger"></a>
        CESeCore Security Events Logger
      </h4>
      				  <p>
The default logging implementation, <code>org.signserver.server.log.SignServerLog4jDevice</code> uses Log4J and a similar logging format as the old SystemLogger.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Signed log"></a>
        *** Signed log ***
      </h5>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
This is a SignServer Enterprise Edition (EE) feature.
                        </div>
</div>
	      				  <p>
An example configuration for CESeCore is provided in <code>conf/cesecore.properties.sample</code>.
                        </p>
	      				  <p>
To enable signed audit logs configure conf/databaseprotection.properties (see conf/databaseprotection.properties.sample). And set the following which enables signing of the AuditRecordData table as well as verification of the log entries queried using for instance the CLI or GUI:
                        </p>
	      				  <pre class="code">
databaseprotection.enablesign.AuditRecordData = true
databaseprotection.enableverify.AuditRecordData = true
                        </pre>
	      				  <p>
Configure a key-pair to use for signing and verification of the log with something similar to this:
                        </p>
	      				  <pre class="code">
databaseprotection.keyid = 400
databaseprotection.keyid.0 = 400
databaseprotection.keylabel.0 = dbProtKey
databaseprotection.classname.0 = org.cesecore.keys.token.PKCS11CryptoToken
databaseprotection.properties.0 = sharedLibrary=/opt/utimaco/Software/PKCS11/lib/Linux-x86-64/libcs2_pkcs11.so, slotLabelType=SLOT_NUMBER, slotLabelValue=1
databaseprotection.data.0 =
databaseprotection.tokenpin.0 = userpin1
databaseprotection.version.0 = 2
                        </pre>
	      				  <p>
Note: each SignServer node writing to the audit log needs to use different node IDs. By default the hostname is used. If multiple instances 
are running from the same host set the node id manually in conf/cesecore.properties as cluster.nodeid.
                        </p>
	      				  <p>
If enableverify is set to true, all individual log entries that are displayed 
using CLI, GUI or over web services are verified at the server side and in case 
of inconsistent signatures an error message is displayed. This verification will 
not discover missing log entries. To verify the complete log for all nodes as 
well as detect gaps in the sequence numbering, run the <a href="complete.en.html#Database%20CLI">Database CLI</a>.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="AuditRecordData table"></a>
        *** AuditRecordData table ***
      </h5>
      				  <p>
The exact database table structure is described in the SQL scripts available under doc/sql-scripts/.                            
                        </p>
	      				        <table class="ForrestTable" cellspacing="1" cellpadding="4">
              <tr>
                      <th colspan="1" rowspan="1"
      valign="top" align="left">
          Friendly Name
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Table Name
      </th>
                          <th colspan="1" rowspan="1"
      valign="top" align="left">
          Description
      </th>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Time
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          timeStamp
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>
Time stamp (number of milliseconds since January 1, 1970, 00:00:00 GMT). Example:
                                    </p>
                                    <pre class="code">1359550503607</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Outcome
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          eventStatus
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Status/result of the operation performed. Can be:</p>
                                    <ul>
                                        <li>SUCCESS</li>
                                        <li>FAILURE</li>
                                        <li>VOID</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Event
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          eventType
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>The event. Some examples:</p>
                                    <ul>
                                        <li>SIGNSERVER_STARTUP</li>
                                        <li>SET_GLOBAL_PROPERTY</li>
                                        <li>SET_WORKER_CONFIG</li>
                                        <li>KEYGEN</li>
                                        <li>PROCESS</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Module
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          module
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>The source module of the event. Some examples:</p>
                                    <ul>
                                        <li>SERVICE</li>
                                        <li>GLOBAL_CONFIG</li>
                                        <li>WORKER_CONFIG</li>
                                        <li>KEY_MANAGEMENT</li>
                                        <li>WORKER</li>
                                        <li>STATUS_REPOSITORY</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Service
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          service
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>The service performing the operation. Some examples:</p>
                                    <ul>
                                        <li>CORE</li>
                                        <li>SIGNSERVER</li>
                                        <li>EJBCA</li>
                                    </ul>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Admin Subject
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          authToken
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Information about which administrator performed the operation.</p>
                                    <p>
Subject DN from the administrator's certificate if the operation was performed 
over web services, "CLI User" if the EJB remote interface was used, the name 
of the service if it was an internal operation or "Client User" if the request 
came from a client.
                                    </p>
                                    <p>Some examples:</p>
                                    <pre class="code">C=SE, O=My Organization, CN=Admin 1</pre>
                                    <pre class="code">CLI User</pre>
                                    <pre class="code">StartServicesServlet.init</pre>
                                    <pre class="code">Client User</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Admin Serial Number
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          searchDetail1
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Information about which administrator performed the operation.</p>
                                    <p>Certificate serial number for the administrator performing the operation (if available). Example:</p>
                                    <pre class="code">4a3442e98e3ce428</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Admin Issuer
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          customId
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Information about which administrator performed the operation.</p>
                                    <p>
Issuer DN from the administrator's certificate (if available). Example:
                                    </p>
                                    <pre class="code">C=SE, O=My Organization, CN=AdminCA1</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Worker ID
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          searchDetail2
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>ID of worker involved in the operation (if any). Example:</p>
                                    <pre class="code">71</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Node
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          nodeId
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>ID of the node (typically the hostname if not explicitly specified). Example:</p>
                                    <pre class="code">dsstsa1.example.com</pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Details
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          additionalDetails
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Additional key-value pairs with information about the operation encoded with Java XML serialization. Example:</p>
                                    <pre class="code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;java version="1.6.0_24" class="java.beans.XMLDecoder"&gt;
 &lt;object class="org.cesecore.util.Base64PutHashMap"&gt;
  &lt;void method="put"&gt;
   &lt;string&gt;GLOBALCONFIG_PROPERTY&lt;/string&gt;
   &lt;string&gt;GLOB.WORKER1.CLASSPATH&lt;/string&gt;
  &lt;/void&gt;
  &lt;void method="put"&gt;
   &lt;string&gt;GLOBALCONFIG_VALUE&lt;/string&gt;
   &lt;string&gt;org.signserver.module.xmlsigner.XMLSigner&lt;/string&gt;
  &lt;/void&gt;
 &lt;/object&gt;
&lt;/java&gt;
                                    </pre>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Sequence Number
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          sequenceNumber
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Sequence number of the log entry. Should be unique and sequential per node.</p>
                                
      </td>
      </tr>
                  <tr>
                      <td colspan="1" rowspan="1"
      valign="top" align="left">
          Row Protection
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          rowProtection
      </td>
                          <td colspan="1" rowspan="1"
      valign="top" align="left">
          
                                    <p>Contains information about wich key-pair and signature algorithm that has been used and the actual signature value (if the row is signed). Example:</p>
                                    <pre class="code">1:2:400:079b6c2d89671702077b1802ff221cd7c6d71804ea3771b7d5f7cd1...</pre>
                                
      </td>
      </tr>
        </table>
                </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Debug Log"></a>
        Debug Log
      </h4>
      				  <p>
The debug log is just the normal log that can be useful for finding out
configuration problems etc.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Configure Log4j for Audit logs"></a>
        Configure Log4j for Audit logs
      </h4>
      				  <p>
For JBoss you can configure JBOSS_HOME/server/default/conf/jboss-log4j.xml to
put the audit logs in a separate file.
                    </p>
	      				  <pre class="code">
&lt;appender name=&quot;SIGNSERVER_AUDIT&quot; class=&quot;org.jboss.logging.appender.DailyRollingFileAppender&quot;&gt;
    &lt;errorHandler class=&quot;org.jboss.logging.util.OnlyOnceErrorHandler&quot;/&gt;
    &lt;param name=&quot;File&quot; value=&quot;${jboss.server.log.dir}/signserver_audit.log&quot; /&gt;
    &lt;param name=&quot;Append&quot; value=&quot;true&quot; /&gt;

    &lt;!-- Rollover at midnight each day --&gt;
    &lt;param name=&quot;DatePattern&quot; value=&quot;'.'yyyy-MM-dd&quot; /&gt;
    &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
        &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d{ISO8601} %-5p [%c{1}] %m%n&quot; /&gt;
    &lt;/layout&gt;
&lt;/appender&gt;

&lt;category name=&quot;org.signserver.server.log.SignServerLog4jDevice&quot;&gt;
    &lt;appender-ref ref=&quot;SIGNSERVER_AUDIT&quot;/&gt;
&lt;/category&gt;
&lt;category name=&quot;org.signserver.server.log.IWorkerLogger&quot;&gt;
    &lt;appender-ref ref=&quot;SIGNSERVER_AUDIT&quot;/&gt;
&lt;/category&gt;
                    </pre>
	      				  <p>
For GlassFish a similar setup is already configured in SIGNSERVER_HOME/modules/SignServer-Module-Log4j/src/log4j.properties. 
                    </p>
	      				  <p>
For JBoss 7/EAP6 the following can be edited in JBOSS_HOME/standalone/configuration/standalone.xml:
                    </p>
	      				  <pre class="code">
&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.2&quot;&gt;
    ...
    &lt;periodic-rotating-file-handler name=&quot;SignServer&quot; autoflush=&quot;true&quot;&gt;
        &lt;formatter&gt;
            &lt;pattern-formatter pattern=&quot;%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n&quot;/&gt;
        &lt;/formatter&gt;
        &lt;file relative-to=&quot;jboss.server.log.dir&quot; path=&quot;signserver.log&quot;/&gt;
        &lt;suffix value=&quot;.yyyy-MM-dd&quot;/&gt;
        &lt;append value=&quot;true&quot;/&gt;
    &lt;/periodic-rotating-file-handler&gt;
    &lt;periodic-rotating-file-handler name=&quot;SignServer_audit&quot; autoflush=&quot;true&quot;&gt;
        &lt;formatter&gt;
            &lt;pattern-formatter pattern=&quot;%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n&quot;/&gt;
        &lt;/formatter&gt;
        &lt;file relative-to=&quot;jboss.server.log.dir&quot; path=&quot;signserver_audit.log&quot;/&gt;
        &lt;suffix value=&quot;.yyyy-MM-dd&quot;/&gt;
        &lt;append value=&quot;true&quot;/&gt;
    &lt;/periodic-rotating-file-handler&gt;

    &lt;logger category=&quot;org.signserver&quot;&gt;
        &lt;level name=&quot;DEBUG&quot;/&gt;
        &lt;handlers&gt;
            &lt;handler name=&quot;SignServer&quot;/&gt;
        &lt;/handlers&gt;
    &lt;/logger&gt;
    &lt;logger category=&quot;org.ejbca&quot;&gt;
        &lt;level name=&quot;DEBUG&quot;/&gt;
        &lt;handlers&gt;
            &lt;handler name=&quot;SignServer&quot;/&gt;
        &lt;/handlers&gt;
    &lt;/logger&gt;
    &lt;logger category=&quot;org.cesecore&quot;&gt;
        &lt;level name=&quot;DEBUG&quot;/&gt;
        &lt;handlers&gt;
            &lt;handler name=&quot;SignServer&quot;/&gt;
        &lt;/handlers&gt;
    &lt;/logger&gt;
    &lt;logger category=&quot;org.signserver.server.log.SignServerLog4jDevice&quot;&gt;
        &lt;handlers&gt;
            &lt;handler name=&quot;SignServer_audit&quot;/&gt;
        &lt;/handlers&gt;
    &lt;/logger&gt;
    &lt;logger category=&quot;org.signserver.server.log.ISystemLogger&quot;&gt;
        &lt;handlers&gt;
            &lt;handler name=&quot;SignServer_audit&quot;/&gt;
        &lt;/handlers&gt;
    &lt;/logger&gt;
    ...
&lt;/subsystem&gt;             
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Status Repository Logging"></a>
        Status Repository Logging
      </h4>
      				  <p>
By default the Status Repository produces a log entry for every update. This can 
be disabled or changed in the configuration so that only changes are 
logged. See the property <i>statusrepository.log</i> in 
signserver_deploy.properties.sample.
                    </p>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Database Command Line Interface"></a>
      Database Command Line Interface
    </h3>
      				  <p>
The SignServer DB CLI can be run against a database. Currently it only supports 
verifying the audit log.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Building"></a>
        Building
      </h4>
      				  <p>
The DB CLI is built if the property databasecli.enabled=true is specified in 
signserver_deploy.properties. It can also be built using:
                    </p>
	      				  <pre class="code">
$ bin/ant -f modules/SignServer-DatabaseCLI/build.xml dist-module
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Configuring"></a>
        Configuring
      </h4>
      				  <p>
Configure the dbcli.* properties in conf/signserver_cli.properties.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Running"></a>
        Running
      </h4>
      				  <p>
There is start-up script available under bin. You might have specify a classpath
containing the JDBC connectors for the specific database type. Example:
                    </p>
	      				  <pre class="code">
$ OPTIONAL_CLASSPATH=/usr/share/java/mysql-connector-java.jar bin/signserver-db audit verifylog
                    </pre>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer without Database"></a>
      SignServer without Database
    </h3>
      				  <p>
Since SignServer 3.2.3 it is sometimes possible to operate SignServer without a database management system and instead rely on SignServer to manage persistence using local files.
                </p>
	      				  <p>
Notice that all features of SignServer is not supported without having a database and that the performance and scalability characteristics might be different. Currently archiving to database is not supported.
                </p>
	      				  <p>
To increase throughput it is recommended to disable the key usage counter as every request would otherwise have to lock and update that file. See the property DISABLEKEYUSAGECOUNTER in the section <a href="complete.en.html#Limiting%20the%20number%20of%20signatures">Limiting the number of signatures</a>.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Configuration"></a>
        Configuration
      </h4>
      				  <p>
In signserver_deploy.properties, set database.type to "nodb".
                    </p>
	      				  <pre class="code">
database.type=nodb
					</pre>
	      				  <p>
Set the location for the local file-based database.
					</p>
	      				  <pre class="code">
database.nodb.location=/path/to/filedb
					</pre>
	      				  <p>
Where the path is some location where SignServer can write files. The default value is empty. If an relative path is used it is most likely relative to the application server's working directory.
					</p>
	      				  <p>
This directory should either point to an existing SignServer file database or be completely empty. If the directory is empty, SignServer will create the initial database structure at startup.
					</p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Structure of data"></a>
        Structure of data
      </h4>
      				  <p>
The file based database uses a number of files in the specified directory. Read/write synchronization is handled internally in the application and it is thus  not support to do manual changes to the files while the application server is running. It is normally also not supported to have multiple application servers running with SignServer using the same database directory.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Migrating to/from database"></a>
        Migrating to/from database
      </h4>
      				  <p>
The recommended way of migrating either to or from an other database management system without setting up all worker configuration from scratch is do use admin command "dumpproperties" to dump the current configuration to a file and then on the new system use the "setproperties" followed by the reload command for every worker id.
                    </p>
	      				  <p>
Notice: The dumpproperties command will not include the list of authorized clients so those will have to be setup again in the new system. Check with the admin command "listauthorizedclients" if you have any of those.
                    </p>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="SignServer TimeMonitor"></a>
      SignServer TimeMonitor
    </h3>
      				  <div class="frame note">
<div class="label">Note</div>
<div class="content">
The SignServer TimeMonitor is an Enterprise Edition feature.
                </div>
</div>
	      				  <p>
This is an external application that can be used together with the StatusReadingLocalComputerTimeSource for monitoring of the local time and
informing SignServer about its state.
                </p>
	      				  <p>
In SignServer, either a <a href="complete.en.html#StatusPropertiesWorker">StatusPropertiesWorker</a> or a <a href="complete.en.html#TimeMonitorManager">TimeMonitorManager</a> is configured for accepting the status updates. The later also supports dynamic configuration of the TimeMonitor.
                </p>
	      				  <p>
For details see the <a href="../docs/TimeMonitor-Manual.pdf">TimeMonitor manual</a> (only available in Enterprise Edition).
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Installation Packages"></a>
      Installation Packages
    </h3>
      				  <p>
See res/install/debian/README.building for instructions for creating Debian packages for SignServer.
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Contributed Howtos"></a>
      Contributed Howtos
    </h3>
      				  <p>
Contributed howtos and installation guides can be found under doc/howtos.
                </p>
	      				  <ul>
                    <li>
Installation guide for SignServer 3.1 and RHEL5.3 / CentOS 5.3 by Christophe Sahut called signserver31-rhel5.txt.                        
                    </li>
                    <li>
Installation package for SignServer 3.2.4 and Debian 6.0 contributed by Antoine Louiset called signserver32-debian6-by-antoine-louiset.zip.
                    </li>
                </ul>
	            </div>
          			          <div class="section">
    <h3>
      <a name="References"></a>
      References
    </h3>
      				  <ul>
                    <li>Java  (<a href="http://java.sun.com">http://java.sun.com</a>)</li>
                    <li>JBoss  (<a href="http://www.jboss.org">http://www.jboss.org</a>)</li>
                    <li>Apache Ant (<a href="http://ant.apache.org">http://ant.apache.org</a>)</li>
                    <li>Bouncycastle (<a href="http://www.bouncycastle.org">http://www.bouncycastle.org</a>)</li>
                    <li>RFC3161, Time-Stamp Protocol (TSP) (<a href="http://www.ietf.org">http://www.ietf.org</a>)</li>
                </ul>
	            </div>
                </div>
  
    
    </div>
  </div>

        <p class="copyright" style="text-align:center;">
        Copyright &copy; 2007-2015 PrimeKey Solutions AB.
        <script type="text/javascript" language="JavaScript"><!--
                document.write(" - "+"Last Published: " + document.lastModified);
              //  -->
        </script>
      </p>
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stat.primekey.se/piwik/" : "http://stat.primekey.se/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="//stat.primekey.se/piwik/piwik.php?idsite=6" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->      
    </body>
  </html>














