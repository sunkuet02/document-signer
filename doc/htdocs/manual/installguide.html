<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

    <html lang="en">
    <!-- GENERATED FILE, DO NOT EDIT, EDIT THE XML FILE IN xdocs INSTEAD! -->
    <head>
      <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
        <title>SignServer - Open Source server side Digital Signatures - Installation Guide</title>
                <link rel="shortcut icon" href="../images/pk-favIcon.png">
        <link type="text/css" href="../page.css" rel="stylesheet">
        </head>

    <body>

      <div class="logobar">
          <table width="100%">
            <tr>
                <td width="15%"><a href="http://www.signserver.org/"><img src="../images/SignServer_pki_by_primekey.png" alt="Click the PKI-by-PrimeKey-SignServer-logo to visit www.signserver.org" title="The logo squares follow a given magnitude of primes, symbolizing the encryption method of PrimeKey PKI." width="245" height="76" style="border:none;"></a></td>
                <td style="text-align:right">
                    <div class="searchcaption">
                            Search signserver.org for:<br>
                            <form id="searchForm" target="_blank" onsubmit="q.value = query.value + ' site:signserver.org'" action="http://www.google.com/search" method="get">
                                <input name="q" type="hidden">
                                <div style="height: 18px; white-space: nowrap;">
                                    <input name="query" id="searchBox" maxlength="255">
                                    <input type="submit" value="Go">
                                </div>
                            </form>
                    </div>
                </td>
        	<td id="services"><a href="https://www.primekey.se/service-support/support/?pk_campaign=ssorg&amp;pk_kwd=head_click-here" target="pk">Click here to learn about PrimeKey Support Services!</a></td>
            </tr>
          </table>
      </div>

                    
  <div class="menucontainer">

    <div class="menu">
      <ul>
              <li><div class="menuheader">General Information</div>
          <ul>
                            <li>
                                    <a href="../index.html">Home</a>
                                </li>
                            <li>
                                    <a href="../features.html">Features</a>
                                </li>
                            <li>
                                    <a href="../architecture.html">Architecture</a>
                                </li>
                            <li>
                                    <a href="../license.html">License</a>
                                </li>
                            <li>
                                    <a href="../contact.html">Contact & Support</a>
                                </li>
                            <li>
                                    <a href="../credits.html">Credits</a>
                                </li>
                            <li>
                                    <a href="../installations.html">Reference installations</a>
                                </li>
                            <li>
                                    <a href="../required.html">Required software</a>
                                </li>
                            <li>
                                    <a href="http://sourceforge.net/projects/signserver/" class="externalLink">SourceForge project</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Documentation</div>
          <ul>
                            <li>
                                    <a href="../manual.html">Manual</a>
                                </li>
                            <li>
                              <span class="sel"> Installation Guide</span>
                              </li>
                            <li>
                                    <a href="https://jira.primekey.se/browse/DSS?report=com.atlassian.jira.plugin.system.project:changelog-panel" class="externalLink">Changelog</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Download</div>
          <ul>
                            <li>
                                    <a href="../download.html">Latest releases</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Contributing</div>
          <ul>
                            <li>
                                    <a href="../contributors.html">Contributors</a>
                                </li>
                            <li>
                                    <a href="https://jira.primekey.se/" class="externalLink">Bug Database</a>
                                </li>
                            <li>
                                    <a href="../repositories.html">Repositories</a>
                                </li>
                      </ul>
        </li>
              <li><div class="menuheader">Continous integration</div>
          <ul>
                            <li>
                                    <a href="../hudson.html">Jenkins</a>
                                </li>
                      </ul>
        </li>
            
        <li><div class="menuheader">Used Services</div>
          <p><br>
          <a href="http://sourceforge.net/projects/signserver/"><img style="border:none; margin-left:20px;" src="http://sourceforge.net/sflogo.php?group_id=190195&amp;type=13" width="120" height="30" alt="Get SignServer at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
          </p>
        </li>
        <li><div class="menuheader">PKI by PrimeKey</div>
          <p>
          <br>
                <a href="https://www.primekey.se/technologies/products-overview/ejbca-enterprise/" target="ejbca">
                <img style="border:none; margin-left:20px;" src="../images/ejbca_pki_by_primekey.png" alt="Click the PKI-by-PrimeKey-EJBCA-logo to visit www.ejbca.org"/>
                </a>
          </p>
          <p>
                <a href="https://www.primekey.se/" target="primekey">
                <img style="border:none; margin-left:20px;" src="../images/logo-PrimeKey.png" alt="Click the PrimeKey logo to check out the products and services offered at www.primekey.se" title="The logo squares follow a given magnitude of primes, symbolizing the encryption method of PrimeKey PKI."/>
                </a>
          </p>
        </li>
      </ul>
    </div>
 	
  </div>
  <div class="main">
  <div class="content">
                <div id="minitoc-area">
            <ul class="chapterminitoc">
                                    <li><a href="#ch_installguide">Installation Guide</a> 
                                            
                                                <ul class="minitoc">
                                                            <li><a href="#Server installation">Server installation</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#1. Check prerequisites">1. Check prerequisites</a></li>
                                                                                            <li><a href="#2. Unpack SignServer">2. Unpack SignServer</a></li>
                                                                                            <li><a href="#3. Set environment variables">3. Set environment variables</a></li>
                                                                                            <li><a href="#4. Setup database">4. Setup database</a></li>
                                                                                            <li><a href="#5. Configure web server keystores">5. Configure web server keystores</a></li>
                                                                                            <li><a href="#6. Configure application server">6. Configure application server</a></li>
                                                                                            <li><a href="#7. Configure build">7. Configure build</a></li>
                                                                                            <li><a href="#8. Build and deploy SignServer">8. Build and deploy SignServer</a></li>
                                                                                            <li><a href="#9. Accessing SignServer">9. Accessing SignServer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Signer setup">Signer setup</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Loading signers">Loading signers</a></li>
                                                                                            <li><a href="#Quick start demo setup">Quick start demo setup</a></li>
                                                                                            <li><a href="#Quick start demo Timestamp signer">Quick start demo Timestamp signer</a></li>
                                                                                            <li><a href="#Quick start demo PDF signer">Quick start demo PDF signer</a></li>
                                                                                            <li><a href="#Quick start demo XML validator">Quick start demo XML validator</a></li>
                                                                                            <li><a href="#Quick start demo MRTD SOD signer">Quick start demo MRTD SOD signer</a></li>
                                                                                      </ul>
                                                                    </li>
                                                            <li><a href="#Upgrade">Upgrade</a>
                                                                                                        </li>
                                                            <li><a href="#Historic Installation Guides">Historic Installation Guides</a>
                                                                                                                 <ul class="minitoc">
                                                                                            <li><a href="#Clustered SignServer 3.0 CentOS 4.4 Installation Guide">Clustered SignServer 3.0 CentOS 4.4 Installation Guide</a></li>
                                                                                            <li><a href="#Clustered SignServer 2.0 CentOS 4.4 Installation Guide">Clustered SignServer 2.0 CentOS 4.4 Installation Guide</a></li>
                                                                                      </ul>
                                                                    </li>
                                                    </ul>

                    </li>


                             </ul>
                            <a href="complete.en.html">Complete manual</a>
                    </div>
        
            <div class="chapter">
    <h2>
      <a name="ch_installguide"></a>
      Installation Guide
    </h2>
      			          <div class="section">
    <h3>
      <a name="Server installation"></a>
      Server installation
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="1. Check prerequisites"></a>
        1. Check prerequisites
      </h4>
      				  <p>
Make sure all required softwares are installed:
                    </p>
	      				  <ul>
                        <li>Java 6: OpenJDK 6 or Oracle JDK 6 Update 10 or later*<br />
                            Java 7: OpenJDK 7** or Oracle JDK 7*</li>
                        <li>Application server: JBoss 5.1.0.GA***, JBoss EAP 5.1, JBoss AS 7.1.1, JBoss EAP 6.1 or GlassFish Server Open Source Edition 2.1.1**** or 3.1.2</li>
                        <li>Database: MySQL or MariaDB 5.5, HypersonicSQL (bundled with JBoss 5), Oracle Database 10/11g or without*****</li>
                        <li>Build tool: Apache Ant 1.8.0 or later</li>
                    </ul>
	      				  <p>
* When using Oracle JDK you must install the 'Unlimited Strength Jurisdiction Policy Files' for JDK for the parts of SignServer that  makes use of strong crypto to work. The policy files can be found at the same place as the JDK download at Oracle. Further information on this can be found in the Oracle documentation on the JCE. <br />
** If the application server supports JDK 7. Works for GlassFish 3 and JBoss 7/EAP 6.<br />
*** JBoss 5.1.0.GA is available in two different versions (standard and JDK6) which differs in web services stacks. The one called JBoss 5.1.0.GA-JDK6 should be used.<br />
**** GlassFish version 2 support will be dropped in an upcoming version. Some features like KeystoreInConfigCryptoToken is not supported.<br />
***** See <a href="complete.en.html#SignServer%20without%20Database">SignServer without Database</a>
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="2. Unpack SignServer"></a>
        2. Unpack SignServer
      </h4>
      				  <p>
Download and unzip the
<a href="http://sourceforge.net/projects/signserver/files/signserver/">latest
SignServer release</a> archive from SourceForge or for the absolutely latest
unstable version checkout from the Subversion (SVN)
<a href="https://svn.cesecore.eu/svn/signserver/trunk/">repository</a>.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="3. Set environment variables"></a>
        3. Set environment variables
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="APPSRV_HOME"></a>
        *** APPSRV_HOME ***
      </h5>
      				  <p>
Set APPSRV_HOME to point to your application server installation (<code>/opt/jboss</code> could be a symbolic link).
                        </p>
	      				  <pre class="code">
export APPSRV_HOME=/opt/jboss
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="ANT_OPTS"></a>
        *** ANT_OPTS ***
      </h5>
      				  <p>
Set ANT_OPTS to give Ant more memory for building SignServer.
                        </p>
	      				  <pre class="code">
export ANT_OPTS=&quot;-Xmx512m -XX:MaxPermSize=128m&quot;
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNSERVER_HOME"></a>
        *** SIGNSERVER_HOME ***
      </h5>
      				  <p>
Set SIGNSERVER_HOME to point to your SignServer installation.
                        </p>
	      				  <pre class="code">
export SIGNSERVER_HOME=/opt/signserver
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="SIGNSERVER_NODEID"></a>
        *** SIGNSERVER_NODEID ***
      </h5>
      				  <p>
Set SIGNSERVER_NODEID to an unique ID for the server.
                        </p>
	      				  <pre class="code">
export SIGNSERVER_NODEID=node1
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="4. Setup database"></a>
        4. Setup database
      </h4>
      				  <p>
Skip this section and instead follow the instructions in 
<a href="complete.en.html#SignServer%20without%20Database">SignServer without Database</a> if
you decide to run SignServer without a database management system.
                    </p>
	      				  <p>
Create a database and user for SignServer. The application server will try to
create tables during startup of SignServer but if the database user does not
have table create permissions or if you run on GlassFish the tables must be
created manually. See doc/sql-scripts/create-tables-signserver34-*.sql.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="MariaDB binlog format configuration"></a>
        *** MariaDB binlog format configuration ***
      </h5>
      				  <p>
For MariaDB you will have to set binlog_format to "row", for instance in /etc/mysql/my.cnf:
                        </p>
	      				  <pre class="code">
binlog_format=row
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure database driver for JBoss 5 or GlassFish"></a>
        *** Configure database driver for JBoss 5 or GlassFish ***
      </h5>
      				  <p>
Copy the driver for your database to the application server lib folder.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure database driver for JBoss AS 7 or JBoss EAP 6"></a>
        *** Configure database driver for JBoss AS 7 or JBoss EAP 6 ***
      </h5>
      				  <p>
In JBoss 7/EAP6 it is not enough to just drop the JAR archive with a database JDBC driver into the deployments directory. Instead you will have to perform the following steps (for MySQL or MariaDB):
<ol>
<li>Create the necessary directories (relative to JBoss 7 base directory):
<br />
On JBoss 7.1.1 or EAP 6.0:
<pre>
mkdir -p modules/com/mysql/main/
</pre>
On JBoss 7.2 or EAP 6.1:
<pre>
mkdir -p modules/system/layers/base/com/mysql/main/
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
mkdir -p modules/org/mariadb/main/
</pre>
On JBoss 7.2 or EAP 6.1:
<pre>
mkdir -p modules/system/layers/base/org/mariadb/main/
</pre>
</li>
<li>Place the mysql.jar or mariadb.jar file in the directory you just created.</li>
<li>Create, in the created directory, the JDBC module configuration file module.xml with the following contents (replace mysql.jar with the full name of your jar file for example mysql-connector-java-5.1.18-bin.jar):
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="com.mysql"&gt;
  &lt;resources&gt;
    &lt;resource-root path="mysql.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
<!-- This is the original of above XML text.
<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="urn:jboss:module:1.0" name="com.mysql">
  <resources>
    <resource-root path="mysql.jar"/>
  </resources>
  <dependencies>
    <module name="javax.api"/>
    <module name="javax.transaction.api"/>
  </dependencies>
</module>
-->
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.mariadb"&gt;
  &lt;resources&gt;
    &lt;resource-root path="mariadb-java-client-1.1.2.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre>

</li>
<li>Register the driver by running the following two commands in the JBoss 7 CLI administration tool:
<pre>
/subsystem=datasources/jdbc-driver=com.mysql.jdbc.Driver:add(driver-name=com.mysql.jdbc.Driver,driver-module-name=com.mysql,driver-xa-datasource-class-name=com.mysql.jdbc.jdbc.jdbc2.optional.MysqlXADataSource)
:reload
</pre>
Or for MariaDB, mariadb-java-client-1.1.2.jar:
<pre>
/subsystem=datasources/jdbc-driver=org.mariadb.jdbc.Driver:add(driver-name=org.mariadb.jdbc.Driver,driver-module-name=org.mariadb,driver-xa-datasource-class-name=org.mariadb.jdbc.MySQLDataSource)
:reload
</pre>
</li>
</ol>
</p>
	      				  <p>For PostgreSQL you would use the following values instead:
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.postgresql"&gt;
  &lt;resources&gt;
    &lt;resource-root path="postgresql-9.1-903.jdbc4.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre>
<pre>
/subsystem=datasources/jdbc-driver=org.postgresql.Driver:add(driver-name=org.postgresql.Driver,driver-module-name=org.postgresql,driver-xa-datasource-class-name=org.postgresql.xa.PGXADataSource)
:reload
</pre>
</p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss 5"></a>
        *** Configure data source for JBoss 5 ***
      </h5>
      				  <p>
This is done automagically by the SignServer build script later during "ant deploy".
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for GlassFish"></a>
        *** Configure data source for GlassFish ***
      </h5>
      				  <p>
For GlassFish also configure a connection pool and JNDI resource:
                    </p>
	      				  <ol>
                        <li>Go to the Admin Console: http://localhost:4848</li>
                        <li>Click on Resources -&gt; JDBC -&gt; Connection Pools</li>
                        <li>Add a new Pool. For instance: Name: MySQLPool</li>
                        <li>
                            Fill in:<br />
                            databaseName: signserver<br />
                            password: signserver<br />
                            portNumber 3306<br />
                            serverName: localhost<br />
                            user: signserver
                        </li>
                        <li>Click Ping to test</li>
                        <li>Click on Resources -&gt; JDBC -&gt; JDBC Resources</li>
                        <li>
                             Add new:<br />
                             JNDI Name: jdbc/SignServerDS<br />
                             Pool Name: MySQLPool
                         </li>
                        <ul />
                    </ol>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss AS 7.1"></a>
        *** Configure data source for JBoss AS 7.1 ***
      </h5>
      				  <p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>
	      				  <p>A normal datasource (Note: no --enabled=true for JBoss AS 7.1):</p>
	      				  <pre class="code">
data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot;
</pre>
	      				  <p>
Then restart the application server.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Configure data source for JBoss EAP 6"></a>
        *** Configure data source for JBoss EAP 6 ***
      </h5>
      				  <p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>
	      				  <p>A normal datasource (Note: --enabled=true for JBoss EAP 6.x):</p>
	      				  <pre class="code">
data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot; --enabled=true
</pre>
	      				  <p>
Then restart the application server.
                        </p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="5. Configure web server keystores"></a>
        5. Configure web server keystores
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 5 SSL configuration"></a>
        *** JBoss 5 SSL configuration ***
      </h5>
      				  <p>
For JBoss if you are going to protect the HTTP communication with SSL, you need
a JKS SSL server keystore. Rename the web server keystore to tomcat.jks and put
it in a 'p12' subdirectory. Place a keystore called truststore.jks in the 'p12' directory
containing the trusted root certificate(s).
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="GlassFish SSL configuration"></a>
        *** GlassFish SSL configuration ***
      </h5>
      				  <p>
For GlassFish enable client authentication for http-listener-2 and manually
update the keystores with the right certificates.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7/EAP 6 SSL configuration"></a>
        *** JBoss 7/EAP 6 SSL configuration ***
      </h5>
      				  <p>
Copy the keystore file as JBOSS7_HOME/standalone/configuration/keystore/keystore.jks and the trust store as
                          JBOSS7_HOME/standalone/configuration/keystore/truststore.jks.
                        </p>
	      				  <p>
Configure interfaces using the approproate bind address (ie. 0.0.0.0 or 127.0.0.1).
                        </p>
	      				  <pre class="code">
/interfaces=/interface=http:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspub:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspriv:add(inet-address=&quot;0.0.0.0&quot;)
                        </pre>
	      				  <p>
Set-up the private port which requires client certificate. 
Use appropriate values for key-alias (hostname), password (keystore password), ca-certificate-password (truststore password),
and supported protocols.
                        </p>
	      				  <pre class="code">
/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port=&quot;8443&quot;,interface=&quot;httpspriv&quot;)
/subsystem=web/connector=httpspriv:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspriv, secure=true)
/subsystem=web/connector=httpspriv/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=verify-client, value=true)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-password, value=&quot;changeit&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-file, value=&quot;${jboss.server.config.dir}/keystore/truststore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;) 
                        </pre>
	      				  <p>
Set-up the public SSL port which doesn't require the client certificate.
Use appropriate values for key-alias (hostname), password (keystore password),
and supported protocols.
                        </p>
	      				  <pre class="code">
/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port=&quot;8442&quot;,interface=&quot;httpspub&quot;)
/subsystem=web/connector=httpspub:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspub, secure=true)
/subsystem=web/connector=httpspub/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;)
                        </pre>
	      				  <p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
	      				  <pre class="code">
:reload
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="6. Configure application server"></a>
        6. Configure application server
      </h4>
      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix web service problem in JBoss 5"></a>
        *** Fix web service problem in JBoss 5 ***
      </h5>
      				  <p>
Edit jboss-beans.xml to force the endpoint URL to be generated based on the WSDL
request by commenting out the line:
                        </p>
	      				  <pre>
    &lt;property name="webServiceHost"&gt;${jboss.bind.address}&lt;/property&gt;
</pre>
	      				  <p>
For JBoss 5.1.0.GA the file is available under: server/default/deployers/jbossws.deployer/META-INF/
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix web service problem in JBoss AS 7/EAP 6"></a>
        *** Fix web service problem in JBoss AS 7/EAP 6 ***
      </h5>
      				  <p>
Configure WSDL web-host rewriting to use the request host. Needed for webservices to work correctly when requiring client certificate.
                        </p>
	      				  <pre class="code">
/subsystem=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)
/subsystem=webservices:write-attribute(name=modify-wsdl-address, value=true)
                        </pre>
	      				  <p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
	      				  <pre class="code">
:reload
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix JBoss 5 bug with Oracle JDK"></a>
        *** Fix JBoss 5 bug with Oracle JDK ***
      </h5>
      				  <p>
If you are using Oracle's JDK and JBoss 5.1.x you need to copy
SIGNSERVER_HOME/lib/ext/1.6/bc*.jar to JBOSS_HOME/server/default/lib/. Remember this
when it's time for upgrades! This is a bug tracked by JBoss as JBAS-7882.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7 and Oracle JDK BouncyCastle issues"></a>
        *** JBoss 7 and Oracle JDK BouncyCastle issues ***
      </h5>
      				  <p>
When using Oracle JDK and JBoss 7 you need to install BC jars as a module in JBoss 7. See <a href="https://issues.jboss.org/browse/JBAS-7882">JBAS-7882</a>.
                        </p>
	      				  <p>
How to install modules are described in <a href="https://docs.jboss.org/author/display/MODULES/Defining+a+module">docs.jboss.org/author/display/MODULES/Defining+a+module</a>.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue in JBoss 5"></a>
        *** Fix XML Security library issue in JBoss 5 ***
      </h5>
      				  <p>
JBoss 5 bundles an older version of the XML Security library which conflicts with the one included in SignServer.
Run the below Ant target to copy the SignServer version and its dependencies to the JBoss endorsed folder:
                        </p>
	      				  <pre class="code">
bin/ant j2ee:copy-xmlsec
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue 1 in JBoss 7"></a>
        *** Fix XML Security library issue 1 in JBoss 7 ***
      </h5>
      				  <p>
        JBoss 7 bundles version 1.5.1 of the XML Security library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR file from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
	      				  <p>
        On Linux/Unix systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        cp lib/ext/xmlsec-1.5.8.jar $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/
                                                </pre>
	      				  <p>
        On Windows systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        copy lib\ext\xmlsec-1.5.8.jar %APPSRV_HOME%\modules\org\apache\santuario\xmlsec\main\
                                                </pre>
	      				  <p>
        Edit $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/module.xml to use the correct version:
                                                </p>
	      				  <pre class="code">
        &lt;resource-root path=&quot;xmlsec-1.5.8.jar&quot;/&gt;
                                                </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issue 2 in JBoss 7"></a>
        *** Fix XML Security library issue 2 in JBoss 7 ***
      </h5>
      				  <p>
        JBoss 7 bundles version 2.7.1 of the Xalan library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR files from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
	      				  <p>
        On Linux/Unix systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        cp lib/ext/xalan-2.7.2.jar lib/ext/serializer-2.7.2.jar $APPSRV_HOME/modules/org/apache/xalan/main/
                                                </pre>
	      				  <p>
        On Windows systems the following command can be used:
                                                </p>
	      				  <pre class="code">
        copy lib\ext\xalan-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\
        copy lib\ext\serializer-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\
                                                </pre>
	      				  <p>
        Edit $APPSRV_HOME/modules/org/apache/xalan/main/module.xml to use the correct versions:
                                                </p>
	      				  <pre class="code">
        &lt;resource-root path=&quot;serializer-2.7.2.jar&quot;/&gt;
        &lt;resource-root path=&quot;xalan-2.7.2.jar&quot;/&gt;
                                                </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Fix XML Security library issues in JBoss EAP"></a>
        *** Fix XML Security library issues in JBoss EAP ***
      </h5>
      				  <p>
Make sure to apply the relevant security patches from Red Hat.
                        </p>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Install Hibernate in GlassFish 3"></a>
        *** Install Hibernate in GlassFish 3 ***
      </h5>
      				  <p>
If you are using GlassFish 3 and run with a database you will have to install Hibernate. 
Run pkg install in the GlassFish folder:
                        </p>
	      				  <pre class="code">
./bin/pkg install hibernate
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="JBoss 7/EAP 6 and PKCS11"></a>
        *** JBoss 7/EAP 6 and PKCS11 ***
      </h5>
      				  <p>
JBoss 7/EAP 6 isolates away most sun classes. That means you will not be able to send certificates through remote EJB calls, and will not be able to use the Sun PKCS#11 provider.
These classes can be made available by editing the file
<i>modules/sun/jdk/main/module.xml (JBoss 7.1/EAP6.0)</i> and adding the following packages to the list of system export paths:
                        </p>
	      				  <pre class="code">
&lt;path name=&quot;sun/security/x509&quot;/&gt;
&lt;path name=&quot;sun/security/pkcs11&quot;/&gt;
&lt;path name=&quot;sun/security/pkcs11/wrapper&quot;/&gt;
                        </pre>
	      				  <p>
This will allow an application to use these internal Sun/Oracle/OpenJDK classes.
                        </p>
	      				  <p>
This is not needed in JBoss EAP 6.1/JBoss 7.2, because the two first packages are exported by default since <a href="https://issues.jboss.org/browse/JBPAPP6-1748">JBPAPP6-1748</a>.
One package is however needed still. In JBoss EAP 6.1 the file is located in <i>modules/system/layers/base/sun/jdk/main/module.xml</i>.
                        </p>
	      				  <pre class="code">
&lt;path name=&quot;sun/security/pkcs11/wrapper&quot;/&gt;
                        </pre>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="7. Configure build"></a>
        7. Configure build
      </h4>
      				  <p>
Copy conf/signserver_deploy.properties.sample to conf/signserver_deploy.properties and open
it for editing in your favorite text editor.
                    </p>
	      				  <pre class="code">
cp conf/signserver_deploy.properties.sample conf/signserver_deploy.properties
                    </pre>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web GUI configuration"></a>
        *** Web GUI configuration ***
      </h5>
      				  <p>
Uncomment j2ee.web-nohttps=true if SignServer should be used to configure the
keystore in JBoss 5.
                        </p>
	      				  <pre class="code">
#j2ee.web-nohttps=true
                        </pre>
	      				  <p>
For GlassFish change httpserver.privhttps to a port configured with HTTPS and
client authentication.
                        </p>
	      				  <pre class="code">
httpserver.privhttps=8181
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Database configuration"></a>
        *** Database configuration ***
      </h5>
      				  <p>
For GlassFish make sure the datasource.jndi-name and datasource.jndi-name-prefix
matches the resource configured in the admin console.
                        </p>
	      				  <pre class="code">
datasource.jndi-name=SignServerDS
datasource.jndi-name-prefix=jdbc/
                        </pre>
	      				  <p>
Select database management system
                        </p>
	      				  <pre class="code">
database.name=mysql
                        </pre>
	      				  <p>
For JBoss set the database connection URL, database driver and username and
password.
                        </p>
	      				  <pre class="code">
database.url=jdbc:mysql://127.0.0.1:3306/signserver
database.driver=com.mysql.jdbc.Driver
database.username=signserver
database.password=signserver
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web Service Configuration"></a>
        *** Web Service Configuration ***
      </h5>
      				  <p>
Enable or disable the web services.
                        </p>
	      				  <pre class="code">
signserverws.enabled=true
genericws.enabled=true
validationws.enabled=true
adminws.enabled=true
clientws.enabled=true
                        </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Modules Configuration"></a>
        *** Modules Configuration ***
      </h5>
      				  <p>
Enable all modules that should be built and choose if they should be included in the SignServer enterprise application archive (EAR). By setting includemodulesinbuild=true (default) all modules are built in. Otherwise for each module specify that it should be enabled and included:
                        </p>
	      				  <pre class="code">
module.xmlsigner.enabled=true
module.xmlsigner.include=true
...
                        </pre>
	      				  <p>
For GlassFish to enable debug logging include the Log4j module.
                        </p>
	      				  <pre class="code">
module.log4j.enabled=true
module.log4j.include=true
                        </pre>
	            </div>
	      				  <p>
See <a href="complete.en.html#Signed%20log">Signed log</a> for how to configure for signed audit logs in the database.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="8. Build and deploy SignServer"></a>
        8. Build and deploy SignServer
      </h4>
      				  <p>
Run "bin/ant build deploy" to build SignServer and deploy it to the selected application
server.
                    </p>
	      				  <pre class="code">
bin/ant clean build deploy
                    </pre>
	      				  <p>
Start the application server and verify that SignServer was deployed and
database tables were created. 
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="9. Accessing SignServer"></a>
        9. Accessing SignServer
      </h4>
      				  <p>
After startup a few different user interfaces are available.	
					</p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Command Line Interface"></a>
        *** Command Line Interface ***
      </h5>
      				  <pre class="code">
bin/signserver getstatus brief all
Assuming JBoss JNDI provider...
===========================================
Executing Command on host : localhost
===========================================


Current version of server is : SignServer 3.5.0alpha0
                    </pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Graphical User Interface"></a>
        *** Graphical User Interface ***
      </h5>
      				  <pre class="code">
bin/signserver-gui
bin/signserver-gui -ws
						</pre>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Web Interface"></a>
        *** Web Interface ***
      </h5>
      				  <p>
Point your web browser to <a href="http://localhost:8080/signserver">http://localhost:8080/signserver</a> for demo web pages and local documentation.
					</p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Signer setup"></a>
      Signer setup
    </h3>
      				  <p>
After server installation the different signers can be setup using the
SignServer CLI.
                </p>
	      			      	  <div class="subsection">
      <h4>
        <a name="Loading signers"></a>
        Loading signers
      </h4>
      				  <p>
Signers (and other workers) can be loaded by setting properties using "setproperty" or "setproperties" etc.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="setproperties"></a>
        *** setproperties ***
      </h5>
      				  <p>
The "setproperties" command loads all the properties from a property file that
can define one or many signers. The code for the signers needs to be deployed
to the application server together with SignServer either by setting
includemodulesinbuild=true to include all modules or by setting individual
module.MODULENAME.include=true properties in signserver_deploy.properties.
                        </p>
	      				  <pre class="code">
bin/signserver setproperties doc/sample-configs/CONFIGURATION.PROPERTIES
                        </pre>
	            </div>
	      				  <p>
After adding or changing a property for a worker (by
any of the "setpropery" or "setproperties" commands) the configuration needs be
applied by issuing the reload command with the ID of the worker.
                    </p>
	      				  <pre class="code">
bin/signserver reload 4711
                    </pre>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo setup"></a>
        Quick start demo setup
      </h4>
      				  <p>
This is a quick start guide to quickly get you setup with a crypto token and a set of workers/signers for testing and demonstration purposes.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Setup a sample crypto token"></a>
        *** Setup a sample crypto token ***
      </h5>
      				  <p>Set up a crypto token called CryptoTokenSoft which uses a hard coded software keystore:</p>
	      				  <code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties</code>
	      				  <p>
Activate the configuration using the assigned worker ID that was printed (for instance 1):
                        </p>
	      				  <code>$ bin/signserver reload 1</code>
	            </div>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Add sample workers"></a>
        *** Add sample workers ***
      </h5>
      				  <p>
Workers can then be set up using the setproperties followed by the reload command. Sample configurations
are available in doc/sample-configs which by default uses the sample crypto token:
                        </p>
	      				  <code>$ bin/signserver setproperties doc/sample-configs/CONFIGURATION.properties</code>
	      				  <p>
Activate the configuration using the assigned worker ID that was printed (for instance 2):
                        </p>
	      				  <code>$ bin/signserver reload 2</code>
	      				  <p>See the following section for some example for specific workers.</p>
	            </div>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo Timestamp signer"></a>
        Quick start demo Timestamp signer
      </h4>
      				  <p>
This is a quick start guide to quickly get you setup with a demo Time Stamp service (TSA according to RFC3161). It will let you quickly get a feeling how the structure of the SignServer works, so you can move on to more advanced features described in the manual.
                    </p>
	      				  <ol>
                        <li>
Make sure the tsa module is built in by setting module.tsa.enabled=true and
module.tsa.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the Timestamp demo configuration and notice the generated worker ID (in this
example 2):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_timestamp_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 2</code>
                        </li>
                        <li>
You can check the status and configuration with:<br />
<code>$ bin/signserver getstatus complete all</code>
                        </li>
                        <li>
Run the test client to see that everything is up:<br />
<code>$ bin/signclient timestamp http://localhost:8080/signserver/process?workerName=TimeStampSigner</code>
<br />The message "TimeStampRequest validated" should appear once a second. Also
check JBOSS_HOME/server/default/log/server.log or
GLASSFISH_HOME/domains/domain1/logs/server.log that successful messages appear.
                        </li>
                    </ol>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo PDF signer"></a>
        Quick start demo PDF signer
      </h4>
      				  <p>
To install the PDF signer you can issue the following commands (either instead of the TSA or in addition to the TSA).
                    </p>
	      				  <ol>
                        <li>
Make sure the pdfsigner module is built in by setting module.pdfsigner.enabled=true and
module.pdfsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the PDF signer demo configuration and notice the generated worker ID (in this
example 3):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_pdfsigner_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 3</code>
                        </li>
                        <li>
You can check the status and configuration with:<br />
<code>$ bin/signserver getstatus complete all</code>
                        </li>
</ol>
	      				  <p>
You can now, with your web browser, access the URL <a href="http://localhost:8080/signserver/demo/pdfsign.jsp">http://localhost:8080/signserver/demo/pdfsign.jsp</a> to get PDF documents signed.
</p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo XML validator"></a>
        Quick start demo XML validator
      </h4>
      				  <p>
An XML validator validates the signature of an XML document. It uses a
certificate validation service worker for validating the certificate so
that worker has to be configured first.
                    </p>
	      				  <p>
To install a certificate validation service worker issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Load the configuration and notice the worker ID (in this example: 6):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_validator_dummy_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 6</code>
<br />
                        </li>
                        <li>
The status of the Worker can now be viewed with:<br />
<code>$ bin/signserver getstatus complete CertValidationWorker</code>
<br />
                        </li>
                    </ol>
	      				  <p>
Then to install the XML validator you can issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Make sure the xmlvalidator module is built in by setting module.xmlvalidator.enabled=true and
module.xmlvalidator.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Load the XML validator demo configuration and notice the generated worker ID (in this
example 7):
<br />$ bin/signserver setproperties doc/sample-configs/qs_xmlvalidator_configuration.properties
                        </li>
                    <li>
Verify the configuration with (notice that VALIDATIONSERVICEWORKER is set to "CertValidationWorker"):<br />
<code>$ bin/signserver getconfig 7</code>
<br />
                    </li>
                    <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 7</code>
<br />
                    </li>
                    <li>
The status of the Validator can now be viewed with:<br />
<code>$ bin/signserver getstatus complete DemoXMLValidator</code>
<br />
                    </li>
                    </ol>
	      				  <p>
Now <a href="integration.html">the SignServer APIs</a> can be used to request XML documents to be validated by the DemoXMLValidator worker.
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Quick start demo MRTD SOD signer"></a>
        Quick start demo MRTD SOD signer
      </h4>
      				  <p>
The MRTD SOD signer takes as input data group hashes and creates a signed SO(d). This means that the signserver will function
as a Document Signer for ePassports.</p>
	      				  <p>
To install the MRTD SOD signer you can issue the following commands:
                    </p>
	      				  <ol>
                        <li>
Make sure the mrtdsodsigner module is built in by setting module.mrtdsodsigner.enabled=true and
module.mrtdsodsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        <li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />
<code>$ bin/signserver setproperties doc/sample-configs/soft-crypto-configuration.properties<br />
$ bin/signserver reload 1</code>
                        </li>
                        <li>
Load the MRTD SOD signer demo configuration and notice the generated worker ID (in this
example 8):<br />
<code>$ bin/signserver setproperties doc/sample-configs/qs_mrtdsodsigner_configuration.properties</code>
                        </li>
                        <li>
Activate the configuration with:<br />
<code>$ bin/signserver reload 8</code>
<br />
                        </li>
                        <li>
The status of the signer can now be viewed with:<br />
<code>$ bin/signserver getstatus complete mrtdsodsigner</code>
<br />
                        </li>
                    </ol>
	      				  <p>
Now <a href="integration.html">the SignServer APIs</a> can be used to send MRTD SOD sign requests the MRTDSODSigner.
<br />
Also you can use the HTML page <a href="http://localhost:8080/signserver/demo/mrtdsodsign.jsp">http://localhost:8080/signserver/demo/mrtdsodsign.jsp</a> to enter requests and get the SOd back.
This HTML form also functions as a sample to show how you can make HTTP requests from the personalisation system to the Document Signer.
                    </p>
	      				  	  <div class="subsubsection">
      <h5>
        <a name="Production configuration with HSM"></a>
        *** Production configuration with HSM ***
      </h5>
      				  <p>
To install a production signer using an HSM instead of the CryptoTokenSoft, make 
a copy of doc/sample-configs/pkcs11-crypto-configuration.properties and configure
the necessary properties for the HSM and apply that file using setproperties and
reload with its worker ID.<br />
(note after changing properties in the file it needs to be loaded again
with setproperties)
                        </p>
	      				  <p>
Now when configuring a worker make sure to have the worker property CRYPTOTOKEN=CryptoTokenP11.
                        </p>
	      				  <p>
Before starting with an HSM installation you should read the about the
    <a href="plugins.html#PKCS11CryptoToken">PKCS11CryptoToken</a> in the plugins
section of the manual.
                        </p>
	      				  <pre class="code">
bin/signserver setproperties doc/sample-configs/pkcs11-crypto-configuration.properties
bin/signserver reload 9
bin/signserver setproperties doc/sample-configs/qs_mrtdsodsigner_configuration.properties
bin/signserver setproperty 10 CRYPTOTOKEN CryptoTokenP11
bin/signserver reload 10
bin/signserver activatecryptotoken 9 tokenpin
bin/signserver generatecertreq 9 &quot;C=SE,CN=MRTD SOD Signer&quot; SHA256WithRSA mrtdsodsigner.req
</pre>
	      				  <p>
Where 9 is the workerId that you got when running the 'setproperties' command for the pkcs11 crypto token.<br />
Tokenpin is the password for the HSM slot configured in the properties file.<br />
This will create a certificate request that you can get signed by your CA. When you have received the response you can import it and the CA certficate.
If you have the returned signer certificate as cert.pem and the CA certificate as cacert.pem, then:
                        </p>
	      				  <pre class="code">
cat cert.pem cacert.pem &gt; certchain.pem
bin/signserver uploadsignercertificate 10 glob cert.pem
bin/signserver uploadsignercertificatechain 10 glob certchain.pem
bin/signserver reload 9
</pre>
	      				  <p>
Hint: you can use EJBCA to create keys on a PKCS#11 HSM using clientToolBox.<br />
ejbcaClientToolBox.sh PKCS11HSMKeyTool generate /opt/ETcpsdk/lib/linux-x86_64/libcryptoki.so 2048 DSSignKey 5
                        </p>
	            </div>
	            </div>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Upgrade"></a>
      Upgrade
    </h3>
      				  <p>
See SIGNSERVER_HOME/doc/RELEASE_NOTES.txt and UPGRADE.txt for information about upgrading from an earlier version of SignServer. 
                </p>
	            </div>
          			          <div class="section">
    <h3>
      <a name="Historic Installation Guides"></a>
      Historic Installation Guides
    </h3>
      			      	  <div class="subsection">
      <h4>
        <a name="Clustered SignServer 3.0 CentOS 4.4 Installation Guide"></a>
        Clustered SignServer 3.0 CentOS 4.4 Installation Guide
      </h4>
      				  <p>
Installation guide describing step-by-step how to setup a SignServer cluster on CentOS 4.4. Even if the document
is specific for this OS is should be quite easy to adopt it to other environments as well. It 
can be downloaded here either as <a href="../docs/SignServer_3_0_Installation_Guide.pdf">PDF</a> or viewed as
<a href="../docs/SignServer_3_0_Installation_Guide.html">HTML</a>
                    </p>
	            </div>
	      			      	  <div class="subsection">
      <h4>
        <a name="Clustered SignServer 2.0 CentOS 4.4 Installation Guide"></a>
        Clustered SignServer 2.0 CentOS 4.4 Installation Guide
      </h4>
      				  <p>
Version 2.0 of the same documentation.<a href="../docs/SignServer_2_0_Installation_Guide.pdf">PDF</a> <a href="../docs/SignServer_2_0_Installation_Guide.html">HTML</a>
                    </p>
	            </div>
	            </div>
                </div>
  
    
    </div>
  </div>

        <p class="copyright" style="text-align:center;">
        Copyright &copy; 2007-2015 PrimeKey Solutions AB.
        <script type="text/javascript" language="JavaScript"><!--
                document.write(" - "+"Last Published: " + document.lastModified);
              //  -->
        </script>
      </p>
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stat.primekey.se/piwik/" : "http://stat.primekey.se/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="//stat.primekey.se/piwik/piwik.php?idsite=6" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->      
    </body>
  </html>














